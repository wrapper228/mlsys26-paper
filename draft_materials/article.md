<div class="tm-layout__container" role="main">

<div class="tm-page" hl="ru"
style="--1f95df5f: 16px; --c13e469c: 820.4000244140625px; --4d57867b: 780px;">

<div class="tm-page-width">

<div class="tm-page__wrapper">

<div class="tm-page__main tm-page__main_has-sidebar">

<div class="pull-down">

<div class="pull-down__header" style="height: 0px;">

<div class="pull-down__content" style="bottom: 10px;">

<img
src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyBwdWxsLWRvd25fX2ljb24gcHVsbC1kb3duX19hcnJvdyIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0J7QsdC90L7QstC40YLRjDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI3B1bGwtYXJyb3ciIC8+PC9zdmc+"
class="tm-svg-img pull-down__icon pull-down__arrow" />

</div>

</div>

<div class="tm-article-presenter">

<div class="tm-article-presenter__body" test-id="article-body">

<div class="tm-misprint-area">

<div class="tm-misprint-area__wrapper">

<div class="tm-article-presenter__header">

<div class="tm-article-snippet tm-article-snippet tm-article-presenter__snippet">

<div class="tm-article-snippet__meta-container">

<div class="tm-article-snippet__meta">

<span class="tm-user-info tm-article-snippet__author"><a href="https://habr.com/ru/users/andrey_atamanyuk/"
class="tm-user-info__userpic" data-test-id="user-info-pic"
title="andrey_atamanyuk"></a></span>

<div class="tm-entity-image">

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/110.png"
class="tm-entity-image__pic" width="24" height="24" />

</div>

<span class="tm-user-info__user tm-user-info__user_appearance-default"
test-id="user-info-description"><a href="https://habr.com/ru/users/andrey_atamanyuk/"
class="tm-user-info__username">andrey_atamanyuk</a>
<span class="tm-article-datetime-published"><span test-id="articleNeverPublishedMessage">Никогда
не публиковалось</span></span></span>

</div>

<div class="tm-article-snippet__controls">

<a href="https://habr.com/ru/article/edit/956602/"
class="tm-article-snippet__edit" data-test-id="newEditorlink"><img
src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyBpY29uX2VkaXQtcG9zdCIgaGVpZ2h0PSIyMCIgd2lkdGg9IjIwIiBkYXRhLXRlc3QtaWQ9ImFydGljbGVFZGl0SWNvbiI+PHRpdGxlPtCg0LXQtNCw0LrRgtC40YDQvtCy0LDRgtGMPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjZWRpdCIgLz48L3N2Zz4="
class="tm-svg-img icon_edit-post" /></a><a href="https://habr.com/ru/statistics/956602/"
class="statistics-link tm-article-snippet__stats-info"
data-v-990c705a=""><img
src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtOTkwYzcwNWEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbl9zdGF0aXN0aWNzLXBvc3QiIGhlaWdodD0iMjAiIHdpZHRoPSIyMCIgZGF0YS10ZXN0LWlkPSJhcnRpY2xlU3RhdGlzdGljc0ljb24iPjx0aXRsZT7QodGC0LDRgtC40YHRgtC40LrQsDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI3N0YXRzLWluZm8iIC8+PC9zdmc+"
class="tm-svg-img icon_statistics-post" /></a>

<img
src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyBpY29uX2VkaXQtcG9zdCIgaGVpZ2h0PSIyMCIgd2lkdGg9IjIwIiBkYXRhLXRlc3QtaWQ9ImFydGljbGVEZWxldGVEcmFmdEljb24iPjx0aXRsZT7Qo9C00LDQu9C40YLRjCDRh9C10YDQvdC+0LLQuNC6PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjdHJhc2giIC8+PC9zdmc+"
class="tm-svg-img icon_edit-post" />

</div>

</div>

# чистовик

<div class="tm-article-snippet__stats" test-id="articleStats">

<div class="tm-article-complexity tm-article-complexity_complexity-high">

<span class="tm-svg-icon__wrapper tm-article-complexity__icon"><img
src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0KPRgNC+0LLQtdC90Ywg0YHQu9C+0LbQvdC+0YHRgtC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY29tcGxleGl0eS1oaWdoIiAvPjwvc3ZnPg=="
class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-complexity__label">Сложный</span>

</div>

<div class="tm-article-reading-time">

<span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><img
src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JLRgNC10LzRjyDQvdCwINC/0YDQvtGH0YLQtdC90LjQtTwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2Nsb2NrIiAvPjwvc3ZnPg=="
class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-reading-time__label">28
мин</span>

</div>

<span class="tm-icon-counter tm-data-icons__item"><img
src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
title="7">7</span></span>

</div>

<div class="tm-publication-hubs__container" test-id="articleHubsList">

<div class="tm-publication-hubs">

<span class="tm-publication-hub__link-container"><a href="https://habr.com/ru/hubs/maths/"
class="tm-publication-hub__link"><span>Математика</span><span
class="tm-article-snippet__profiled-hub" title="Профильный хаб"> *
</span></a></span><span class="tm-publication-hub__link-container"><a href="https://habr.com/ru/hubs/machine_learning/"
class="tm-publication-hub__link"><span>Машинное обучение</span><span
class="tm-article-snippet__profiled-hub" title="Профильный хаб"> *
</span></a></span>

</div>

</div>

<div class="tm-article-labels" v-2083333e="" test-id="articleLabels">

<div class="tm-article-labels__container" v-2083333e="">

<div class="tm-publication-label tm-publication-label_variant-review"
v-2083333e="">

Обзор

</div>

<div class="tm-publication-label tm-publication-label_variant-draft"
v-2083333e="">

Черновик

</div>

</div>

</div>

</div>

</div>

<div class="article-body" v-367403b9="" gallery-root="" lang="ru">

<div v-367403b9="">

</div>

<div id="post-content-body" v-367403b9="">

<div>

<div class="article-formatted-body article-formatted-body article-formatted-body_version-2">

<div xmlns="http://www.w3.org/1999/xhtml">

### Введение

Привет, Habr! Меня зовут Андрей Атаманюк, я Data Scientist в R&D команде
рекомендательных систем Wildberries & Russ. В этой статье я разберу
тонкости обучения двухбашенных моделей (без специфики к домену
рекомендаций), которые могут существенно влиять на качество
рекомендаций, но часто остаются за кадром. Речь пойдёт о систематическом
росте норм эмбеддингов популярных товаров — эффекте, который
противоречит интуитивным ожиданиям от косинусных лоссов.

<figure class="full-width">
<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/4797101e08447dbd4ac1a38c3f3e38e4.png"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/479/710/1e0/4797101e08447dbd4ac1a38c3f3e38e4.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/479/710/1e0/4797101e08447dbd4ac1a38c3f3e38e4.png 781w"
loading="lazy" data-decode="async" width="1560" height="880" />
</figure>

### Предыстория

Всё началось, когда я обучал DSSM-модель для рекомендаций товаров
маркетплейса пользователям с использованием стандартного подхода:

- Двухбашенная архитектура с раздельными энкодерами

- Косинусный лосс (<a href="https://arxiv.org/abs/1807.03748"
  rel="noopener noreferrer nofollow" target="_blank">InfoNCE</a>, ещё
  известен как Full Product Softmax loss) для обучения с in-batch
  негативами

- Ожидание: косинусный лосс должен нивелировать влияние популярности,
  потому что косинус зависит только от угла между айтемами и, как я
  думал раньше, обучение на него не должно «мотивировать» эмбеддинги
  «впитывать» популярность в их норму.

Но практика преподнесла сюрприз: при анализе эмбеддингов популярных
товаров их нормы систематически росли, в то время как нишевые товары
демонстрировали стагнацию. Причем эффект усиливался с ростом частоты
встречаемости товара в данных. При составлении рекомендаций я пробовал
использовать и косинус, и скалярное произведение между эмбеддингами
юзера и айтема — при использовании скалярного произведения возникали
систематические искажения. О них можно прочитать ниже.

### Почему это критично для индустрии?

- *Ранжирование:* большинство систем используют скалярное произведение
  для оценки релевантности:

  <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/c10e241d1fd69aea7274bc0b1ee26434.svg"
  class="formula inline"
  data-source="\text{score}_{ui} = {q}_u \cdot {q}_i"
  sizes="(max-width: 780px) 100vw, 50vw"
  srcset="https://habrastorage.org/getpro/habr/upload_files/c10/e24/1d1/c10e241d1fd69aea7274bc0b1ee26434.svg 780w,
         https://habrastorage.org/getpro/habr/upload_files/c10/e24/1d1/c10e241d1fd69aea7274bc0b1ee26434.svg 781w"
  loading="lazy" data-decode="async" width="132" height="16"
  alt="\text{score}_{ui} = {q}_u \cdot {q}_i" /> (<img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/ea2dda7c4a03da637f70bcd06d4d5640.svg"
  class="formula inline" data-source="q_u"
  sizes="(max-width: 780px) 100vw, 50vw"
  srcset="https://habrastorage.org/getpro/habr/upload_files/ea2/dda/7c4/ea2dda7c4a03da637f70bcd06d4d5640.svg 780w,
         https://habrastorage.org/getpro/habr/upload_files/ea2/dda/7c4/ea2dda7c4a03da637f70bcd06d4d5640.svg 781w"
  loading="lazy" data-decode="async" width="19" height="15" alt="q_u" />
  — эмбеддинг пользователя, <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/7c0d182007a1d0addc8367c1109ab4a0.svg"
  class="formula inline" data-source="q_i"
  sizes="(max-width: 780px) 100vw, 50vw"
  srcset="https://habrastorage.org/getpro/habr/upload_files/7c0/d18/200/7c0d182007a1d0addc8367c1109ab4a0.svg 780w,
         https://habrastorage.org/getpro/habr/upload_files/7c0/d18/200/7c0d182007a1d0addc8367c1109ab4a0.svg 781w"
  loading="lazy" data-decode="async" width="15" height="15" alt="q_i" />
  — эмбеддинг товара)  

- *Систематическое искажение:* рост <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/09be0248224942a50cfb5da5e599cd78.svg"
  class="formula inline" data-source="\|{q}_i\|"
  sizes="(max-width: 780px) 100vw, 50vw"
  srcset="https://habrastorage.org/getpro/habr/upload_files/09b/e02/482/09be0248224942a50cfb5da5e599cd78.svg 780w,
         https://habrastorage.org/getpro/habr/upload_files/09b/e02/482/09be0248224942a50cfb5da5e599cd78.svg 781w"
  loading="lazy" data-decode="async" width="35" height="22"
  alt="\|{q}_i\|" /> для популярных товаров искусственно завышает их
  релевантность:

  ``` python
  # Псевдокод ранжирования
  scores = []
  for item in candidate_items:
      score = dot(user_embedding, item_embedding)  # Зависит от нормы!
      scores.append(score)
      top_items = sort(scores)[:10]
  ```

- *Эффект «богатые богатеют»:* хиты получают ещё больше показов → нормы
  растут → цикл усиливается

- *Подавление long-tail:* нишевые товары систематически
  недопредставляются

### Что вы найдёте в статье

#### Статья объяснит:

- **Как архитектура модели влияет на динамику эмбеддингов**  
  На примере 10 экспериментов покажу, когда возникает ортогональность
  движения эмбеддингов и когда — корреляция норм эмбеддингов айтемов с
  популярностью айтемов (часто буду называть это явление popularity
  bias)

- **Аналитический вывод зависимости нормы эмбеддинга объекта от его
  популярности**  
  Разнообразные эксперименты усиливают уверенность в полученных выводах

- **Гарантии на появление popularity bias в practical двухбашенных
  моделях**  
  При каких именно деталях имплементации модели, used in production,
  подвержены этому явлению

- **Почему популярные работы (NormFace и др.) упускают ключевые
  факторы**  
  Их доказательства не учитывают архитектуру энкодеров

#### Ценность для практиков:

- Сэкономите месяцы на отладке «необъяснимых*»* артефактов обучения в
  practical архитектурах моделей, используемых в production

- Получите воспроизводимые примеры на PyTorch для собственных
  экспериментов

### О чем статья?

В результате исследований процессов обучения двухбашенных моделей (в
моем случае была задача коллаборативной фильтрации) я определил причины,
из-за которых у популярных объектов наблюдается систематическое
увеличение нормы эмбеддингов в процессе обучения с использованием
функции потерь, использующей косинусную меру близости. У этого эффекта
есть концептуальное объяснение, выходящее из анализа формул обратного
распространения ошибки. Этот анализ объясняет, при выполнении каких
факторов будет наблюдаться такое влияние популярности объектов на
результат процесса обучения.

Это исследование уточняет границы применимости результатов некоторых
популярных статей: <a href="https://arxiv.org/abs/1704.06369"
rel="noopener noreferrer nofollow" target="_blank">NormFace: L2
Hypersphere Embedding for Face Verification</a> (930 цитирований),
<a href="https://arxiv.org/abs/2406.16468"
rel="noopener noreferrer nofollow" target="_blank">The Hidden Pitfalls
of the Cosine Similarity Loss</a> (5 цитирований) и
<a href="https://arxiv.org/abs/2502.09252"
rel="noopener noreferrer nofollow" target="_blank">On the Importance of
Embedding Norms in Self-Supervised Learning</a> (2 цитирования). Я
аналитически вывожу условия, при которых в процессе обучения моделей
эмбеддинги объектов движутся ортогонально и при которых проявляется
эффект popularity bias — корреляция норм эмбеддингов айтемов с
популярностью айтемов.

В конце статьи я покажу результаты экспериментов, подтверждающие
сказанное, а также там будут воспроизводимые примеры кода
соответствующих экспериментов.

### Одна формула, на которой строится весь анализ

Формулы обратного распространения ошибки

<div class="spoiler__content">

Определим общий вид модели, процесс обучения которой нас интересует: это
двухбашенная нейронная сеть, у которой есть левая башня (левый энкодер)
и правая башня (правый энкодер), которые разделены и не имеют общих
параметров. Очень часто решают задачу выучивания эмбеддингов именно с
помощью такой модели: выход левой башни приближается или отдаляется
относительно выхода правой башни (например, используя функцию потерь, в
которой мы минимизируем/максимизируем скалярное произведение эмбеддинга
юзера и эмбеддинга купленного товара — выходов левого и правого
энкодеров).

*Самый простой пример такой модели — Alternating Least Squares, где
левый и правый энкодер являются просто матрицами юзерных и айтемных
эмбеддингов. Мы же начнём рассматривать общую теорию для энкодеров любой
архитектуры. По ходу повествования будем вводить дополнительные
ограничения на архитектуру — в тех местах, где дальнейшая математика
невозможна без таких ограничений.*

Такие модели обучаются методом обратного распространения ошибки.
Согласно общей теории, как работает этот метод
(<a href="https://studylib.net/doc/25662142/goodfellow-deep-learning"
rel="noopener noreferrer nofollow" target="_blank">раздел 6.5.2 в книге
Deep Learning Textbook</a>), для конкретно взятого энкодера (неважно,
левого или правого) мы можем посмотреть, как там считаются формулы для
обновления его параметров:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/0c3119c33196c1c3730fbe5dbf476f58.svg"
class="formula"
data-source="\begin{align} g_j         &amp;= \frac{\partial \mathcal{L}}{\partial q_j}       &amp;&amp; \text{(градиент лосса по выходу энкодера $q_{j}$ - т.е. по выходу энкодера для j-го примера в батче)} \\[6pt] J_j         &amp;= \frac{\partial q_j}{\partial \theta}            &amp;&amp; \text{(Якобиан выхода $q_{j}$ по всем параметрам энкодера $\theta$)} \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/0c3/119/c33/0c3119c33196c1c3730fbe5dbf476f58.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/0c3/119/c33/0c3119c33196c1c3730fbe5dbf476f58.svg 781w"
loading="lazy" data-decode="async" width="769" height="110"
alt="\begin{align} g_j &amp;= \frac{\partial \mathcal{L}}{\partial q_j} &amp;&amp; \text{(градиент лосса по выходу энкодера $q_{j}$ - т.е. по выходу энкодера для j-го примера в батче)} \\[6pt] J_j &amp;= \frac{\partial q_j}{\partial \theta} &amp;&amp; \text{(Якобиан выхода $q_{j}$ по всем параметрам энкодера $\theta$)} \end{align}" />

Отсюда понятно, как выглядит формула градиента лосса по параметрам
энкодера:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/9b0291f33de97f2dab205c48bf73186c.svg"
class="formula"
data-source="\begin{align} g_{\theta} \;=\; \sum_{j}\frac{\partial q_j}{\partial \theta}\frac{\partial \mathcal{L}}{\partial q_j} \;=\; \sum_{j} J_{j}^{\!\top} \, g_{j} \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/9b0/291/f33/9b0291f33de97f2dab205c48bf73186c.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/9b0/291/f33/9b0291f33de97f2dab205c48bf73186c.svg 781w"
loading="lazy" data-decode="async" width="273" height="58"
alt="\begin{align} g_{\theta} \;=\; \sum_{j}\frac{\partial q_j}{\partial \theta}\frac{\partial \mathcal{L}}{\partial q_j} \;=\; \sum_{j} J_{j}^{\!\top} \, g_{j} \end{align}" />

То есть в результате SGD-шага на этом батче мы получим следующее
изменение параметров энкодера:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/b5e27f397cfeb5904c8171413f4fe0b1.svg"
class="formula"
data-source="\begin{align} \Delta\theta \;=\; -\eta\,g_{\theta} \;=\; -\eta \sum_{j} J_{j}^{\!\top} \, g_{j} \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/b5e/27f/397/b5e27f397cfeb5904c8171413f4fe0b1.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/b5e/27f/397/b5e27f397cfeb5904c8171413f4fe0b1.svg 781w"
loading="lazy" data-decode="async" width="254" height="48"
alt="\begin{align} \Delta\theta \;=\; -\eta\,g_{\theta} \;=\; -\eta \sum_{j} J_{j}^{\!\top} \, g_{j} \end{align}" />

</div>

Мы описали, как совокупность всех примеров в батче влияет на изменение
параметров энкодера. Теперь посмотрим, как это изменение повлияет на
выход энкодера для конкретного <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/e0b94b29da831ccfeb1950872e30ffe0.svg"
class="formula inline" data-source="i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/e0b/94b/29d/e0b94b29da831ccfeb1950872e30ffe0.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/e0b/94b/29d/e0b94b29da831ccfeb1950872e30ffe0.svg 781w"
loading="lazy" data-decode="async" width="7" height="16" alt="i" />-го
примера в батче. Выразим это в виде линейной аппроксимации первого
порядка:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/bdfcf130d77cb395972314bfbb5b4168.svg"
class="formula"
data-source="\begin{align} \boxed{\; \Delta q_{i} \;=\; J_{i}\,\Delta\theta \;=\; -\eta\,\sum_{j} J_{i}\,J_{j}^{\!\top}\,g_{j} \;} \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/formulas/b/bd/bdf/bdfcf130d77cb395972314bfbb5b4168.svg 780w,
       https://habrastorage.org/getpro/habr/formulas/b/bd/bdf/bdfcf130d77cb395972314bfbb5b4168.svg 781w"
loading="lazy" data-decode="async" width="272" height="48"
alt="\begin{align} \boxed{\; \Delta q_{i} \;=\; J_{i}\,\Delta\theta \;=\; -\eta\,\sum_{j} J_{i}\,J_{j}^{\!\top}\,g_{j} \;} \end{align}" />

Именно эта формула является отправной точкой дальнейшего анализа.

### Первый важный вывод про процесс изменения эмбеддингов

Исследуем popularity bias только для энкодеров, линейных по параметрам

<div class="spoiler__content">

Для начала заметим, что формула выше, описывающая изменение эмбеддинга в
процессе обучения, является линейной аппроксимацией. То есть получить
строгий аналитический вывод, при выполнении каких факторов будет
наблюдаться popularity bias (в данном контексте под этим термином я
подразумеваю корреляцию норм эмбеддингов с популярностью айтемов), мы
можем только для линейных по параметрам архитектур энкодеров, потому что
именно для них эта линейная аппроксимация совпадает с точным изменением
эмбеддинга.

</div>

### Что такое энкодер, линейный по параметрам

Это энкодер, у которого Якобиан выхода J не зависит от θ

<div class="spoiler__content">

Для ясности определений: назовём <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/6646b1de951be38fc1c8cf9cf14a2f10.svg"
class="formula inline" data-source="q_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/664/6b1/de9/6646b1de951be38fc1c8cf9cf14a2f10.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/664/6b1/de9/6646b1de951be38fc1c8cf9cf14a2f10.svg 781w"
loading="lazy" data-decode="async" width="15" height="15" alt="q_i" />
как <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/7dfe62ac89cb6223677e457e079973bd.svg"
class="formula inline" data-source="q(\theta, x_i)"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/7df/e62/ac8/7dfe62ac89cb6223677e457e079973bd.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/7df/e62/ac8/7dfe62ac89cb6223677e457e079973bd.svg 781w"
loading="lazy" data-decode="async" width="60" height="22"
alt="q(\theta, x_i)" /> — выход энкодера c параметрами <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/b127837fb746c8a779b26b5069e8038f.svg"
class="formula inline" data-source="\theta"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/b12/783/7fb/b127837fb746c8a779b26b5069e8038f.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/b12/783/7fb/b127837fb746c8a779b26b5069e8038f.svg 781w"
loading="lazy" data-decode="async" width="9" height="17" alt="\theta" />
для <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/32be063deddaed36dc0322640cb0e9b6.svg"
class="formula inline" data-source="i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/32b/e06/3de/32be063deddaed36dc0322640cb0e9b6.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/32b/e06/3de/32be063deddaed36dc0322640cb0e9b6.svg 781w"
loading="lazy" data-decode="async" width="7" height="16" alt="i" />-го
объекта, <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/a3ece4a936e5456ee6115a5505006dc0.svg"
class="formula inline" data-source="J_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/a3e/ce4/a93/a3ece4a936e5456ee6115a5505006dc0.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/a3e/ce4/a93/a3ece4a936e5456ee6115a5505006dc0.svg 781w"
loading="lazy" data-decode="async" width="18" height="20" alt="J_i" /> —
как <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/62bb81391f87bc761a68620e9f3e8082.svg"
class="formula inline" data-source="J(x_i)"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/62b/b81/391/62bb81391f87bc761a68620e9f3e8082.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/62b/b81/391/62bb81391f87bc761a68620e9f3e8082.svg 781w"
loading="lazy" data-decode="async" width="46" height="22"
alt="J(x_i)" />.

Мы будем считать энкодер линейным по параметрам, если его выход для
любого входного примера <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/c42a77cd0b94bf5d60376209c914864c.svg"
class="formula inline" data-source="i​"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/c42/a77/cd0/c42a77cd0b94bf5d60376209c914864c.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/c42/a77/cd0/c42a77cd0b94bf5d60376209c914864c.svg 781w"
loading="lazy" data-decode="async" width="7" height="16" alt="i​" />
можно записать как:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/711608311c891530bd3d943f49514e5c.svg"
class="formula"
data-source="q(\theta, x_i) = J(x_i)\theta \quad \text{($x_i$ — признаковое описание примера $i$)}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/711/608/311/711608311c891530bd3d943f49514e5c.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/711/608/311/711608311c891530bd3d943f49514e5c.svg 781w"
loading="lazy" data-decode="async" width="452" height="27"
alt="q(\theta, x_i) = J(x_i)\theta \quad \text{($x_i$ — признаковое описание примера $i$)}" />

где матрица <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/06bf8725884a6f6b1f613b3d56a2b9d5.svg"
class="formula inline" data-source="J"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/06b/f87/258/06bf8725884a6f6b1f613b3d56a2b9d5.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/06b/f87/258/06bf8725884a6f6b1f613b3d56a2b9d5.svg 781w"
loading="lazy" data-decode="async" width="12" height="17" alt="J" />
зависит только от входа (и, возможно, от фиксированных гиперпараметров),
но не зависит от параметров <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/e9dfbb8d54cf6f49e017525e21b48547.svg"
class="formula inline" data-source="θ"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/e9d/fbb/8d5/e9dfbb8d54cf6f49e017525e21b48547.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/e9d/fbb/8d5/e9dfbb8d54cf6f49e017525e21b48547.svg 781w"
loading="lazy" data-decode="async" width="9" height="17" alt="θ" />.

При таком определении <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/58454fa60f640542de06a6b6091a6df0.svg"
class="formula inline" data-source="J"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/584/54f/a60/58454fa60f640542de06a6b6091a6df0.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/584/54f/a60/58454fa60f640542de06a6b6091a6df0.svg 781w"
loading="lazy" data-decode="async" width="12" height="17" alt="J" />
остается константой на всем пространстве параметров. То есть формула
<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/73396fa70c532d444b0657fe5bf06999.svg"
class="formula inline" data-source="\Delta q_{i}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/733/96f/a70/73396fa70c532d444b0657fe5bf06999.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/733/96f/a70/73396fa70c532d444b0657fe5bf06999.svg 781w"
loading="lazy" data-decode="async" width="32" height="21"
alt="\Delta q_{i}" /> выше является уже не просто линейной
аппроксимацией, а точной формулой изменения <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/fa7831cdde703ac2c689f0e5964822db.svg"
class="formula inline" data-source="q_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/fa7/831/cdd/fa7831cdde703ac2c689f0e5964822db.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/fa7/831/cdd/fa7831cdde703ac2c689f0e5964822db.svg 781w"
loading="lazy" data-decode="async" width="15" height="15" alt="q_i" />.
На её основе можно строить дальнейший анализ.

</div>

### Какие архитектуры можно считать линейными по параметрам?

Рассмотрим примеры архитектур, в которых J не зависит от параметров
энкодера θ:

1\. Энкодер состоит из единственного embedding-слоя

<div class="spoiler__content">

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/7406be37db10554a5948af151369689a.svg"
class="formula"
data-source="\begin{align}  &amp;\textbf{Вход:}\;\; x_i = i \in\{1,\dots,N\} \qquad \text{($x_i$ - просто индекс i-го объекта)}  \\[6pt]  &amp;\textbf{Параметры:}\quad  E\in\mathbb{R}^{N\times d}, \qquad  \theta=E, \qquad  \theta_{i,n} = E_{i,n} \\ &amp;\text{(В формуле выше $n$ - столбец в матрице эмбеддингов)}  \\[6pt]  &amp;\textbf{Выход:}\quad  q(\theta,x_i)=E_i\;\in\mathbb{R}^{d}, \qquad  q_i = q(\theta,x_i)  \\[6pt]  &amp;\text{Пусть $m$ - координата выходного эмбеддинга $q$,} \\ &amp;\text{$i&#39;$ и $n&#39;$ — произвольные индексы строки/столбца, по} \\ &amp;\text{которым берется производная (они «бегают» по всем} \\ &amp;\text{параметрам). Также «вытянем» $\theta$ из матрицы} \\ &amp;\text{в вектор длины ${N * d}$.}  \\[6pt]  &amp;\textbf{Тогда:}\quad  J_i = \frac{\partial q_i}{\partial \theta} \;=\; \begin{cases} 1, &amp; \text{если $i&#39;= i, n&#39;= m$} \\[4pt] 0, &amp; \text{иначе}. \end{cases}  \\[6pt]  &amp;\text{$J_i$ - это таблица $d \times (N * d)$, показывающая,} \\ &amp;\text{как поменяется каждая координата выхода,} \\ &amp;\text{если чуть-чуть подвинуть каждый параметр $\theta$} \\ &amp;\text{при зафиксированном входе $x_i$.}  \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/740/6be/37d/7406be37db10554a5948af151369689a.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/740/6be/37d/7406be37db10554a5948af151369689a.svg 781w"
loading="lazy" data-decode="async" width="502" height="518"
alt="\begin{align} &amp;\textbf{Вход:}\;\; x_i = i \in\{1,\dots,N\} \qquad \text{($x_i$ - просто индекс i-го объекта)} \\[6pt] &amp;\textbf{Параметры:}\quad E\in\mathbb{R}^{N\times d}, \qquad \theta=E, \qquad \theta_{i,n} = E_{i,n} \\ &amp;\text{(В формуле выше $n$ - столбец в матрице эмбеддингов)} \\[6pt] &amp;\textbf{Выход:}\quad q(\theta,x_i)=E_i\;\in\mathbb{R}^{d}, \qquad q_i = q(\theta,x_i) \\[6pt] &amp;\text{Пусть $m$ - координата выходного эмбеддинга $q$,} \\ &amp;\text{$i&#39;$ и $n&#39;$ — произвольные индексы строки/столбца, по} \\ &amp;\text{которым берется производная (они «бегают» по всем} \\ &amp;\text{параметрам). Также «вытянем» $\theta$ из матрицы} \\ &amp;\text{в вектор длины ${N * d}$.} \\[6pt] &amp;\textbf{Тогда:}\quad J_i = \frac{\partial q_i}{\partial \theta} \;=\; \begin{cases} 1, &amp; \text{если $i&#39;= i, n&#39;= m$} \\[4pt] 0, &amp; \text{иначе}. \end{cases} \\[6pt] &amp;\text{$J_i$ - это таблица $d \times (N * d)$, показывающая,} \\ &amp;\text{как поменяется каждая координата выхода,} \\ &amp;\text{если чуть-чуть подвинуть каждый параметр $\theta$} \\ &amp;\text{при зафиксированном входе $x_i$.} \end{align}" />

В этом случае в <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/3a5a3e8fb4d031e7cb204a45b35661d0.svg"
class="formula inline" data-source="J_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/3a5/a3e/8fb/3a5a3e8fb4d031e7cb204a45b35661d0.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/3a5/a3e/8fb/3a5a3e8fb4d031e7cb204a45b35661d0.svg 781w"
loading="lazy" data-decode="async" width="18" height="20" alt="J_i" />
везде, кроме столбцов \<<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/3dca3b574ed2902013be54545470f2c2.svg"
class="formula inline" data-source="i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/3dc/a3b/574/3dca3b574ed2902013be54545470f2c2.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/3dc/a3b/574/3dca3b574ed2902013be54545470f2c2.svg 781w"
loading="lazy" data-decode="async" width="7" height="16" alt="i" />-ый
эмбеддинг, <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/69b63d8439b0beb34346c95a73a059c3.svg"
class="formula inline" data-source="n"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/69b/63d/843/69b63d8439b0beb34346c95a73a059c3.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/69b/63d/843/69b63d8439b0beb34346c95a73a059c3.svg 781w"
loading="lazy" data-decode="async" width="12" height="12" alt="n" />-ая
координата\>, стоят нули, а в блоке из этих столбцов — единичная
матрица:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/516b0d2b0b49a1de037be37f434a895e.svg"
class="formula"
data-source="\begin{align} J_i \;=\; \Bigl[\, \underbrace{0_{d\times (i-1)d}}_{\substack{\text{параметры}\\ 1\ldots(i-1)}} \;\Big|\; \underbrace{I_d}_{\substack{\text{параметры}\\ i\text{-й строки}}} \;\Big|\; \underbrace{0_{d\times (N-i)d}}_{\substack{\text{параметры}\\ (i+1)\ldots N}} \Bigr]. \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/516/b0d/2b0/516b0d2b0b49a1de037be37f434a895e.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/516/b0d/2b0/516b0d2b0b49a1de037be37f434a895e.svg 781w"
loading="lazy" data-decode="async" width="321" height="85"
alt="\begin{align} J_i \;=\; \Bigl[\, \underbrace{0_{d\times (i-1)d}}_{\substack{\text{параметры}\\ 1\ldots(i-1)}} \;\Big|\; \underbrace{I_d}_{\substack{\text{параметры}\\ i\text{-й строки}}} \;\Big|\; \underbrace{0_{d\times (N-i)d}}_{\substack{\text{параметры}\\ (i+1)\ldots N}} \Bigr]. \end{align}" />

</div>

2\. Энкодер состоит из единственного линейного слоя (без bias)

<div class="spoiler__content">

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/a1f32c5e14336bd596e41fccaaa6c385.svg"
class="formula"
data-source="\begin{align} &amp;\textbf{Вход:}\;\;  x_i \;=\; (x_{i,1},\dots,x_{i,h})^{\!\top}  \in\! \mathbb{R}^{h} \qquad \text{($x_i$ ‒ вектор признаков объекта $i$)} \\[8pt]  &amp;\textbf{Параметры:}\quad  W \in \mathbb{R}^{d \times h},  \qquad  \theta = W, \qquad \theta_{m,n} = W_{m,n} \\ &amp;\text{(В формуле выше $m$ ‒ строка, выходы; $n$ ‒ столбец, признаки)} \\[8pt]  &amp;\textbf{Выход:}\quad  q(\theta,x_i)\;=\;W\,x_i \;\in\; \mathbb{R}^{d}, \qquad  q_i = q(\theta,x_i) \\[8pt]  &amp;\text{Пусть $m$ ‒ координата выходного вектора $q_i$,} \\ &amp;\text{$m&#39;$ и $n&#39;$ ‒ произвольные индексы строки/столбца, по} \\ &amp;\text{которым берётся производная (они «бегают» по всем} \\ &amp;\text{параметрам). Также «вытянем» $\theta$ из матрицы} \\ &amp;\text{в вектор длиной $d * h$.} \\[8pt]  &amp;\textbf{Тогда:}\quad J_i \;=\; \frac{\partial q_i}{\partial \theta} \;=\; \begin{cases} x_{i,n&#39;}, &amp; \text{если $m&#39; = m$} \\[6pt] 0,        &amp; \text{иначе}. \end{cases} \\[8pt]  &amp;\text{$J_i$ ‒ это таблица $d \times (d * h)$, показывающая,} \\ &amp;\text{как изменится каждая координата выхода,} \\ &amp;\text{если чуть-чуть подвинуть каждый параметр $\theta$} \\ &amp;\text{при зафиксированном входе $x_i$. } \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/a1f/32c/5e1/a1f32c5e14336bd596e41fccaaa6c385.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/a1f/32c/5e1/a1f32c5e14336bd596e41fccaaa6c385.svg 781w"
loading="lazy" data-decode="async" width="568" height="542"
alt="\begin{align} &amp;\textbf{Вход:}\;\; x_i \;=\; (x_{i,1},\dots,x_{i,h})^{\!\top} \in\! \mathbb{R}^{h} \qquad \text{($x_i$ ‒ вектор признаков объекта $i$)} \\[8pt] &amp;\textbf{Параметры:}\quad W \in \mathbb{R}^{d \times h}, \qquad \theta = W, \qquad \theta_{m,n} = W_{m,n} \\ &amp;\text{(В формуле выше $m$ ‒ строка, выходы; $n$ ‒ столбец, признаки)} \\[8pt] &amp;\textbf{Выход:}\quad q(\theta,x_i)\;=\;W\,x_i \;\in\; \mathbb{R}^{d}, \qquad q_i = q(\theta,x_i) \\[8pt] &amp;\text{Пусть $m$ ‒ координата выходного вектора $q_i$,} \\ &amp;\text{$m&#39;$ и $n&#39;$ ‒ произвольные индексы строки/столбца, по} \\ &amp;\text{которым берётся производная (они «бегают» по всем} \\ &amp;\text{параметрам). Также «вытянем» $\theta$ из матрицы} \\ &amp;\text{в вектор длиной $d * h$.} \\[8pt] &amp;\textbf{Тогда:}\quad J_i \;=\; \frac{\partial q_i}{\partial \theta} \;=\; \begin{cases} x_{i,n&#39;}, &amp; \text{если $m&#39; = m$} \\[6pt] 0, &amp; \text{иначе}. \end{cases} \\[8pt] &amp;\text{$J_i$ ‒ это таблица $d \times (d * h)$, показывающая,} \\ &amp;\text{как изменится каждая координата выхода,} \\ &amp;\text{если чуть-чуть подвинуть каждый параметр $\theta$} \\ &amp;\text{при зафиксированном входе $x_i$. } \end{align}" />

В этом случае в <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/ac6835103a52c70ebf31333bc76ce375.svg"
class="formula inline" data-source="J_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/ac6/835/103/ac6835103a52c70ebf31333bc76ce375.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/ac6/835/103/ac6835103a52c70ebf31333bc76ce375.svg 781w"
loading="lazy" data-decode="async" width="18" height="20" alt="J_i" /> в
каждом из <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/ac0b812d4dc9d75aa9c3fb4c88df03f2.svg"
class="formula inline" data-source="d"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/ac0/b81/2d4/ac0b812d4dc9d75aa9c3fb4c88df03f2.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/ac0/b81/2d4/ac0b812d4dc9d75aa9c3fb4c88df03f2.svg 781w"
loading="lazy" data-decode="async" width="10" height="17" alt="d" />
блоков (ширины <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/3191fef532d64e4cecd4b389ee1265fa.svg"
class="formula inline" data-source="h"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/319/1fe/f53/3191fef532d64e4cecd4b389ee1265fa.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/319/1fe/f53/3191fef532d64e4cecd4b389ee1265fa.svg 781w"
loading="lazy" data-decode="async" width="11" height="17" alt="h" />) на
строке <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/003516e1f0ecf40543c5fa5c5fed2b8b.svg"
class="formula inline" data-source="m"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/003/516/e1f/003516e1f0ecf40543c5fa5c5fed2b8b.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/003/516/e1f/003516e1f0ecf40543c5fa5c5fed2b8b.svg 781w"
loading="lazy" data-decode="async" width="17" height="12" alt="m" />
стоит копия вектора <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/3bab563c555a00de2ea6fa4a3b3958ba.svg"
class="formula inline" data-source="x_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/3ba/b56/3c5/3bab563c555a00de2ea6fa4a3b3958ba.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/3ba/b56/3c5/3bab563c555a00de2ea6fa4a3b3958ba.svg 781w"
loading="lazy" data-decode="async" width="18" height="15" alt="x_i" />;
все остальные элементы нулевые:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/fc6c25ca414ed576cc8994f538880df5.svg"
class="formula"
data-source="\begin{align} J_i \;=\; \operatorname{diag}\!\bigl(   \underbrace{x_i^{\!\top},\;x_i^{\!\top},\;\dots,\;x_i^{\!\top}}_{d\ \text{раз}} \bigr) \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/fc6/c25/ca4/fc6c25ca414ed576cc8994f538880df5.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/fc6/c25/ca4/fc6c25ca414ed576cc8994f538880df5.svg 781w"
loading="lazy" data-decode="async" width="242" height="62"
alt="\begin{align} J_i \;=\; \operatorname{diag}\!\bigl( \underbrace{x_i^{\!\top},\;x_i^{\!\top},\;\dots,\;x_i^{\!\top}}_{d\ \text{раз}} \bigr) \end{align}" />

Если присутствует bias, то к <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/8b39913d47fc09133f18092d401aa2b7.svg"
class="formula inline" data-source="J_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/8b3/991/3d4/8b39913d47fc09133f18092d401aa2b7.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/8b3/991/3d4/8b39913d47fc09133f18092d401aa2b7.svg 781w"
loading="lazy" data-decode="async" width="18" height="20" alt="J_i" />
просто приклеивается справа единичная матрица.

</div>

### Пример архитектуры, которая не является линейной по параметрам

Энкодер состоит из двух последовательно идущих линейных слоёв (без bias)

<div class="spoiler__content">

Посмотрим на энкодер, состоящий из двух последовательно идущих линейных
слоёв (без bias):

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/db9b6d254672d7d5b6fbd84b2e07a001.svg"
class="formula"
data-source="\begin{align} &amp;\textbf{Вход:}\;\; x_i       = (x_{i,1},\dots,x_{i,h})^{\!\top}       \in\mathbb{R}^{h} \qquad \text{($x_i$ — вектор признаков объекта $i$)} \\[8pt]  &amp;\textbf{Параметры:}\; A\in\mathbb{R}^{d_1\times h}, \;B\in\mathbb{R}^{d_2\times d_1}, \quad \theta=\{A,B\}, \\ &amp;\quad \theta^{(A)}_{r,s}=A_{r,s}, \; \theta^{(B)}_{m,n}=B_{m,n} \qquad \text{($r$ — «скрытая» координата, $m$ — выходная)} \\[12pt]  &amp;\textbf{Выход:}\quad z_i = A\,x_i \in\mathbb{R}^{d_1}, \qquad q_i       = q(\theta,x_i)       = B\,z_i       \in\mathbb{R}^{d_2} \\[12pt]  &amp;\text{Пусть $m$ — координата выходного вектора $q_i$,}\\ &amp;\text{$\;\;m&#39;,n&#39;$ — произвольные индексы строки/столбца в $B$,}\\ &amp;\text{$\;\;r&#39;,s&#39;$ — индексы строки/столбца в $A$.} \\[8pt]  &amp;\textbf{Якобиан по $B$:}\quad \frac{\partial q_{i,m}}{\partial B_{m&#39;,n&#39;}} = \begin{cases} z_{i,n&#39;}, &amp; m&#39;=m,\\[4pt] 0,        &amp; \text{иначе}. \end{cases} \\[10pt]  &amp;\textbf{Якобиан по $A$:}\quad \frac{\partial q_{i,m}}{\partial A_{r&#39;,s&#39;}} = B_{m,r&#39;}\,x_{i,s&#39;} . \\[10pt]  &amp;\text{Итого }J_i    =\bigl[\;J^{(B)}_i \;\big|\; J^{(A)}_i\bigr], \text{ где} \\ &amp;J^{(B)}_i\in\mathbb{R}^{d_2\times(d_2d_1)}    \text{ имеет в каждом из $d_2$ блоков ширины $d_1$ строку }z_i^{\!\top}, \\ &amp;J^{(A)}_i\in\mathbb{R}^{d_2\times(d_1h)}    \text{ состоит из $d_1h$ столбцов вида }B_{:,r&#39;}\,x_{i,s&#39;}. \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/db9/b6d/254/db9b6d254672d7d5b6fbd84b2e07a001.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/db9/b6d/254/db9b6d254672d7d5b6fbd84b2e07a001.svg 781w"
loading="lazy" data-decode="async" width="603" height="552"
alt="\begin{align} &amp;\textbf{Вход:}\;\; x_i = (x_{i,1},\dots,x_{i,h})^{\!\top} \in\mathbb{R}^{h} \qquad \text{($x_i$ — вектор признаков объекта $i$)} \\[8pt] &amp;\textbf{Параметры:}\; A\in\mathbb{R}^{d_1\times h}, \;B\in\mathbb{R}^{d_2\times d_1}, \quad \theta=\{A,B\}, \\ &amp;\quad \theta^{(A)}_{r,s}=A_{r,s}, \; \theta^{(B)}_{m,n}=B_{m,n} \qquad \text{($r$ — «скрытая» координата, $m$ — выходная)} \\[12pt] &amp;\textbf{Выход:}\quad z_i = A\,x_i \in\mathbb{R}^{d_1}, \qquad q_i = q(\theta,x_i) = B\,z_i \in\mathbb{R}^{d_2} \\[12pt] &amp;\text{Пусть $m$ — координата выходного вектора $q_i$,}\\ &amp;\text{$\;\;m&#39;,n&#39;$ — произвольные индексы строки/столбца в $B$,}\\ &amp;\text{$\;\;r&#39;,s&#39;$ — индексы строки/столбца в $A$.} \\[8pt] &amp;\textbf{Якобиан по $B$:}\quad \frac{\partial q_{i,m}}{\partial B_{m&#39;,n&#39;}} = \begin{cases} z_{i,n&#39;}, &amp; m&#39;=m,\\[4pt] 0, &amp; \text{иначе}. \end{cases} \\[10pt] &amp;\textbf{Якобиан по $A$:}\quad \frac{\partial q_{i,m}}{\partial A_{r&#39;,s&#39;}} = B_{m,r&#39;}\,x_{i,s&#39;} . \\[10pt] &amp;\text{Итого }J_i =\bigl[\;J^{(B)}_i \;\big|\; J^{(A)}_i\bigr], \text{ где} \\ &amp;J^{(B)}_i\in\mathbb{R}^{d_2\times(d_2d_1)} \text{ имеет в каждом из $d_2$ блоков ширины $d_1$ строку }z_i^{\!\top}, \\ &amp;J^{(A)}_i\in\mathbb{R}^{d_2\times(d_1h)} \text{ состоит из $d_1h$ столбцов вида }B_{:,r&#39;}\,x_{i,s&#39;}. \end{align}" />

Выходит, что два линейных слоя — это нелинейная по параметрам модель.

Это линейная по входу модель (linear_layer\_№1 \* linear_layer\_№2 \* x
= linear_layer\_№3 \* x). Но если держать в голове то, о чем нам говорит
Якобиан (насколько сдвинется выход, если немного подвинуть параметр), то
несложно догадаться, что если мы подвинем вес в первом линейном слое, то
на выходе это скажется как-то с учетом весов второго линейного слоя:
между первым слоем и выходом как раз находится домножение на эту матрицу
второго линейного слоя. А раз матрица <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/d4b69a39adce0a1768408e4d22d0b704.svg"
class="formula inline" data-source="J"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/d4b/69a/39a/d4b69a39adce0a1768408e4d22d0b704.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/d4b/69a/39a/d4b69a39adce0a1768408e4d22d0b704.svg 781w"
loading="lazy" data-decode="async" width="12" height="17" alt="J" />
зависит от параметров, значит, что такая архитектура не является
линейной по параметрам и мы не можем получить строгий аналитический
вывод про popularity bias.

</div>

### Для некоторых линейных архитектур изменение эмбеддинга коллинеарно градиенту лосса по выходу

Для этого входы должны быть ортогональны

<div class="spoiler__content">

Вспомним формулу изменения эмбеддинга для энкодеров, линейных по
параметрам:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/53e79ebb9aa35133116bda7114fe5e26.svg"
class="formula"
data-source="\begin{align} \Delta q_{i} \;=\; J_{i}\,\Delta\theta \;=\; -\eta\,\sum_{j} J_{i}\,J_{j}^{\!\top}\,g_{j} \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/53e/79e/bb9/53e79ebb9aa35133116bda7114fe5e26.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/53e/79e/bb9/53e79ebb9aa35133116bda7114fe5e26.svg 781w"
loading="lazy" data-decode="async" width="285" height="48"
alt="\begin{align} \Delta q_{i} \;=\; J_{i}\,\Delta\theta \;=\; -\eta\,\sum_{j} J_{i}\,J_{j}^{\!\top}\,g_{j} \end{align}" />

После изучения, как именно выглядят Якобианы для некоторых примеров
архитектур, становится понятно их свойство, при котором эмбеддинг будет
двигаться коллинеарно его градиенту (<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/e75845ce83345ebca2c198a616dcaa2d.svg"
class="formula inline" data-source="\Delta q_{i}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/formulas/e/e7/e75/e75845ce83345ebca2c198a616dcaa2d.svg 780w,
       https://habrastorage.org/getpro/habr/formulas/e/e7/e75/e75845ce83345ebca2c198a616dcaa2d.svg 781w"
loading="lazy" data-decode="async" width="24" height="16"
alt="\Delta q_{i}" /> \|\| <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/91d8947f9447751708c1f4107beb7ab3.svg"
class="formula inline" data-source="g_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/formulas/9/91/91d/91d8947f9447751708c1f4107beb7ab3.svg 780w,
       https://habrastorage.org/getpro/habr/formulas/9/91/91d/91d8947f9447751708c1f4107beb7ab3.svg 781w"
loading="lazy" data-decode="async" width="12" height="12" alt="g_i" />):
**важно, чтобы в модели у каждого уникального входа была «собственная»
строка параметров, которая не пересекается c чужими.** Это просто
понять, если посмотреть на примеры.

Рассмотрим случай с единственным embedding-слоем:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/78ae813ebb66eb5d9fc678f591c04e77.svg"
class="formula"
data-source="\begin{align} J_{i}\,J_{j}^{\!\top}\ = \begin{cases} I_d, &amp; \text{если $x_i = x_j$} \\[4pt] 0, &amp; \text{иначе}. \end{cases} \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/78a/e81/3eb/78ae813ebb66eb5d9fc678f591c04e77.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/78a/e81/3eb/78ae813ebb66eb5d9fc678f591c04e77.svg 781w"
loading="lazy" data-decode="async" width="244" height="64"
alt="\begin{align} J_{i}\,J_{j}^{\!\top}\ = \begin{cases} I_d, &amp; \text{если $x_i = x_j$} \\[4pt] 0, &amp; \text{иначе}. \end{cases} \end{align}" />

Шаг SGD:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/a32b773e7b1438fba9908775d4e509bd.svg"
class="formula"
data-source="\begin{align} \Delta q_{i} \;=\; -\eta\,c_i\,g_{i} \qquad  \text{($c_i$ - сколько раз $x_i$ встретился в батче)} \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/a32/b77/3e7/a32b773e7b1438fba9908775d4e509bd.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/a32/b77/3e7/a32b773e7b1438fba9908775d4e509bd.svg 781w"
loading="lazy" data-decode="async" width="464" height="28"
alt="\begin{align} \Delta q_{i} \;=\; -\eta\,c_i\,g_{i} \qquad \text{($c_i$ - сколько раз $x_i$ встретился в батче)} \end{align}" />

Теперь случай с линейным слоем без bias:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/29786b794e712db0c1020c8c4a9bac64.svg"
class="formula"
data-source="\begin{align} J_{i}\,J_{j}^{\!\top}\ = (x_i^{\!\top} x_j) I_d \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/297/86b/794/29786b794e712db0c1020c8c4a9bac64.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/297/86b/794/29786b794e712db0c1020c8c4a9bac64.svg 781w"
loading="lazy" data-decode="async" width="153" height="28"
alt="\begin{align} J_{i}\,J_{j}^{\!\top}\ = (x_i^{\!\top} x_j) I_d \end{align}" />

Шаг SGD:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/5ca5747424669f21a53149c21843ab88.svg"
class="formula"
data-source="\begin{align} \Delta q_{i} \;=\; -\eta\,\sum_{j}(x_i^{\!\top} x_j)\,g_{j} \;=\; -\eta\, \underbrace{\|x_i\|^2\,g_i}_{\text{собств. вклад}} \;-\; \eta\, \underbrace{\sum_{j\neq i}(x_i^{\!\top}x_j)\,g_j}_{\text{вклад остальных}} \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/5ca/574/742/5ca5747424669f21a53149c21843ab88.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/5ca/574/742/5ca5747424669f21a53149c21843ab88.svg 781w"
loading="lazy" data-decode="async" width="494" height="86"
alt="\begin{align} \Delta q_{i} \;=\; -\eta\,\sum_{j}(x_i^{\!\top} x_j)\,g_{j} \;=\; -\eta\, \underbrace{\|x_i\|^2\,g_i}_{\text{собств. вклад}} \;-\; \eta\, \underbrace{\sum_{j\neq i}(x_i^{\!\top}x_j)\,g_j}_{\text{вклад остальных}} \end{align}" />

Из-за того, что разные входы в энкодер проходят через одни и те же
параметры, выход энкодера уже не меняется строго коллинеарно его
градиенту. Но если все <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/e68ae46f08713a5062146d03b5322025.svg"
class="formula inline" data-source="x"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/e68/ae4/6f0/e68ae46f08713a5062146d03b5322025.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/e68/ae4/6f0/e68ae46f08713a5062146d03b5322025.svg 781w"
loading="lazy" data-decode="async" width="11" height="12" alt="x" />
сделать ортогональными друг другу (например, если <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/9090d0613c84356040fabd2424f6bf40.svg"
class="formula inline" data-source="x"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/909/0d0/613/9090d0613c84356040fabd2424f6bf40.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/909/0d0/613/9090d0613c84356040fabd2424f6bf40.svg 781w"
loading="lazy" data-decode="async" width="11" height="12" alt="x" /> —
это one-hot эмбеддинг), то вклад остальных объектов обнулится и будет
коллинеарность. В сущности, nn.Linear над one-hot фичами (без bias в
слое) и nn.Embedding — это одно и то же, если не брать в расчет
производительность (matmul vs lookup).

</div>

### Градиент любого косинусного лосса по выходу энкодера ортогонален ему

Если эмбеддинг объекта фигурирует в лоссе только через косинусы, то
градиент лосса ортогонален этому эмбеддингу

<div class="spoiler__content">

Пусть эмбеддинг <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/0ffc1bb4e774f2eae8a63df4bbea9e26.svg"
class="formula inline" data-source="q"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/0ff/c1b/b4e/0ffc1bb4e774f2eae8a63df4bbea9e26.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/0ff/c1b/b4e/0ffc1bb4e774f2eae8a63df4bbea9e26.svg 781w"
loading="lazy" data-decode="async" width="9" height="15" alt="q" />,
выходящий из энкодера, участвует в лоссе только через косинусные
близости с другими эмбеддингами, порожденными двухбашенной моделью.
Тогда лосс можно записать так:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/e8d5d62c84e6863b6ed48befef6b1d7d.svg"
class="formula"
data-source="\begin{align} &amp;\mathcal L=F\bigl(\cos(q,k_1),\dots,\cos(q,k_r)\bigr) \\ &amp;\text{И тогда его градиент по $q$: } \\ &amp; \nabla_q\mathcal L =\sum_{s=1}^{r}\frac{\partial F}{\partial \cos(q,k_s)}\,       \nabla_q\cos(q,k_s) \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/e8d/5d6/2c8/e8d5d62c84e6863b6ed48befef6b1d7d.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/e8d/5d6/2c8/e8d5d62c84e6863b6ed48befef6b1d7d.svg 781w"
loading="lazy" data-decode="async" width="310" height="116"
alt="\begin{align} &amp;\mathcal L=F\bigl(\cos(q,k_1),\dots,\cos(q,k_r)\bigr) \\ &amp;\text{И тогда его градиент по $q$: } \\ &amp; \nabla_q\mathcal L =\sum_{s=1}^{r}\frac{\partial F}{\partial \cos(q,k_s)}\, \nabla_q\cos(q,k_s) \end{align}" />

Тут производная лосса по косинусу — это какой-то скаляр. Мы сможем
сказать, что градиент лосса по <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/ac9a4b1e2ee13f9c9d00248d87da9557.svg"
class="formula inline" data-source="q"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/ac9/a4b/1e2/ac9a4b1e2ee13f9c9d00248d87da9557.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/ac9/a4b/1e2/ac9a4b1e2ee13f9c9d00248d87da9557.svg 781w"
loading="lazy" data-decode="async" width="9" height="15" alt="q" />
ортогонален <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/66fccf35ce7892de7410cf9d0b31b919.svg"
class="formula inline" data-source="q"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/66f/ccf/35c/66fccf35ce7892de7410cf9d0b31b919.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/66f/ccf/35c/66fccf35ce7892de7410cf9d0b31b919.svg 781w"
loading="lazy" data-decode="async" width="9" height="15" alt="q" />,
если:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/146fe837aac703facf217b696900458c.svg"
class="formula"
data-source="\begin{align} \langle q,\nabla_q\mathcal L\rangle=0 \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/146/fe8/37a/146fe837aac703facf217b696900458c.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/146/fe8/37a/146fe837aac703facf217b696900458c.svg 781w"
loading="lazy" data-decode="async" width="113" height="24"
alt="\begin{align} \langle q,\nabla_q\mathcal L\rangle=0 \end{align}" />

Запишем:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/553dd1cad19d39b0d20829a66021c86f.svg"
class="formula"
data-source="\begin{align} &amp;\langle q,\nabla_q\mathcal L\rangle =\sum_{s=1}^{r}\frac{\partial F}{\partial \cos(q,k_s)}\,       \langle q, \nabla_q\cos(q,k_s)\rangle =       \\&amp;\text{[из Приложения 1 знаем, что $\langle q, \nabla_q\cos(q, *)\rangle = 0$]}        \\&amp;= 0 \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/553/dd1/cad/553dd1cad19d39b0d20829a66021c86f.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/553/dd1/cad/553dd1cad19d39b0d20829a66021c86f.svg 781w"
loading="lazy" data-decode="async" width="397" height="112"
alt="\begin{align} &amp;\langle q,\nabla_q\mathcal L\rangle =\sum_{s=1}^{r}\frac{\partial F}{\partial \cos(q,k_s)}\, \langle q, \nabla_q\cos(q,k_s)\rangle = \\&amp;\text{[из Приложения 1 знаем, что $\langle q, \nabla_q\cos(q, *)\rangle = 0$]} \\&amp;= 0 \end{align}" />

То есть <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/cc1dee62153df36fbff52f722385ca63.svg"
class="formula inline" data-source="q_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/cc1/dee/621/cc1dee62153df36fbff52f722385ca63.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/cc1/dee/621/cc1dee62153df36fbff52f722385ca63.svg 781w"
loading="lazy" data-decode="async" width="15" height="15" alt="q_i" /><img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/bc26dea6c52d78a067e8d44b78934e9e.svg"
class="formula inline" data-source="⊥"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/bc2/6de/a6c/bc26dea6c52d78a067e8d44b78934e9e.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/bc2/6de/a6c/bc26dea6c52d78a067e8d44b78934e9e.svg 781w"
loading="lazy" data-decode="async" width="15" height="17" alt="⊥" />
<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/708bcf2c345e0e384a5e238cc2d7b110.svg"
class="formula inline" data-source="g_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/708/bcf/2c3/708bcf2c345e0e384a5e238cc2d7b110.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/708/bcf/2c3/708bcf2c345e0e384a5e238cc2d7b110.svg 781w"
loading="lazy" data-decode="async" width="16" height="16" alt="g_i" />
для любого косинусного лосса. Это значит, что если <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/31d3b105b208c5117211a5156f1f4e7b.svg"
class="formula inline" data-source="\Delta q_{i}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/31d/3b1/05b/31d3b105b208c5117211a5156f1f4e7b.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/31d/3b1/05b/31d3b105b208c5117211a5156f1f4e7b.svg 781w"
loading="lazy" data-decode="async" width="32" height="21"
alt="\Delta q_{i}" /> \|\| <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/b3ab430e68cf945b0d1291b03dbea36c.svg"
class="formula inline" data-source="g_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/b3a/b43/0e6/b3ab430e68cf945b0d1291b03dbea36c.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/b3a/b43/0e6/b3ab430e68cf945b0d1291b03dbea36c.svg 781w"
loading="lazy" data-decode="async" width="16" height="16" alt="g_i" />,
то <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/65a496529310ab9c15876a70d399c5e5.svg"
class="formula inline" data-source="q_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/65a/496/529/65a496529310ab9c15876a70d399c5e5.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/65a/496/529/65a496529310ab9c15876a70d399c5e5.svg 781w"
loading="lazy" data-decode="async" width="15" height="15" alt="q_i" />
<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/faa491939949f7af0675b22eb11f3650.svg"
class="formula inline" data-source="⊥"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/faa/491/939/faa491939949f7af0675b22eb11f3650.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/faa/491/939/faa491939949f7af0675b22eb11f3650.svg 781w"
loading="lazy" data-decode="async" width="15" height="17" alt="⊥" />
<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/1e76fdc04352df0e792a29f044bb9863.svg"
class="formula inline" data-source="\Delta q_{i}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/1e7/6fd/c04/1e76fdc04352df0e792a29f044bb9863.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/1e7/6fd/c04/1e76fdc04352df0e792a29f044bb9863.svg 781w"
loading="lazy" data-decode="async" width="32" height="21"
alt="\Delta q_{i}" /> — в процессе обучения эмбеддинг движется
ортогонально:

<figure class="full-width">
<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/c5e8b855205b50e8fcc841bc89e2b79b.png"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/c5e/8b8/552/c5e8b855205b50e8fcc841bc89e2b79b.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/c5e/8b8/552/c5e8b855205b50e8fcc841bc89e2b79b.png 781w"
loading="lazy" data-decode="async" width="1242" height="1232" />
</figure>

</div>

### Резюме: факторы, при которых эмбеддинг движется ортогонально

Если для энкодера в двухбашенной модели выполняется одновременно четыре
фактора:

1.  в качестве оптимайзера используется простой SGD без моментума и
    регуляризации

2.  это линейный (по параметрам) энкодер

3.  у каждого уникального входа в энкодер «собственная» строка
    параметров, которая не пересекается c чужими

4.  градиент лосса по выходу энкодера (эмбеддингу) ортогонален выходу
    эмбеддинга

То получается аналитически доказать, что **в процессе обучения эмбеддинг
движется ортогонально**, т.е. по касательной к гиперсфере, на которой он
лежал на предыдущем шаге.

### Связь с популярными статьями про ортогональность движения эмбеддингов

В статье <a href="https://arxiv.org/abs/1704.06369"
rel="noopener noreferrer nofollow" target="_blank">NormFace: L2
Hypersphere Embedding for Face Verification</a> (930 цитирований)
предлагают новый способ учить глубокие энкодеры. В разделе 3.2 они
доказывают, что для их выхода сети <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/fc49bb722e3de69aceb7bce53e012858.svg"
class="formula inline" data-source="x"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/fc4/9bb/722/fc49bb722e3de69aceb7bce53e012858.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/fc4/9bb/722/fc49bb722e3de69aceb7bce53e012858.svg 781w"
loading="lazy" data-decode="async" width="11" height="12" alt="x" /> и
градиента их рассматриваемого лосса <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/4bc7bfce18743963a616de718da02657.svg"
class="formula inline" data-source="\partial \mathcal L / \partial x"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/4bc/7bf/ce1/4bc7bfce18743963a616de718da02657.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/4bc/7bf/ce1/4bc7bfce18743963a616de718da02657.svg 781w"
loading="lazy" data-decode="async" width="57" height="22"
alt="\partial \mathcal L / \partial x" /> выполняется ортогональность,
после чего сразу же делают логический переход *"it can be inferred that
after update, <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/4fac0f5f8f6211e56bd6cf86247df7b2.svg"
class="formula inline" data-source="\|x\|^2"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/4fa/c0f/5f8/4fac0f5f8f6211e56bd6cf86247df7b2.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/4fa/c0f/5f8/4fac0f5f8f6211e56bd6cf86247df7b2.svg 781w"
loading="lazy" data-decode="async" width="40" height="25"
alt="\|x\|^2" /> always increases"*, подразумевая то, что раз градиент
по выходу сети ортогонален, то и сдвинется выход тоже ортогонально. Но
мне остался непонятным этот переход: от ортогональности градиента к
ортогональности самого обновления.

Такая ортогональность шага гарантируется лишь при выполнении набора
достаточно строгих условий (см. выше). Мы эти условия выписываем явно и
показываем: при их соблюдении эмбеддинги действительно движутся
ортогонально; вне этой области переход от ортогональности градиента к
ортогональности движения эмбеддингов (и, соответственно, к непрерывно
возрастающей норме эмбеддингов) может не выполняться. Следовательно,
мотивацию предложенного изменения корректно трактовать как условную: она
верна при выполнении описанных нами условий, но не является
универсальным основанием для модификации способа обучения энкодеров —
тем более глубоких.

Та же критика сохраняет силу и относительно статей
<a href="https://arxiv.org/pdf/2406.16468"
rel="noopener noreferrer nofollow" target="_blank">The Hidden Pitfalls
of the Cosine Similarity Loss</a> (5 цитирований) и
<a href="https://arxiv.org/pdf/2502.09252"
rel="noopener noreferrer nofollow" target="_blank">On the Importance of
Embedding Norms in Self-Supervised Learning</a> (2 цитирования). В
частности, в первой утверждается *"The gradient is orthogonal to the
embedding, so a step of gradient descent can only increase the
embedding’s magnitude"* и *"these derivations are extremely general –
they hold across deep learning architectures"*, не учитывая то, что
градиентное обновление затрагивает параметры модели, а не сам её выход,
и подкрепляя это только наблюдением роста нормы эмбеддингов в
экспериментах, не анализируя, действительно ли этот рост вызван
ортогональным движением эмбеддингов. Во второй утверждается *"Because
gradient updates are orthogonal to an embedding point, they must
increase the point’s norm"*, что является упущением без уточнения
условий, при которых шаг обновления (а не только градиент) является
ортогональным. Такое упущение вводит читателя в заблуждение относительно
универсальности "неизбежного Catch-22". Правда, в аппендиксе B они
уточняют *"We optimize the cosine similarity by performing standard
gradient descent* ***on the embeddings themselves****"*, подразумевая
неглубокую архитектуру вроде Embedding Layer, но такая фиксация
архитектуры происходит только в аппендиксе, и вся статья позиционирует
корректность утверждения *"Because gradient updates are orthogonal to an
embedding point, they must increase the point’s norm"* без уточнения
архитектуры.

Но при выполнении условий, аналитически доказывающих ортогональность
движения эмбеддингов, действительно возникает рост нормы эмбеддингов (по
теореме Пифагора). Возникает вопрос: как его оценить аналитически?

### Анализ изменения нормы эмбеддинга объекта от популярности объекта

В этом разделе будем полагать, что выполняются вышеописанные 4 фактора и
поэтому в процессе обучения эмбеддинг движется ортогонально. Тогда по
теореме Пифагора:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/dbb902442151505323b8af4e9605d81f.svg"
class="formula"
data-source="\begin{align} &amp;\bigl\|q_i^{(t+1)}\bigr\|^2 - \bigl\|q_i^{(t)}\bigr\|^2 \;=\; \bigl\|\Delta q_i^{(t)}\bigr\|^2 \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/dbb/902/442/dbb902442151505323b8af4e9605d81f.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/dbb/902/442/dbb902442151505323b8af4e9605d81f.svg 781w"
loading="lazy" data-decode="async" width="257" height="30"
alt="\begin{align} &amp;\bigl\|q_i^{(t+1)}\bigr\|^2 - \bigl\|q_i^{(t)}\bigr\|^2 \;=\; \bigl\|\Delta q_i^{(t)}\bigr\|^2 \end{align}" />

Прежде чем анализировать изменение нормы эмбеддинга, я сделаю следующее
утверждение и докажу его — оно понадобится далее:

Чем больше эмбеддинг, тем медленнее он растет при косинусном лоссе

<div class="spoiler__content">

***Чем длиннее*** <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/8dd700e091fe84be8f324f5eebd4999b.svg"
class="formula inline" data-source="q"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/8dd/700/e09/8dd700e091fe84be8f324f5eebd4999b.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/8dd/700/e09/8dd700e091fe84be8f324f5eebd4999b.svg 781w"
loading="lazy" data-decode="async" width="9" height="15" alt="q" />***,
тем меньше норма градиента косинусного лосса по*** <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/8682d2adb9e75d894d0378c07b057c46.svg"
class="formula inline" data-source="q"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/868/2d2/adb/8682d2adb9e75d894d0378c07b057c46.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/868/2d2/adb/8682d2adb9e75d894d0378c07b057c46.svg 781w"
loading="lazy" data-decode="async" width="9" height="15" alt="q" />

Почему это важно: получается сложный контр-эффект "чем больше эмбеддинг,
тем медленнее он растет", и этот контр-эффект нужно будет учитывать в
дальнейших формулах для анализа изменения популярных объектов.

Теперь докажем — начну с использования формулы из Приложения №1:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/68ba41a062ae1df694aaf060cae96ad0.svg"
class="formula"
data-source="\begin{align} \nabla_{{q}} \cos(q,k) = \frac{     \|{q}\|\|{k}\|\;{k}     \;-\;     ({q}^\top{k})\,\|{k}\|\;\tfrac{{q}}{\|{q}\|}   }{     \bigl(\|{q}\|\|{k}\|\bigr)^2   } = \frac{     {k}     \;-\;     \tfrac{{q}^\top{k}}{\|{q}\|^2}\,{q}   }{     \|{q}\|\;\|{k}\|   } \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/68b/a41/a06/68ba41a062ae1df694aaf060cae96ad0.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/68b/a41/a06/68ba41a062ae1df694aaf060cae96ad0.svg 781w"
loading="lazy" data-decode="async" width="482" height="76"
alt="\begin{align} \nabla_{{q}} \cos(q,k) = \frac{ \|{q}\|\|{k}\|\;{k} \;-\; ({q}^\top{k})\,\|{k}\|\;\tfrac{{q}}{\|{q}\|} }{ \bigl(\|{q}\|\|{k}\|\bigr)^2 } = \frac{ {k} \;-\; \tfrac{{q}^\top{k}}{\|{q}\|^2}\,{q} }{ \|{q}\|\;\|{k}\| } \end{align}" /><img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/35467e69e73363a1ceb87dd217296019.svg"
class="formula"
data-source="\begin{align} \hat{q} &amp;= \frac{q}{\|q\|},\qquad \hat{k}=\frac{k}{\|k\|}\\ \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/354/67e/69e/35467e69e73363a1ceb87dd217296019.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/354/67e/69e/35467e69e73363a1ceb87dd217296019.svg 781w"
loading="lazy" data-decode="async" width="201" height="48"
alt="\begin{align} \hat{q} &amp;= \frac{q}{\|q\|},\qquad \hat{k}=\frac{k}{\|k\|}\\ \end{align}" /><img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/b1f04ee809681204aac33d67f46841db.svg"
class="formula"
data-source="\begin{align} \nabla_{{q}} \cos(q,k) = \frac{1}{\|q\|} \left(     \hat{k} - (\hat{q}^\top \hat{k}) \, \hat{q} \right) = \frac{1}{\|q\|} \, (I - \hat{q} \hat{q}^\top) \hat{k},\qquad \text{назовём } P = I - \hat{q} \hat{q}^\top \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/b1f/04e/e80/b1f04ee809681204aac33d67f46841db.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/b1f/04e/e80/b1f04ee809681204aac33d67f46841db.svg 781w"
loading="lazy" data-decode="async" width="666" height="48"
alt="\begin{align} \nabla_{{q}} \cos(q,k) = \frac{1}{\|q\|} \left( \hat{k} - (\hat{q}^\top \hat{k}) \, \hat{q} \right) = \frac{1}{\|q\|} \, (I - \hat{q} \hat{q}^\top) \hat{k},\qquad \text{назовём } P = I - \hat{q} \hat{q}^\top \end{align}" />

Посмотрим на эту <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/6465b508274aba39e83845e45f5e474a.svg"
class="formula inline" data-source="P"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/646/5b5/082/6465b508274aba39e83845e45f5e474a.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/646/5b5/082/6465b508274aba39e83845e45f5e474a.svg 781w"
loading="lazy" data-decode="async" width="15" height="17" alt="P" />:
так как это матрица, то это линейное отображение. Но так как она
идемпотентна (<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/3f1b1db968f48fb11967e64f98db0be4.svg"
class="formula inline" data-source="P^2 = P"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/3f1/b1d/b96/3f1b1db968f48fb11967e64f98db0be4.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/3f1/b1d/b96/3f1b1db968f48fb11967e64f98db0be4.svg 781w"
loading="lazy" data-decode="async" width="65" height="21"
alt="P^2 = P" />) и симметрична (<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/849db7ceb5bf9637f3d9c886aec6d7d9.svg"
class="formula inline" data-source="P^\top = P"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/849/db7/ceb/849db7ceb5bf9637f3d9c886aec6d7d9.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/849/db7/ceb/849db7ceb5bf9637f3d9c886aec6d7d9.svg 781w"
loading="lazy" data-decode="async" width="69" height="21"
alt="P^\top = P" />), то она не только линейное отображение, но ещё и по
определению является ортогональным проектором. Этот ортогональный
проектор переводит любой вектор (на который она действует через
умножение слева) в пространство, состоящее из всех векторов,
перпендикулярных <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/13ed3ea093c37f8d91f1d5b4fee1fbf4.svg"
class="formula inline" data-source="q"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/13e/d3e/a09/13ed3ea093c37f8d91f1d5b4fee1fbf4.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/13e/d3e/a09/13ed3ea093c37f8d91f1d5b4fee1fbf4.svg 781w"
loading="lazy" data-decode="async" width="9" height="15" alt="q" />.

Теперь посмотрим, какие выводы можно сделать для произвольного
косинусного лосса:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/825b9e9b91ed509f9a35bd1102b45102.svg"
class="formula"
data-source="\begin{align} &amp;L(q) = F\big(\cos(q,k_1), \dots, \cos(q,k_m)\big) \\\\ &amp;\textbf{1. Обозначения: }\\ &amp;c_i(q) = \cos(q,k_i) = \frac{q^\top k_i}{\|q\|\,\|k_i\|}\\ &amp;\hat{q} = \frac{q}{\|q\|}\\ &amp;\hat{k}_i = \frac{k_i}{\|k_i\|}\\ &amp;P = I - \hat{q}\hat{q}^\top \\\\ &amp;\textbf{2. Градиент каждого косинуса: }\\ &amp;\nabla_q c_i(q) = \frac{1}{\|q\|} \, P \hat{k}_i \\\\ &amp;\textbf{3. Сhain rule: }\\ &amp;\nabla_q L(q) = \sum_{i=1}^m \frac{\partial F}{\partial c_i} \; \nabla_q c_i(q) = \frac{1}{\|q\|} \sum_{i=1}^m \frac{\partial F}{\partial c_i} \; P \hat{k}_i \\\\ &amp;\textbf{4. Упрощаем формулу: }\\ &amp;\nabla_q L(q) = \frac{1}{\|q\|} \; P \left( \sum_{i=1}^m \frac{\partial F}{\partial c_i} \; \hat{k}_i \right)\\ &amp;u = \sum_{i=1}^m \frac{\partial F}{\partial c_i} \; \hat{k}_i\\ &amp;\nabla_q L(q) = \frac{1}{\|q\|} \; P u \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/825/b9e/9b9/825b9e9b91ed509f9a35bd1102b45102.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/825/b9e/9b9/825b9e9b91ed509f9a35bd1102b45102.svg 781w"
loading="lazy" data-decode="async" width="396" height="717"
alt="\begin{align} &amp;L(q) = F\big(\cos(q,k_1), \dots, \cos(q,k_m)\big) \\\\ &amp;\textbf{1. Обозначения: }\\ &amp;c_i(q) = \cos(q,k_i) = \frac{q^\top k_i}{\|q\|\,\|k_i\|}\\ &amp;\hat{q} = \frac{q}{\|q\|}\\ &amp;\hat{k}_i = \frac{k_i}{\|k_i\|}\\ &amp;P = I - \hat{q}\hat{q}^\top \\\\ &amp;\textbf{2. Градиент каждого косинуса: }\\ &amp;\nabla_q c_i(q) = \frac{1}{\|q\|} \, P \hat{k}_i \\\\ &amp;\textbf{3. Сhain rule: }\\ &amp;\nabla_q L(q) = \sum_{i=1}^m \frac{\partial F}{\partial c_i} \; \nabla_q c_i(q) = \frac{1}{\|q\|} \sum_{i=1}^m \frac{\partial F}{\partial c_i} \; P \hat{k}_i \\\\ &amp;\textbf{4. Упрощаем формулу: }\\ &amp;\nabla_q L(q) = \frac{1}{\|q\|} \; P \left( \sum_{i=1}^m \frac{\partial F}{\partial c_i} \; \hat{k}_i \right)\\ &amp;u = \sum_{i=1}^m \frac{\partial F}{\partial c_i} \; \hat{k}_i\\ &amp;\nabla_q L(q) = \frac{1}{\|q\|} \; P u \end{align}" />

Посмотрим, как можно выразить норму этого градиента:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/bf5ca07b0715ed14bd8c72fbf3db7ed7.svg"
class="formula"
data-source="\begin{align} &amp;\|\nabla_q L(q)\| = \frac{1}{\|q\|} \; \|P u\|\\ &amp;\textbf{Так как \(P\) ортогональный проектор (\(P^\top = P\), \(P^2 = P\)):}\\ &amp;\|P u\|^2 = u^\top P u = u^\top (I - \hat{q}\hat{q}^\top) u = \|u\|^2 - (\hat{q}^\top u)^2\\ &amp;\textbf{В итоге: }\\ &amp;\boxed{ \|\nabla_q L(q)\| = \frac{\sqrt{\|u\|^2 - (\hat{q}^\top u)^2}}{\|q\|} }\\ &amp;\text{где }  u = \sum_{i=1}^m \frac{\partial F}{\partial c_i} \; \hat{k}_i,  \quad c_i = \hat{q}^\top \hat{k}_i \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/bf5/ca0/7b0/bf5ca07b0715ed14bd8c72fbf3db7ed7.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/bf5/ca0/7b0/bf5ca07b0715ed14bd8c72fbf3db7ed7.svg 781w"
loading="lazy" data-decode="async" width="447" height="278"
alt="\begin{align} &amp;\|\nabla_q L(q)\| = \frac{1}{\|q\|} \; \|P u\|\\ &amp;\textbf{Так как \(P\) ортогональный проектор (\(P^\top = P\), \(P^2 = P\)):}\\ &amp;\|P u\|^2 = u^\top P u = u^\top (I - \hat{q}\hat{q}^\top) u = \|u\|^2 - (\hat{q}^\top u)^2\\ &amp;\textbf{В итоге: }\\ &amp;\boxed{ \|\nabla_q L(q)\| = \frac{\sqrt{\|u\|^2 - (\hat{q}^\top u)^2}}{\|q\|} }\\ &amp;\text{где } u = \sum_{i=1}^m \frac{\partial F}{\partial c_i} \; \hat{k}_i, \quad c_i = \hat{q}^\top \hat{k}_i \end{align}" />

Здесь видно, что с ростом нормы эмбеддинга норма градиента уменьшается:

- Знаменатель — норма эмбеддинга <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/13d420f26ab4c245ae7818d158bf81f9.svg"
  class="formula inline" data-source="q"
  sizes="(max-width: 780px) 100vw, 50vw"
  srcset="https://habrastorage.org/getpro/habr/upload_files/13d/420/f26/13d420f26ab4c245ae7818d158bf81f9.svg 780w,
         https://habrastorage.org/getpro/habr/upload_files/13d/420/f26/13d420f26ab4c245ae7818d158bf81f9.svg 781w"
  loading="lazy" data-decode="async" width="9" height="15" alt="q" />

- Числитель не зависит от нормы эмбеддинга <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/46cd16f7441aa47158d1c2c44f0e87fd.svg"
  class="formula inline" data-source="q"
  sizes="(max-width: 780px) 100vw, 50vw"
  srcset="https://habrastorage.org/getpro/habr/upload_files/46c/d16/f74/46cd16f7441aa47158d1c2c44f0e87fd.svg 780w,
         https://habrastorage.org/getpro/habr/upload_files/46c/d16/f74/46cd16f7441aa47158d1c2c44f0e87fd.svg 781w"
  loading="lazy" data-decode="async" width="9" height="15" alt="q" />:  
  Когда мы считаем <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/bfa1fae1f43b903b8a79ce463139eeba.svg"
  class="formula inline" data-source="u"
  sizes="(max-width: 780px) 100vw, 50vw"
  srcset="https://habrastorage.org/getpro/habr/upload_files/bfa/1fa/e1f/bfa1fae1f43b903b8a79ce463139eeba.svg 780w,
         https://habrastorage.org/getpro/habr/upload_files/bfa/1fa/e1f/bfa1fae1f43b903b8a79ce463139eeba.svg 781w"
  loading="lazy" data-decode="async" width="11" height="12" alt="u" />,
  то <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/b3d517810647c95dd4fb2f89fc45c060.svg"
  class="formula inline" data-source="q"
  sizes="(max-width: 780px) 100vw, 50vw"
  srcset="https://habrastorage.org/getpro/habr/upload_files/b3d/517/810/b3d517810647c95dd4fb2f89fc45c060.svg 780w,
         https://habrastorage.org/getpro/habr/upload_files/b3d/517/810/b3d517810647c95dd4fb2f89fc45c060.svg 781w"
  loading="lazy" data-decode="async" width="9" height="15" alt="q" />
  фигурирует там только в расчете производной <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/17d34e0a2779371bc4cf3762cd1c16fc.svg"
  class="formula inline" data-source="F"
  sizes="(max-width: 780px) 100vw, 50vw"
  srcset="https://habrastorage.org/getpro/habr/upload_files/17d/34e/0a2/17d34e0a2779371bc4cf3762cd1c16fc.svg 780w,
         https://habrastorage.org/getpro/habr/upload_files/17d/34e/0a2/17d34e0a2779371bc4cf3762cd1c16fc.svg 781w"
  loading="lazy" data-decode="async" width="15" height="17" alt="F" />
  по косинусу. Норма <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/f1876945f14fabe1c7656448567c6d38.svg"
  class="formula inline" data-source="q"
  sizes="(max-width: 780px) 100vw, 50vw"
  srcset="https://habrastorage.org/getpro/habr/upload_files/f18/769/45f/f1876945f14fabe1c7656448567c6d38.svg 780w,
         https://habrastorage.org/getpro/habr/upload_files/f18/769/45f/f1876945f14fabe1c7656448567c6d38.svg 781w"
  loading="lazy" data-decode="async" width="9" height="15" alt="q" />
  меняется → косинус не меняется → вход функции <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/26d8489c015d6fcab6e122e46eec5c28.svg"
  class="formula inline" data-source="F"
  sizes="(max-width: 780px) 100vw, 50vw"
  srcset="https://habrastorage.org/getpro/habr/upload_files/26d/848/9c0/26d8489c015d6fcab6e122e46eec5c28.svg 780w,
         https://habrastorage.org/getpro/habr/upload_files/26d/848/9c0/26d8489c015d6fcab6e122e46eec5c28.svg 781w"
  loading="lazy" data-decode="async" width="15" height="17" alt="F" />
  не изменился → производная <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/fe2f19690770095740d7471fec3c1f22.svg"
  class="formula inline" data-source="F"
  sizes="(max-width: 780px) 100vw, 50vw"
  srcset="https://habrastorage.org/getpro/habr/upload_files/fe2/f19/690/fe2f19690770095740d7471fec3c1f22.svg 780w,
         https://habrastorage.org/getpro/habr/upload_files/fe2/f19/690/fe2f19690770095740d7471fec3c1f22.svg 781w"
  loading="lazy" data-decode="async" width="15" height="17" alt="F" />
  по косинусу не зависит от нормы <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/cfd97273d7c89d7bc728ec8de44231a1.svg"
  class="formula inline" data-source="q"
  sizes="(max-width: 780px) 100vw, 50vw"
  srcset="https://habrastorage.org/getpro/habr/upload_files/cfd/972/73d/cfd97273d7c89d7bc728ec8de44231a1.svg 780w,
         https://habrastorage.org/getpro/habr/upload_files/cfd/972/73d/cfd97273d7c89d7bc728ec8de44231a1.svg 781w"
  loading="lazy" data-decode="async" width="9" height="15" alt="q" />.

</div>

Наконец, сам анализ изменения нормы эмбеддинга объекта от популярности
объекта:

Неотрицательная зависимость нормы эмбеддинга от популярности

<div class="spoiler__content">

Хотим показать, что величина <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/8f81bf33aa61d9cf42599ac532fbe231.svg"
class="formula inline" data-source="\|q_{i}^{(T)}\|"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/8f8/1bf/33a/8f81bf33aa61d9cf42599ac532fbe231.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/8f8/1bf/33a/8f81bf33aa61d9cf42599ac532fbe231.svg 781w"
loading="lazy" data-decode="async" width="51" height="30"
alt="\|q_{i}^{(T)}\|" /> в процессе обучения длиной в <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/0ddb2760ee74f96812a73cf369afb520.svg"
class="formula inline" data-source="T"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/0dd/b27/60e/0ddb2760ee74f96812a73cf369afb520.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/0dd/b27/60e/0ddb2760ee74f96812a73cf369afb520.svg 781w"
loading="lazy" data-decode="async" width="14" height="17" alt="T" />
батчей в среднем не убывает по <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/c1a992b4704d34fff987a40ae7300705.svg"
class="formula inline" data-source="p_{i}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/c1a/992/b47/c1a992b4704d34fff987a40ae7300705.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/c1a/992/b47/c1a992b4704d34fff987a40ae7300705.svg 781w"
loading="lazy" data-decode="async" width="17" height="15" alt="p_{i}" />.

Воспользуемся методом связывания
(<a href="https://people.math.wisc.edu/~roch/mdp/roch-mdp-chap4.pdf"
rel="noopener noreferrer nofollow" target="_blank">coupling</a>) из
теории вероятностей (сборник
<a href="https://people.math.wisc.edu/~roch/mdp/"
rel="noopener noreferrer nofollow" target="_blank">"Modern Discrete
Probability: An Essential Toolkit"</a>):

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/d86fb699e5947a7d2ea47a6aa8bfffab.svg"
class="formula"
data-source="\begin{align}   &amp; \textbf{1) Два запуска на одной случайности (зафиксировали случайный}                                        \\   &amp; \textbf{исход генерации батчей)} \\   &amp; \text{Запускаем обучение дважды, различаются только популярности} \\   &amp; \text{объекта $i$: }p&#39;_{i}&lt; p&#39;&#39;_{i}. \text{ На каждом шаге }t \text{ и в каждом слоте батча} \\   &amp; \text{берём одно и то же случайное число }U \sim \text{Uniform}(0, 1):                                   \\   &amp; \quad \bullet \text{ в запуске с параметром }p \text{ кладём }i \text{ в слот, если }U \le p_{i};                                    \\   &amp; \quad \bullet \text{ иначе кладём один и тот же не-}i\text{ айтeм в обоих запусках (его}           \\   &amp; \quad \text{тоже выбираем из того же рандом-генератора).}                                                                                                     \\  \\   &amp; \text{Тогда для каждого собранного на шаге $t$ батча:}                                                                               \\  \\   &amp; \text{индикатор события \{айтем $i$ присутствует хотя бы единожды при $p&#39;&#39;_{i}$\}}                                                   \\   &amp; \ge                                                                                                                                  \\   &amp; \text{индикатор события \{айтем $i$ присутствует хотя бы единожды при $p&#39;_{i}$\}}                                                    \\  \\   &amp; \text{ То есть у «большего» }p_{i}\text{ появлений }i \text{ никогда не меньше.}                                                     \\ \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/d86/fb6/99e/d86fb699e5947a7d2ea47a6aa8bfffab.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/d86/fb6/99e/d86fb699e5947a7d2ea47a6aa8bfffab.svg 781w"
loading="lazy" data-decode="async" width="499" height="463"
alt="\begin{align} &amp; \textbf{1) Два запуска на одной случайности (зафиксировали случайный} \\ &amp; \textbf{исход генерации батчей)} \\ &amp; \text{Запускаем обучение дважды, различаются только популярности} \\ &amp; \text{объекта $i$: }p&#39;_{i}&lt; p&#39;&#39;_{i}. \text{ На каждом шаге }t \text{ и в каждом слоте батча} \\ &amp; \text{берём одно и то же случайное число }U \sim \text{Uniform}(0, 1): \\ &amp; \quad \bullet \text{ в запуске с параметром }p \text{ кладём }i \text{ в слот, если }U \le p_{i}; \\ &amp; \quad \bullet \text{ иначе кладём один и тот же не-}i\text{ айтeм в обоих запусках (его} \\ &amp; \quad \text{тоже выбираем из того же рандом-генератора).} \\ \\ &amp; \text{Тогда для каждого собранного на шаге $t$ батча:} \\ \\ &amp; \text{индикатор события \{айтем $i$ присутствует хотя бы единожды при $p&#39;&#39;_{i}$\}} \\ &amp; \ge \\ &amp; \text{индикатор события \{айтем $i$ присутствует хотя бы единожды при $p&#39;_{i}$\}} \\ \\ &amp; \text{ То есть у «большего» }p_{i}\text{ появлений }i \text{ никогда не меньше.} \\ \end{align}" />

Примечание о распределениях

<div class="spoiler__content">

Пусть исходное распределение по всем айтемам равно <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/a7e85a63d525a7b959951709b5c426cb.svg"
class="formula inline" data-source="p"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/a7e/85a/63d/a7e85a63d525a7b959951709b5c426cb.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/a7e/85a/63d/a7e85a63d525a7b959951709b5c426cb.svg 781w"
loading="lazy" data-decode="async" width="11" height="15" alt="p" />. На
множестве «не-i» айтемов (<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/71bc1493e9c72339453fbe21d1e088e5.svg"
class="formula inline" data-source="k \ne i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/71b/c14/93e/71bc1493e9c72339453fbe21d1e088e5.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/71b/c14/93e/71bc1493e9c72339453fbe21d1e088e5.svg 781w"
loading="lazy" data-decode="async" width="43" height="22"
alt="k \ne i" />) зададим «остаточное» распределение <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/f06a26d4a28f44757e305267ba229640.svg"
class="formula inline" data-source="r"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/f06/a26/d4a/f06a26d4a28f44757e305267ba229640.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/f06/a26/d4a/f06a26d4a28f44757e305267ba229640.svg 781w"
loading="lazy" data-decode="async" width="9" height="12" alt="r" />,
которое получается перемасштабированием (<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/3d92cd9ee462f339df9d913337aa5349.svg"
class="formula inline" data-source="i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/3d9/2cd/9ee/3d92cd9ee462f339df9d913337aa5349.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/3d9/2cd/9ee/3d92cd9ee462f339df9d913337aa5349.svg 781w"
loading="lazy" data-decode="async" width="7" height="16" alt="i" />-ый
айтем выкинули из распределения — остальные вероятности увеличились):

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/0c34f7ea22658c92d852acc813914df5.svg"
class="formula" data-source="r_k = \frac{p_k}{1-p_i}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/0c3/4f7/ea2/0c34f7ea22658c92d852acc813914df5.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/0c3/4f7/ea2/0c34f7ea22658c92d852acc813914df5.svg 781w"
loading="lazy" data-decode="async" width="101" height="42"
alt="r_k = \frac{p_k}{1-p_i}" />

Рассмотрим один слот генерации. Используем общие <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/1879420bb3314a6cb20facc6c9e6c1f2.svg"
class="formula inline" data-source="U \sim \text{Uniform}(0, 1)"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/187/942/0bb/1879420bb3314a6cb20facc6c9e6c1f2.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/187/942/0bb/1879420bb3314a6cb20facc6c9e6c1f2.svg 781w"
loading="lazy" data-decode="async" width="155" height="22"
alt="U \sim \text{Uniform}(0, 1)" />и исход категориального
распределения «не-i» айтемов <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/a5ea6e4806f0ce189663bdc5414f32fa.svg"
class="formula inline" data-source="Z \sim Cat(r)"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/a5e/a6e/480/a5ea6e4806f0ce189663bdc5414f32fa.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/a5e/a6e/480/a5ea6e4806f0ce189663bdc5414f32fa.svg 781w"
loading="lazy" data-decode="async" width="97" height="22"
alt="Z \sim Cat(r)" />:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/04435b2709bcd3994f7a83111cb0a825.svg"
class="formula"
data-source="X^{(p)} = \begin{cases} i, &amp; U \le p,\\ Z, &amp; U &gt; p. \end{cases}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/044/35b/270/04435b2709bcd3994f7a83111cb0a825.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/044/35b/270/04435b2709bcd3994f7a83111cb0a825.svg 781w"
loading="lazy" data-decode="async" width="179" height="50"
alt="X^{(p)} = \begin{cases} i, &amp; U \le p,\\ Z, &amp; U &gt; p. \end{cases}" />

Тогда:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/0817d20a3f64145a2e6b49488d1ed70d.svg"
class="formula"
data-source="\mathbb P^{(p)}\{X=i\}=p, \qquad \mathbb P^{(p)}\{X=k\}=(1-p)r_k\quad(k\neq i)"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/081/7d2/0a3/0817d20a3f64145a2e6b49488d1ed70d.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/081/7d2/0a3/0817d20a3f64145a2e6b49488d1ed70d.svg 781w"
loading="lazy" data-decode="async" width="489" height="26"
alt="\mathbb P^{(p)}\{X=i\}=p, \qquad \mathbb P^{(p)}\{X=k\}=(1-p)r_k\quad(k\neq i)" />

и для конкретных <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/264899b50539efd20b51192b8a3e4e7b.svg"
class="formula inline" data-source="p \in \{p&#39;_i,p&#39;&#39;_i\}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/264/899/b50/264899b50539efd20b51192b8a3e4e7b.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/264/899/b50/264899b50539efd20b51192b8a3e4e7b.svg 781w"
loading="lazy" data-decode="async" width="99" height="24"
alt="p \in \{p&#39;_i,p&#39;&#39;_i\}" />:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/11905149aad011aed4aa9ded4d313b2b.svg"
class="formula"
data-source="\mathbb P^{(p&#39;&#39;_i)}\{X=k\}=\gamma\,\mathbb P^{(p&#39;_i)}\{X=k\},\ \quad \gamma=\frac{1-p&#39;&#39;_i}{1-p&#39;_i}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/119/051/49a/11905149aad011aed4aa9ded4d313b2b.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/119/051/49a/11905149aad011aed4aa9ded4d313b2b.svg 781w"
loading="lazy" data-decode="async" width="390" height="52"
alt="\mathbb P^{(p&#39;&#39;_i)}\{X=k\}=\gamma\,\mathbb P^{(p&#39;_i)}\{X=k\},\ \quad \gamma=\frac{1-p&#39;&#39;_i}{1-p&#39;_i}" />

</div>

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/afd027bdfc4d717f28ee45012c43a43a.svg"
class="formula"
data-source="\begin{align}  &amp; \textbf{2) Что делает одно появление с нормой} \\  &amp; \text{Обозначим } s^{(t)} = \|q_{i}^{(t)}\|^{2}. \\  &amp; \text{Одношаговое обновление:} \\  &amp; s^{(t+1)} =    \begin{cases}      s^{(t)}, &amp; \text{если } i \text{ не встретился,} \\      s^{(t)} + \Delta(s^{(t)}), &amp; \text{если } i \text{ встретился,}    \end{cases} \\  &amp; \text{где } \Delta(s) = \|\Delta q^{(t)}\|^{2} \ge 0. \\  &amp; \text{Для косинусного лосса (градиент ортогонален $q$)} \\  &amp; \text{типично } \Delta(s) = \tfrac{c}{s} \ (\text{см. Приложение №2}), \\  &amp; \text{где } c &gt; 0: \text{ чем больше норма, тем меньше прибавка,} \\  &amp; \text{но она остаётся положительной.} \\\\  &amp; \textbf{3) Требование: шаг не должен «переворачивать» порядок} \\  &amp; \text{Для финального вывода в след. пункте нужно, чтобы при} \\  &amp; \text{одновременном появлении $i$ в обоих запусках отображение} \\ &amp; \Phi(s) = s + \Delta(s) \\  &amp;  \text{было неубывающим: } s_{1} \le s_{2} \Rightarrow \Phi(s_{1}) \le \Phi(s_{2}). \\  &amp; \text{Для } \Delta(s) = \tfrac{c}{s}: \\  &amp; \Phi(s) = s + \tfrac{c}{s}, \quad    \Phi&#39;(s) = 1 - \tfrac{c}{s^{2}} \ge 0 \;\; \text{при } s \ge \sqrt{c}. \\  &amp; \textbf{Почему быстро попадаем в зону $s$ $\ge$ $\sqrt{c}$} \\ &amp; \text{Среднее арифметическое неотрицательных чисел}\\ &amp; \text{не меньше среднего геометрического:} \\ &amp; s + \frac{c}{s} \ge 2\sqrt{c} \quad (s &gt; 0). \\ &amp; \text{Значит, после любого одного появления:} \\ &amp; s_{\text{новое}} = \Phi(s) = s + \frac{c}{s} \ge 2\sqrt{c} \ge \sqrt{c} \\ &amp; \text{Всё! Мы доказали через школьное неравенство, что} \\ &amp; \text{$s_{новое}$ будет большим, чем $\sqrt{c}$. На новом шаге, если $c$ не} \\ &amp; \text{изменится сильно, сохранится монотонность $\Phi$: $\Phi&#39;(s) \ge 0$.} \\ &amp; \text{$\Phi$ не сможет сделать «большой» вектор меньшим} \\ &amp; \text{«малого» при одинаковом событии «айтем $i$ встретился хотя бы} \\ &amp; \text{единожды в собранном батче».} \\ &amp; \textbf{То, что $c$ не будет на каждом шаге сильно расти, доказывается}\\ &amp; \textbf{в Приложении №2.}  \\\\ &amp; \textbf{4) Индукция по шагам: почему «больше } p_{i} \Rightarrow \textbf{ не меньше итог»} \\ &amp; \text{Синхронизируем случайность, как в п.1, и идём по итерациям $t$:} \\ &amp; \quad \bullet \text{ если } i \text{ нет у обоих, оба } s \text{ не меняются;} \\ &amp; \quad \bullet \text{ если } i \text{ есть только у батча с } p&#39;&#39;_{i}\text{, его } s \text{ увеличится} \\ &amp; \quad \text{на } \Delta(\cdot) \ge 0\text{, у } p&#39;_{i} \text{ — нет } \Rightarrow \text{ порядок не ухудшается;} \\ &amp; \quad \bullet \text{ если } i \text{ есть у обоих, по неубывающей } \Phi(s) \text{ порядок } \\ &amp; \quad s&#39;&#39; \ge s&#39; \text{ сохраняется (см. Примечание о различии батчей).} \\ &amp; \text{Индукцией по } t\text{:}\\ &amp; s_{p&#39;&#39;_{i}}^{(t)} \ge s_{p&#39;_{i}}^{(t)} \text{ (почти наверное на тех же исходах случайности).} \\ &amp; \text{Тогда } \sqrt{\cdot} \text{ — монотонна, значит} \\ &amp; \mathbb{E} \left\|q_{i}^{(T)}\right\|_{p&#39;&#39;_{i}} \ge \mathbb{E} \left\|q_{i}^{(T)}\right\|_{p&#39;_{i}}. \\ &amp; \boxed{ \text{То есть }\left\|q_{i}^{(T)}\right\| \text{ в среднем не убывает при большем $p_{i}$.} } \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/afd/027/bdf/afd027bdfc4d717f28ee45012c43a43a.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/afd/027/bdf/afd027bdfc4d717f28ee45012c43a43a.svg 781w"
loading="lazy" data-decode="async" width="486" height="1423"
alt="\begin{align} &amp; \textbf{2) Что делает одно появление с нормой} \\ &amp; \text{Обозначим } s^{(t)} = \|q_{i}^{(t)}\|^{2}. \\ &amp; \text{Одношаговое обновление:} \\ &amp; s^{(t+1)} = \begin{cases} s^{(t)}, &amp; \text{если } i \text{ не встретился,} \\ s^{(t)} + \Delta(s^{(t)}), &amp; \text{если } i \text{ встретился,} \end{cases} \\ &amp; \text{где } \Delta(s) = \|\Delta q^{(t)}\|^{2} \ge 0. \\ &amp; \text{Для косинусного лосса (градиент ортогонален $q$)} \\ &amp; \text{типично } \Delta(s) = \tfrac{c}{s} \ (\text{см. Приложение №2}), \\ &amp; \text{где } c &gt; 0: \text{ чем больше норма, тем меньше прибавка,} \\ &amp; \text{но она остаётся положительной.} \\\\ &amp; \textbf{3) Требование: шаг не должен «переворачивать» порядок} \\ &amp; \text{Для финального вывода в след. пункте нужно, чтобы при} \\ &amp; \text{одновременном появлении $i$ в обоих запусках отображение} \\ &amp; \Phi(s) = s + \Delta(s) \\ &amp; \text{было неубывающим: } s_{1} \le s_{2} \Rightarrow \Phi(s_{1}) \le \Phi(s_{2}). \\ &amp; \text{Для } \Delta(s) = \tfrac{c}{s}: \\ &amp; \Phi(s) = s + \tfrac{c}{s}, \quad \Phi&#39;(s) = 1 - \tfrac{c}{s^{2}} \ge 0 \;\; \text{при } s \ge \sqrt{c}. \\ &amp; \textbf{Почему быстро попадаем в зону $s$ $\ge$ $\sqrt{c}$} \\ &amp; \text{Среднее арифметическое неотрицательных чисел}\\ &amp; \text{не меньше среднего геометрического:} \\ &amp; s + \frac{c}{s} \ge 2\sqrt{c} \quad (s &gt; 0). \\ &amp; \text{Значит, после любого одного появления:} \\ &amp; s_{\text{новое}} = \Phi(s) = s + \frac{c}{s} \ge 2\sqrt{c} \ge \sqrt{c} \\ &amp; \text{Всё! Мы доказали через школьное неравенство, что} \\ &amp; \text{$s_{новое}$ будет большим, чем $\sqrt{c}$. На новом шаге, если $c$ не} \\ &amp; \text{изменится сильно, сохранится монотонность $\Phi$: $\Phi&#39;(s) \ge 0$.} \\ &amp; \text{$\Phi$ не сможет сделать «большой» вектор меньшим} \\ &amp; \text{«малого» при одинаковом событии «айтем $i$ встретился хотя бы} \\ &amp; \text{единожды в собранном батче».} \\ &amp; \textbf{То, что $c$ не будет на каждом шаге сильно расти, доказывается}\\ &amp; \textbf{в Приложении №2.} \\\\ &amp; \textbf{4) Индукция по шагам: почему «больше } p_{i} \Rightarrow \textbf{ не меньше итог»} \\ &amp; \text{Синхронизируем случайность, как в п.1, и идём по итерациям $t$:} \\ &amp; \quad \bullet \text{ если } i \text{ нет у обоих, оба } s \text{ не меняются;} \\ &amp; \quad \bullet \text{ если } i \text{ есть только у батча с } p&#39;&#39;_{i}\text{, его } s \text{ увеличится} \\ &amp; \quad \text{на } \Delta(\cdot) \ge 0\text{, у } p&#39;_{i} \text{ — нет } \Rightarrow \text{ порядок не ухудшается;} \\ &amp; \quad \bullet \text{ если } i \text{ есть у обоих, по неубывающей } \Phi(s) \text{ порядок } \\ &amp; \quad s&#39;&#39; \ge s&#39; \text{ сохраняется (см. Примечание о различии батчей).} \\ &amp; \text{Индукцией по } t\text{:}\\ &amp; s_{p&#39;&#39;_{i}}^{(t)} \ge s_{p&#39;_{i}}^{(t)} \text{ (почти наверное на тех же исходах случайности).} \\ &amp; \text{Тогда } \sqrt{\cdot} \text{ — монотонна, значит} \\ &amp; \mathbb{E} \left\|q_{i}^{(T)}\right\|_{p&#39;&#39;_{i}} \ge \mathbb{E} \left\|q_{i}^{(T)}\right\|_{p&#39;_{i}}. \\ &amp; \boxed{ \text{То есть }\left\|q_{i}^{(T)}\right\| \text{ в среднем не убывает при большем $p_{i}$.} } \end{align}" />

Примечание о различии батчей

<div class="spoiler__content">

В вышеописанных запусках собранные батчи отличаются на слотах, где
выпало <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/daf9225877dd7e51b187a70eb6789c53.svg"
class="formula inline"
data-source="p&#39;_i &lt; U_k &lt; p&#39;&#39;_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/daf/922/587/daf9225877dd7e51b187a70eb6789c53.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/daf/922/587/daf9225877dd7e51b187a70eb6789c53.svg 781w"
loading="lazy" data-decode="async" width="111" height="23"
alt="p&#39;_i &lt; U_k &lt; p&#39;&#39;_i" />. Поэтому в ситуации, где
<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/c18dd170816c9000b020bf09bca78dc7.svg"
class="formula inline" data-source="i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/c18/dd1/708/c18dd170816c9000b020bf09bca78dc7.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/c18/dd1/708/c18dd170816c9000b020bf09bca78dc7.svg 781w"
loading="lazy" data-decode="async" width="7" height="16" alt="i" />
оказался в обоих собранных батчах, может случиться <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/0a22d8736ee4f21f715ce36f6e2814ef.svg"
class="formula inline" data-source="c&#39;&#39; &lt; c&#39;"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/0a2/2d8/736/0a22d8736ee4f21f715ce36f6e2814ef.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/0a2/2d8/736/0a22d8736ee4f21f715ce36f6e2814ef.svg 781w"
loading="lazy" data-decode="async" width="58" height="19"
alt="c&#39;&#39; &lt; c&#39;" />— например, если запуск с <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/12c184f344ec4a7549a336005e2d2cbd.svg"
class="formula inline" data-source="p&#39;&#39;_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/12c/184/f34/12c184f344ec4a7549a336005e2d2cbd.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/12c/184/f34/12c184f344ec4a7549a336005e2d2cbd.svg 781w"
loading="lazy" data-decode="async" width="20" height="23"
alt="p&#39;&#39;_i" />получил положительные и отрицательные
взаимодействия с айтемом <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/6c0c8f3c1c7f501d1c8dd5e43cb848b1.svg"
class="formula inline" data-source="i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/6c0/c8f/3c1/6c0c8f3c1c7f501d1c8dd5e43cb848b1.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/6c0/c8f/3c1/6c0c8f3c1c7f501d1c8dd5e43cb848b1.svg 781w"
loading="lazy" data-decode="async" width="7" height="16" alt="i" />, а
запуск с <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/058c408ee113d8eef3246549de0d4c05.svg"
class="formula inline" data-source="p&#39;_i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/058/c40/8ee/058c408ee113d8eef3246549de0d4c05.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/058/c40/8ee/058c408ee113d8eef3246549de0d4c05.svg 781w"
loading="lazy" data-decode="async" width="17" height="23"
alt="p&#39;_i" />получил только положительные взаимодействия с айтемом
<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/6c0c8f3c1c7f501d1c8dd5e43cb848b1.svg"
class="formula inline" data-source="i"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/6c0/c8f/3c1/6c0c8f3c1c7f501d1c8dd5e43cb848b1.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/6c0/c8f/3c1/6c0c8f3c1c7f501d1c8dd5e43cb848b1.svg 781w"
loading="lazy" data-decode="async" width="7" height="16" alt="i" />.

Однако просто события <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/aecf319a84fe544f58c38f5c0044b01f.svg"
class="formula inline" data-source="c&#39;&#39; &lt; c&#39;"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/aec/f31/9a8/aecf319a84fe544f58c38f5c0044b01f.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/aec/f31/9a8/aecf319a84fe544f58c38f5c0044b01f.svg 781w"
loading="lazy" data-decode="async" width="58" height="19"
alt="c&#39;&#39; &lt; c&#39;" /> мало для того, чтобы порядок <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/cf65dc79fc5b38e7ca9695a94388e21f.svg"
class="formula inline" data-source="s&#39;&#39; \ge s&#39;"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/cf6/5dc/79f/cf65dc79fc5b38e7ca9695a94388e21f.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/cf6/5dc/79f/cf65dc79fc5b38e7ca9695a94388e21f.svg 781w"
loading="lazy" data-decode="async" width="60" height="21"
alt="s&#39;&#39; \ge s&#39;" /> сменился на <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/c5de3f6c014cfd5d39227cf152d94294.svg"
class="formula inline" data-source="s&#39;&#39; &lt; s&#39;"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/c5d/e3f/6c0/c5de3f6c014cfd5d39227cf152d94294.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/c5d/e3f/6c0/c5de3f6c014cfd5d39227cf152d94294.svg 781w"
loading="lazy" data-decode="async" width="60" height="19"
alt="s&#39;&#39; &lt; s&#39;" /> — для такого сильного перелома
накопленной суммы приростов требуется <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/7f4b12c7352b1e56ed0f45bb1782b3df.svg"
class="formula inline" data-source="c&#39;&#39; \ll c&#39;"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/7f4/b12/c73/7f4b12c7352b1e56ed0f45bb1782b3df.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/7f4/b12/c73/7f4b12c7352b1e56ed0f45bb1782b3df.svg 781w"
loading="lazy" data-decode="async" width="63" height="20"
alt="c&#39;&#39; \ll c&#39;" />, что является маловероятным событием
(см. Приложение №2, "Событие <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/75c7b5ca7b6c3385233b916916c7c41b.svg"
class="formula inline" data-source="\|u_{t+1}\| \gg \|u_{t}\|"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/75c/7b5/ca7/75c7b5ca7b6c3385233b916916c7c41b.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/75c/7b5/ca7/75c7b5ca7b6c3385233b916916c7c41b.svg 781w"
loading="lazy" data-decode="async" width="124" height="22"
alt="\|u_{t+1}\| \gg \|u_{t}\|" /> является редким")

</div>

</div>

### Подтверждение выводов в реальных экспериментах

Нужно отметить, что я целенаправленно не рассматриваю качество обученных
моделей на отложенных выборках и не замеряю метрики релевантности вроде
MAP@k, а только исследую геометрические законы движения эмбеддингов в
зависимости от архитектуры и дизайна обучения.

Эксперименты, изучающие факторы, при которых проявляется ортогональность
движения эмбеддингов

<div class="spoiler__content">

Определим:

Условие 1 — архитектура энкодера должна состоять из линейного слоя (но
только над входными данными в формате onehot-векторов) или из эмбеддинг
слоя

Условие 2 — градиент лосса по выходу энкодера должен быть ортогонален
выходу энкодера.

<div>

<div class="table">

<div class="table table_wrapped">

|  |  |  |  |  |  |
|----|----|----|----|----|----|
| № | Левый энкодер | Лосс | Условие 1 для левого энкодера? | Условие 2? | Траектория ортогональна? |
| 1 | Embedding | InfoNCE (cos) | ✔️ | ✔️ | ✔️ |
| 2 | Embedding | InfoNCE **(dot)** | ✔️ | ❌ | Юзер ❌ / Айтем ❌ |
| 3 | BERT-like | InfoNCE (cos) | ❌ | ✔️ | Юзер ❌ / Айтем ✔️ |
| 4 | Embedding → Linear | InfoNCE (cos) | ❌ | ✔️ | Юзер ❌ / Айтем ✔️ |
| 5 | Embedding (frozen) → Linear | InfoNCE (cos) | ❌ | ✔️ | Юзер ❌ / Айтем ✔️ |
| 6 | one-hot → Linear | InfoNCE (cos) | ✔️ | ✔️ | ✔️ |
| 7 | Embedding | <img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/02b84b82dd8a9aa2e3a1ec55c2e77ba5.svg"
class="formula inline" data-source="(1 - cos(q,k))^2"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/02b/84b/82d/02b84b82dd8a9aa2e3a1ec55c2e77ba5.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/02b/84b/82d/02b84b82dd8a9aa2e3a1ec55c2e77ba5.svg 781w"
loading="lazy" data-decode="async" width="128" height="25"
alt="(1 - cos(q,k))^2" /> | ✔️ | ✔️ | ✔️ |

</div>

</div>

</div>

Для начала уточню, что во всех экспериментах в айтемной башне (правом
энкодере) использовался только nn.Embedding, а InfoNCE — это
<a href="https://github.com/RElbers/info-nce-pytorch"
rel="noopener noreferrer nofollow" target="_blank">контрастивный
софтмакс лосс с in-batch негативами</a>, где cos или dot — это
используемая операция в этом лоссе (мы оцениваем релевантность юзера к
айтему или через косинусную близость, или через скалярное произведение).
Везде используется SGD без моментума — при использовании других
вариантов оптимайзеров не удалось обнаружить никакую зависимость в
движении эмбеддингов **(однако мы рассмотрим отдельную ситуацию со
смешанными оптимайзерами including Adam в эксперименте 10)**. В
эксперименте №4 архитектура совпадает с one-hot → Linear → Linear , т.е.
это просто 2 линейных слоя. Архитектура из эксперимента №5 является
показательным примером архитектуры, состоящей из единственного Linear
слоя без доп. условия на ортогональность (one-hot) входов — тут просто
какие-то числовые фичи на входе.

#### Что случится, если в энкодере будет нелинейность по параметрам:

Теперь вернёмся к высказыванию, что **два линейных слоя — это нелинейная
по параметрам модель**: я утверждал, что из-за нелинейности нельзя
получить аналитическое объяснение того, как там движутся эмбеддинги и
проявляется ли popularity bias. **Результат эксперимента №4**
согласуется с этими рассуждениями — в отличие от экспериментов №1 и №6,
здесь эмбеддинги из левого энкодера движутся хаотично.

#### Что случится, если в линейном по параметрам энкодере входы будут не ортогональны друг другу:

Вспомним, что **линейности энкодера еще недостаточно для того, чтобы
гарантировалось ортогональное движение эмбеддингов**, и взглянем на
**результат эксперимента №5** — эмбеддинги из левого энкодера движутся
хаотично. Это согласуется с моим высказыванием, что для ортогональности
движения эмбеддингов требуется, чтобы у каждого уникального входа в
энкодер «собственная» строка параметров, которая не пересекается c
чужими. Я смог обнаружить только две (идентичные) архитектуры, при
которых это выполняется — линейный слой над onehot-векторами
(эксперимент №6) или эмбеддинг слой (эксперимент №1).

#### Что случится, если использовать какой-то другой лосс:

**Результат эксперимента №7** не противоречит моему высказыванию
**«градиент любого косинусного лосса по выходу энкодера ортогонален
ему»**.

Эти эксперименты позволили мне быть чуть увереннее в аналитических
выводах про ортогональность движения эмбеддингов.

</div>

Эксперименты, проверяющие, действительно ли ортогональность движения
эмбеддингов приводит к появлению popularity bias

<div class="spoiler__content">

<div>

<div class="table">

<div class="table table_wrapped">

|  |  |  |  |  |  |  |  |
|----|----|----|----|----|----|----|----|
| № | Левый энкодер | Лосс | Условие 1 для левого энкодера? | Условие 2? | Траектория ортогональна? | Достаточно большое ортогональное смещение? | Popularity bias? |
| 8 | Embedding | InfoNCE (cos) | ✔️ | ✔️ | ✔️ | ✔️ (высокая скорость обучения) | ✔️ |
| 9 | Embedding | InfoNCE (cos) | ✔️ | ✔️ | ✔️ | ❌ (низкая скорость обучения) | ❌ |

</div>

</div>

</div>

В **экспериментах №8 и №9** я проверил, действительно ли выполнение
этого свойства приводит к появлению popularity bias. Я взял настоящие
данные о заказах, на которых учатся наши рекомендательные модели в
проде, и запустил на них обучение двухбашенной нейронной сети,
максимально приближенной к production версии рекомендательной модели
DSSM.

Результат — да, действительно, **если эмбеддинги двигаются ортогонально
ввиду выполнения вышеописанных факторов, то они наращивают свою норму**;
таким образом, айтемы, чаще "получающие движение" (более популярные -
чаще встречающиеся в датасете и, соответственно, чаще попадающие в
обучающие батчи), имеют систематически большую норму - наблюдается
значительная корреляция (коэффициент корреляции Пирсона 0.54, подтвердил
статзначимое отличие корреляции от 0) популярности айтемов и норм
эмбеддингов. Но есть нюанс:

**Получилось выявить важный фактор, выполнение которого необходимо для
появления popularity bias при ортогональном движении эмбеддингов:
эмбеддинги должны двигаться с достаточно большим ортогональным
смещением,** т.к. движение по касательной на малое расстояние почти не
растит норму эмбеддинга (по теореме Пифагора) и этот незначительный рост
не сможет "перебороть" изначальный рандом норм при инициализации
эмбеддингов. В эксперименте №8 мне пришлось сильно увеличить Learning
Rate у SGD оптимайзера, чтобы объекты двигались на бОльшие расстояния
(при использовании более общепринятного LR = 0.1 объекты в процессе
обучения двигались крайне медленно и вообще не переходили на гиперсферы
большего радиуса - я не наблюдал статзначимой корреляции популярности
айтемов и норм эмбеддингов в эксперименте №9).

Этот результат согласуется с анализом изменения нормы эмбеддинга айтема
от популярности айтема.

</div>

Experiment on practical architecture of model

<div class="spoiler__content">

<div>

<div class="table">

<div class="table table_wrapped">

|  |  |  |  |  |  |  |  |
|----|----|----|----|----|----|----|----|
| № | Левый энкодер | Лосс | Условие 1 для левого энкодера? | Условие 2? | Траектория ортогональна? | Достаточно большое ортогональное смещение? | Popularity bias? |
| 10 | BERT-like (w Adam optimizer\*) | InfoNCE (cos) | ❌ | ✔️ | Юзер ❌ / Айтем ✔️ | ✔️ (высокая скорость обучения) | Юзер ❌ / Айтем ✔️ |

</div>

</div>

</div>

Здесь я рассмотрел двухбашенную модель со сложным, приближенным к
production дизайном обучения: левая башня - глубокий BERT над историей
юзера. Правую башню я представляю в качестве простого Embedding Layer
над айди айтема - это **популярный сценарий, если является осмысленным
решением представлять айтем без свёрток и контекстных фичей**. Например,
<a
href="https://static.googleusercontent.com/media/research.google.com/ru//pubs/archive/45530.pdf"
rel="noopener noreferrer nofollow" target="_blank">статья про ютуб</a>
рассматривает такой подход: они используют обучаемый эмбеддинг айтема
(класса) в качестве входа напрямую в softmax loss;
<a href="https://arxiv.org/pdf/2411.19513"
rel="noopener noreferrer nofollow" target="_blank">в статье
CONTEXTGNN</a> также используется простая матрица эмбеддингов в качестве
айтемного энкодера, аргументируя это тем, что применение сложной
архитектуры айтемного энкодера может не приносить значительной пользы.

Я использую раздельные оптимайзеры для левой башни и для правой башни -
BERT учится с Adam и weight_decay, а Embedding Layer для айтема учится с
простым SGD без моментума и регуляризации. Используем и там, и там
<a href="https://arxiv.org/abs/1506.01186"
rel="noopener noreferrer nofollow" target="_blank">Cyclic LR</a>. В
Wildberries мы используем подобные модели в production.

Видно, что если правая башня и её динамика обучения остается простой
(динамический LR ничего не ломает), то даже при сложной архитектуре
модели сохраняется ортогональное движение айтемных эмбеддингов, и при
достаточно большом LR проявляется корреляция популярности с нормой
айтемных эмбеддингов. Я наблюдаю коэффициент корреляции Пирсона 0.56 со
статзначимым отличием от 0.

</div>

### Вывод

Если для айтемной башни одновременно выполняются факторы:

1.  в качестве оптимайзера используется простой SGD без моментума и
    регуляризации

2.  эта башня — линейный (по параметрам) энкодер

3.  у каждого уникального входа в энкодер «собственная» строка
    параметров, которая не пересекается c чужими

4.  градиент лосса по выходу энкодера (эмбеддингу) ортогонален выходу
    эмбеддинга

5.  достаточно высокий learning rate (ортогональность выполняется и без
    этого; это нужно, чтобы «перебить» начальную инициализацию
    эмбеддингов)

то **эмбеддинги у популярных айтемов имеют систематически большую норму,
чем у непопулярных айтемов**.

Здесь видно, сколько требований должно выполняться для того, чтобы
эмбеддинги двигались ортогонально, чтобы их норма монотонно росла и
чтобы это приводило к popularity bias. Таким образом, наше исследование
уточняет выводы вышеупомянутых статей — мы показываем, при выполнении
каких факторов действительно выполняется ортогональность движения
эмбеддингов. В литературе на тему обучения представлений с
использованием косинусного лосса эти моменты ранее не освещались.

**Важным является наблюдение о том**, что хоть такие строгие условия
ограничивают архитектуру энкодера, для которого можно аналитически
гарантировать popularity bias, современные двухбашенные архитектуры
содержат два независимых энкодера. Даже если один из них является
сложной глубокой моделью со сложной динамикой обучения, другой - если
его архитектура достаточно примитивна - гарантирует возникновение этого
явления при обучении на косинусный лосс. Это наблюдение позволяет
перенести текущие математические гарантии на современные популярные
модели, где юзер представляется, например, трансформером - свёрткой над
его историей со сложным оптимизатором, а айтем - простым EmbeddingLayer
с SGD без мом и рег.

Таким образом, получилось переосмыслить академическую позицию касательно
геометрии движения эмбеддингов при обучении на косинусный лосс. И хотя
ортогональность их движения (и соответственно popbias) требует строгих
ограничений на архитектуру энкодера, популярные двухбашенные модели
могут использовать в качестве одной из башен такую ограниченную
архитектуру, что неизбежно приводит к ортогональному движению -\>
корреляцию норм эмбеддингов объектов этой башни с их популярностью
(частотой встречания в датасете). Что может быть критично для дальнейших
задач ранжирования, например index search с использованием dot product,
если не знать о такой особенности процесса обучения.

### Код экспериментов №1 и №4

Я выбрал эти эксперименты как самые показательные для описываемого
явления; 1 эксперимент воспроизводит условия обучения, при которых
эмбеддинги левого энкодера движутся ортогонально. 4 эксперимент нарушает
эти условия (реализуя "общий" дизайн модели, используемый, например, в
статье NormFace) и показывает, что если они нарушаются, то эмбеддинги
движутся хаотично, а не ортогонально. Код позволяет мониторить динамику
движения эмбеддингов через численные показатели.

Код эксперимента №1 (архитектура левого энкодера состоит только из
Embedding)

<div class="spoiler__content">

``` python
import math
import random

import numpy as np
import pandas as pd
from tqdm import tqdm
import plotly.express as px
import matplotlib.pyplot as plt
from sklearn.preprocessing import LabelEncoder
import torch
import torch.nn as nn
from torch.utils.data import DataLoader, Dataset
from info_nce import InfoNCE # pip install info-nce-pytorch


torch.manual_seed(0)
np.random.seed(0)
random.seed(0)

device = 'cuda' if torch.cuda.is_available() else 'cpu'

# игрушечные данные - коллаборативная модель выучит, что 5 юзер, 
# 6 юзер и 7 юзер близки друг к другу из-за позитивных
# взаимодействий с одними и теми же айтемами (5i* и 6i*)
train = pd.DataFrame([], columns=["user_id", "item_id"])

train.loc[len(train)] = ["1u", "1i1"]
train.loc[len(train)] = ["1u", "1i2"]
train.loc[len(train)] = ["1u", "1i3"]
train.loc[len(train)] = ["2u", "2i1"]
train.loc[len(train)] = ["2u", "2i2"]
train.loc[len(train)] = ["2u", "2i3"]
train.loc[len(train)] = ["3u", "3i1"]
train.loc[len(train)] = ["3u", "3i2"]
train.loc[len(train)] = ["3u", "3i3"]
train.loc[len(train)] = ["4u", "4i1"]
train.loc[len(train)] = ["4u", "4i2"]
train.loc[len(train)] = ["4u", "4i3"]
train.loc[len(train)] = ["5u", "5i1"]
train.loc[len(train)] = ["5u", "5i2"]
train.loc[len(train)] = ["5u", "5i3"]
train.loc[len(train)] = ["6u", "6i1"]
train.loc[len(train)] = ["6u", "6i2"]
train.loc[len(train)] = ["6u", "6i3"]
train.loc[len(train)] = ["7u", "5i1"]
train.loc[len(train)] = ["7u", "5i2"]
train.loc[len(train)] = ["7u", "5i3"]
train.loc[len(train)] = ["7u", "5i4"]
train.loc[len(train)] = ["7u", "6i1"]
train.loc[len(train)] = ["7u", "6i2"]
train.loc[len(train)] = ["7u", "6i3"]

user_encoder = LabelEncoder().fit(train["user_id"])
item_encoder = LabelEncoder().fit(train["item_id"])

class TwoTowerDataset(Dataset):

    def __init__(self,
                 positive_interactions_dataframe,
                 user_encoder, 
                 item_encoder
                ):
        self.positive_interactions_dataframe = \
        positive_interactions_dataframe.copy()
        
        self.positive_interactions_dataframe["encoded_user_id"] = \
        user_encoder.transform(self.positive_interactions_dataframe.user_id)
        self.positive_interactions_dataframe["encoded_item_id"] = \
        item_encoder.transform(self.positive_interactions_dataframe.item_id)
        
        self.user2features = {}
        self.item2features = {}
        self.interactions_features_list = []

        for row in tqdm(self.positive_interactions_dataframe.itertuples()):
            self.interactions_features_list.append(
                (
                    (row.encoded_user_id,),
                    (row.encoded_item_id,)
                )
            )
            if row.user_id not in self.user2features:
                self.user2features[row.user_id] = (row.encoded_user_id,)

            if row.item_id not in self.item2features:
                self.item2features[row.item_id] = (row.encoded_item_id,)

        self.start = 0
        self.end = len(self.interactions_features_list)
    
    def __len__(self):
        return len(self.interactions_features_list)
    
    def __getitem__(self, i):
        return self.interactions_features_list[i]


train_dataset = TwoTowerDataset(train, user_encoder, item_encoder)

def collate_fn(batch):
    users_features, items_features = zip(*batch)

    return (
        torch.IntTensor(np.array(users_features)),
        torch.IntTensor(np.array(items_features)),
    )

train_loader = DataLoader(
    train_dataset,
    batch_size=len(train_dataset),
    collate_fn=collate_fn
)

class TwoTowerModel(nn.Module):
    def __init__(self, user_embedding_sizes, item_embedding_sizes, device):
        super(TwoTowerModel, self).__init__()
        self.device = device

        self.user_embeds = nn.Embedding(
            user_embedding_sizes[0], 
            user_embedding_sizes[1]
        )
        self.item_embeds = nn.Embedding(
            item_embedding_sizes[0], 
            item_embedding_sizes[1]
        )

    def get_user_embeddings(self, user_features):
        """Пользовательская часть TwoTower"""
        user_embeddings = self.user_embeds(user_features[:, 0])

        return user_embeddings

    def get_item_embeddings(self, item_features):
        """Айтемная часть TwoTower"""
        item_embeddings = self.item_embeds(item_features[:, 0])

        return item_embeddings

    def forward(self, user_features, item_features):
        user_embs = self.get_user_embeddings(user_features.to(self.device))
        item_embs = self.get_item_embeddings(item_features.to(self.device))

        return user_embs, item_embs

infonceloss = InfoNCE(temperature=1)

def plot_embedding_shift(
    old_users_embeddings,
    old_items_embeddings,
    new_users_embeddings,
    new_items_embeddings,
    users_ids,
    items_ids,
    title="Embedding Shift"
):
    """
    Рисует сдвиг эмбеддингов с окружностью разных радиусов.
    
    old_users_embeddings: Тензор старых эмбеддингов юзеров
    old_items_embeddings: Тензор старых эмбеддингов айтемов
    new_users_embeddings: Тензор новых эмбеддингов юзеров
    new_items_embeddings: Тензор новых эмбеддингов айтемов
    users_ids: Список id юзеров в порядке, соответствующем порядку 
        эмбеддингов юзеров
    items_ids: Список id айтемов в порядке, соответствующем порядку 
        эмбеддингов айтемов
    """
    old_users_embeddings = old_users_embeddings.cpu().detach().numpy()
    old_items_embeddings = old_items_embeddings.cpu().detach().numpy()
    new_users_embeddings = new_users_embeddings.cpu().detach().numpy()
    new_items_embeddings = new_items_embeddings.cpu().detach().numpy()

    # Вводим новую метрику: какая доля градиентов расположена 
    # перпендикулярно радиус-вектору

    # для юзеров:
    count_orthogonal_users = 0
    for i in range(len(old_users_embeddings)):
        grad = new_users_embeddings[i] - old_users_embeddings[i]
        
        is_orthogonal = math.isclose(
            grad @ old_users_embeddings[i], 
            0, 
            abs_tol=1e-6
        )
        if is_orthogonal:
            count_orthogonal_users += 1
            
    print(
        "Доля юзеров, для которых градиент направлен строго по "
        "касательной к гиперсфере, на которой изначально лежал "
        "эмбеддинг этого объекта: ",
        count_orthogonal_users / len(old_users_embeddings)
    )

    # для айтемов:
    count_orthogonal_items = 0
    for i in range(len(old_items_embeddings)):
        grad = new_items_embeddings[i] - old_items_embeddings[i]
        
        is_orthogonal = math.isclose(
            grad @ old_items_embeddings[i], 
            0, 
            abs_tol=1e-6
        )
        if is_orthogonal:
            count_orthogonal_items += 1
            
    print(
        "Доля айтемов, для которых градиент направлен строго по "
        "касательной к гиперсфере, на которой изначально лежал "
        "эмбеддинг этого объекта: ",
        count_orthogonal_items / len(old_items_embeddings)
    )

    if old_users_embeddings.shape[1] == 2:
        # Дальнейшая визуализация - только для двумерного случая:

        old_embs = torch.cat(
            (
                torch.from_numpy(old_users_embeddings), 
                torch.from_numpy(old_items_embeddings)
            ),
            0
        ).numpy()
        new_embs = torch.cat(
            (
                torch.from_numpy(new_users_embeddings), 
                torch.from_numpy(new_items_embeddings)
            ), 
            0
        ).numpy()
        ids=users_ids+items_ids
        
        # Создаем DataFrame для интерактивного графика
        df = pd.DataFrame({
            "old_x": old_embs[:, 0],
            "old_y": old_embs[:, 1],
            "new_x": new_embs[:, 0],
            "new_y": new_embs[:, 1],
            "id": ids
        })
    
        # График со стрелками
        fig, ax = plt.subplots(figsize=(20, 14))
        
        # Рисуем стрелки
        for i in range(len(df)):
            ax.arrow(df["old_x"][i],
                     df["old_y"][i],
                     df["new_x"][i] - df["old_x"][i],
                     df["new_y"][i] - df["old_y"][i],
                     head_width=max(
                         np.sqrt((df["new_x"][i] - df["old_x"][i])**2 +
                                 (df["new_y"][i] - df["old_y"][i])**2) * 0.2,
                         0.1),
                     head_length=max(
                         np.sqrt((df["new_x"][i] - df["old_x"][i])**2 +
                                 (df["new_y"][i] - df["old_y"][i])**2) * 0.2,
                         0.1),
                     fc='blue',
                     ec='blue',
                     alpha=0.7)

        # Точки эмбеддингов
        ax.scatter(df["new_x"],
                   df["new_y"],
                   color='red',
                   label="New Positions",
                   s=30)
        ax.scatter(df["old_x"],
                   df["old_y"],
                   color='gray',
                   alpha=0.5,
                   label="Old Positions",
                   s=30)

        # Рисуем оси и разные окружности
        line1 = plt.axline((1, 0), (0, 0),
                           color='black',
                           linestyle='dashed',
                           linewidth=2)
        line2 = plt.axline((0, 1), (0, 0),
                           color='black',
                           linestyle='dashed',
                           linewidth=2)

        circle1 = plt.Circle((0, 0),
                             1,
                             color='green',
                             fill=False,
                             linestyle='dashed',
                             linewidth=2)
        ax.add_patch(circle1)

        circle2 = plt.Circle((0, 0),
                             1.5,
                             color='green',
                             fill=False,
                             linestyle='dashed',
                             linewidth=2)
        ax.add_patch(circle2)

        circle3 = plt.Circle((0, 0),
                             2,
                             color='green',
                             fill=False,
                             linestyle='dashed',
                             linewidth=2)
        ax.add_patch(circle3)

        # Настройки осей и легенды
        ax.set_xlim(-3, 3)
        ax.set_ylim(-3, 3)
        ax.set_title(title)
        ax.legend()
        ax.set_aspect('equal')

        plt.show()

        # Интерактивная версия с plotly (отображение id при наведении)
        fig_interactive = px.scatter(df,
                                     x="new_x",
                                     y="new_y",
                                     text="id",
                                     title="Embedding Positions with IDs",
                                     hover_data={
                                         "id": True,
                                         "new_x": False,
                                         "new_y": False
                                     })

        fig_interactive.update_layout(
            autosize=False,
            width=800,
            height=800,
        )

        fig_interactive.show()

user_embedding_sizes = [len(user_encoder.classes_), 2]
item_embedding_sizes = [len(item_encoder.classes_), 2]

model = TwoTowerModel(user_embedding_sizes, item_embedding_sizes, 
                      device).to(device)

optimizer = torch.optim.SGD(model.parameters(), lr=5, momentum=0)

users_ids, users_features = zip(*train_dataset.user2features.items())
items_ids, items_features = zip(*train_dataset.item2features.items())

def train_loop(model, optimizer, train_loader, n_epochs=100):
    loss_history = list()
    for epoch in range(n_epochs):
        for batch in tqdm(train_loader, desc=f'Epoch {epoch}'):
            
            user_embs, item_embs = model(*batch)
            loss = infonceloss(user_embs, item_embs)

            optimizer.zero_grad()
            loss.backward()

            old_users_embeddings = model.get_user_embeddings(
                torch.IntTensor(np.array(users_features)).to(device)
            )
            old_items_embeddings = model.get_item_embeddings(
                torch.IntTensor(np.array(items_features)).to(device)
            )

            optimizer.step()

            new_users_embeddings = model.get_user_embeddings(
                torch.IntTensor(np.array(users_features)).to(device)
            )
            new_items_embeddings = model.get_item_embeddings(
                torch.IntTensor(np.array(items_features)).to(device)
            )

            loss_history.append(loss.item())
            
            # отображаем только первые эпохи, эпоху посередине и последнюю
            if (epoch < 3) or (epoch == n_epochs//2) or (epoch == n_epochs-1):
                print(f'Train loss: {loss_history[-1]}')
                plot_embedding_shift(
                    old_users_embeddings,
                    old_items_embeddings,
                    new_users_embeddings,
                    new_items_embeddings,
                    users_ids,
                    items_ids
                )

model.train()
train_loop(model, optimizer, train_loader)
```

</div>

Код эксперимента №4 (архитектура левого энкодера состоит из
Embedding→Linear)

<div class="spoiler__content">

``` python
import math
import random

import numpy as np
import pandas as pd
from tqdm import tqdm
import plotly.express as px
import matplotlib.pyplot as plt
from sklearn.preprocessing import LabelEncoder
import torch
import torch.nn as nn
from torch.utils.data import DataLoader, Dataset
from info_nce import InfoNCE # pip install info-nce-pytorch


torch.manual_seed(0)
np.random.seed(0)
random.seed(0)

device = 'cuda' if torch.cuda.is_available() else 'cpu'

# игрушечные данные - коллаборативная модель выучит, что 5 юзер, 
# 6 юзер и 7 юзер близки друг к другу из-за позитивных
# взаимодействий с одними и теми же айтемами (5i* и 6i*)
train = pd.DataFrame([], columns=["user_id", "item_id"])

train.loc[len(train)] = ["1u", "1i1"]
train.loc[len(train)] = ["1u", "1i2"]
train.loc[len(train)] = ["1u", "1i3"]
train.loc[len(train)] = ["2u", "2i1"]
train.loc[len(train)] = ["2u", "2i2"]
train.loc[len(train)] = ["2u", "2i3"]
train.loc[len(train)] = ["3u", "3i1"]
train.loc[len(train)] = ["3u", "3i2"]
train.loc[len(train)] = ["3u", "3i3"]
train.loc[len(train)] = ["4u", "4i1"]
train.loc[len(train)] = ["4u", "4i2"]
train.loc[len(train)] = ["4u", "4i3"]
train.loc[len(train)] = ["5u", "5i1"]
train.loc[len(train)] = ["5u", "5i2"]
train.loc[len(train)] = ["5u", "5i3"]
train.loc[len(train)] = ["6u", "6i1"]
train.loc[len(train)] = ["6u", "6i2"]
train.loc[len(train)] = ["6u", "6i3"]
train.loc[len(train)] = ["7u", "5i1"]
train.loc[len(train)] = ["7u", "5i2"]
train.loc[len(train)] = ["7u", "5i3"]
train.loc[len(train)] = ["7u", "5i4"]
train.loc[len(train)] = ["7u", "6i1"]
train.loc[len(train)] = ["7u", "6i2"]
train.loc[len(train)] = ["7u", "6i3"]

user_encoder = LabelEncoder().fit(train["user_id"])
item_encoder = LabelEncoder().fit(train["item_id"])

class TwoTowerDataset(Dataset):

    def __init__(self,
                 positive_interactions_dataframe,
                 user_encoder, 
                 item_encoder
                ):
        self.positive_interactions_dataframe = \
        positive_interactions_dataframe.copy()
        
        self.positive_interactions_dataframe["encoded_user_id"] = \
        user_encoder.transform(self.positive_interactions_dataframe.user_id)
        self.positive_interactions_dataframe["encoded_item_id"] = \
        item_encoder.transform(self.positive_interactions_dataframe.item_id)
        
        self.user2features = {}
        self.item2features = {}
        self.interactions_features_list = []

        for row in tqdm(self.positive_interactions_dataframe.itertuples()):
            self.interactions_features_list.append(
                (
                    (row.encoded_user_id,),
                    (row.encoded_item_id,)
                )
            )
            if row.user_id not in self.user2features:
                self.user2features[row.user_id] = (row.encoded_user_id,)

            if row.item_id not in self.item2features:
                self.item2features[row.item_id] = (row.encoded_item_id,)

        self.start = 0
        self.end = len(self.interactions_features_list)
    
    def __len__(self):
        return len(self.interactions_features_list)
    
    def __getitem__(self, i):
        return self.interactions_features_list[i]


train_dataset = TwoTowerDataset(train, user_encoder, item_encoder)

def collate_fn(batch):
    users_features, items_features = zip(*batch)

    return (
        torch.IntTensor(np.array(users_features)),
        torch.IntTensor(np.array(items_features)),
    )

train_loader = DataLoader(
    train_dataset,
    batch_size=len(train_dataset),
    collate_fn=collate_fn
)

class TwoTowerModel(nn.Module):
    def __init__(self, user_embedding_sizes, item_embedding_sizes, device):
        super(TwoTowerModel, self).__init__()
        self.device = device

        self.user_embeds = nn.Embedding(
            user_embedding_sizes[0], 
            user_embedding_sizes[1]
        )
        self.user_linear = nn.Linear(
            user_embedding_sizes[1], 
            user_embedding_sizes[1]
        )
        self.item_embeds = nn.Embedding(
            item_embedding_sizes[0], 
            item_embedding_sizes[1]
        )

    def get_user_embeddings(self, user_features):
        """Пользовательская часть TwoTower"""
        user_embeddings = self.user_embeds(user_features[:, 0])
        user_embeddings = self.user_linear(user_embeddings)

        return user_embeddings

    def get_item_embeddings(self, item_features):
        """Айтемная часть TwoTower"""
        item_embeddings = self.item_embeds(item_features[:, 0])

        return item_embeddings

    def forward(self, user_features, item_features):
        user_embs = self.get_user_embeddings(user_features.to(self.device))
        item_embs = self.get_item_embeddings(item_features.to(self.device))

        return user_embs, item_embs

infonceloss = InfoNCE(temperature=1)

def plot_embedding_shift(
    old_users_embeddings,
    old_items_embeddings,
    new_users_embeddings,
    new_items_embeddings,
    users_ids,
    items_ids,
    title="Embedding Shift"
):
    """
    Рисует сдвиг эмбеддингов с окружностью разных радиусов.
    
    old_users_embeddings: Тензор старых эмбеддингов юзеров
    old_items_embeddings: Тензор старых эмбеддингов айтемов
    new_users_embeddings: Тензор новых эмбеддингов юзеров
    new_items_embeddings: Тензор новых эмбеддингов айтемов
    users_ids: Список id юзеров в порядке, соответствующем порядку 
        эмбеддингов юзеров
    items_ids: Список id айтемов в порядке, соответствующем порядку 
        эмбеддингов айтемов
    """
    old_users_embeddings = old_users_embeddings.cpu().detach().numpy()
    old_items_embeddings = old_items_embeddings.cpu().detach().numpy()
    new_users_embeddings = new_users_embeddings.cpu().detach().numpy()
    new_items_embeddings = new_items_embeddings.cpu().detach().numpy()

    # Вводим новую метрику: какая доля градиентов расположена 
    # перпендикулярно радиус-вектору

    # для юзеров:
    count_orthogonal_users = 0
    for i in range(len(old_users_embeddings)):
        grad = new_users_embeddings[i] - old_users_embeddings[i]
        
        is_orthogonal = math.isclose(
            grad @ old_users_embeddings[i], 
            0, 
            abs_tol=1e-6
        )
        if is_orthogonal:
            count_orthogonal_users += 1
            
    print(
        "Доля юзеров, для которых градиент направлен строго по "
        "касательной к гиперсфере, на которой изначально лежал "
        "эмбеддинг этого объекта: ",
        count_orthogonal_users / len(old_users_embeddings)
    )

    # для айтемов:
    count_orthogonal_items = 0
    for i in range(len(old_items_embeddings)):
        grad = new_items_embeddings[i] - old_items_embeddings[i]
        
        is_orthogonal = math.isclose(
            grad @ old_items_embeddings[i], 
            0, 
            abs_tol=1e-6
        )
        if is_orthogonal:
            count_orthogonal_items += 1
            
    print(
        "Доля айтемов, для которых градиент направлен строго по "
        "касательной к гиперсфере, на которой изначально лежал "
        "эмбеддинг этого объекта: ",
        count_orthogonal_items / len(old_items_embeddings)
    )

    if old_users_embeddings.shape[1] == 2:
        # Дальнейшая визуализация - только для двумерного случая:

        old_embs = torch.cat(
            (
                torch.from_numpy(old_users_embeddings), 
                torch.from_numpy(old_items_embeddings)
            ),
            0
        ).numpy()
        new_embs = torch.cat(
            (
                torch.from_numpy(new_users_embeddings), 
                torch.from_numpy(new_items_embeddings)
            ), 
            0
        ).numpy()
        ids=users_ids+items_ids
        
        # Создаем DataFrame для интерактивного графика
        df = pd.DataFrame({
            "old_x": old_embs[:, 0],
            "old_y": old_embs[:, 1],
            "new_x": new_embs[:, 0],
            "new_y": new_embs[:, 1],
            "id": ids
        })
    
        # График со стрелками
        fig, ax = plt.subplots(figsize=(20, 14))
        
        # Рисуем стрелки
        for i in range(len(df)):
            ax.arrow(df["old_x"][i],
                     df["old_y"][i],
                     df["new_x"][i] - df["old_x"][i],
                     df["new_y"][i] - df["old_y"][i],
                     head_width=max(
                         np.sqrt((df["new_x"][i] - df["old_x"][i])**2 +
                                 (df["new_y"][i] - df["old_y"][i])**2) * 0.2,
                         0.1),
                     head_length=max(
                         np.sqrt((df["new_x"][i] - df["old_x"][i])**2 +
                                 (df["new_y"][i] - df["old_y"][i])**2) * 0.2,
                         0.1),
                     fc='blue',
                     ec='blue',
                     alpha=0.7)

        # Точки эмбеддингов
        ax.scatter(df["new_x"],
                   df["new_y"],
                   color='red',
                   label="New Positions",
                   s=30)
        ax.scatter(df["old_x"],
                   df["old_y"],
                   color='gray',
                   alpha=0.5,
                   label="Old Positions",
                   s=30)

        # Рисуем оси и разные окружности
        line1 = plt.axline((1, 0), (0, 0),
                           color='black',
                           linestyle='dashed',
                           linewidth=2)
        line2 = plt.axline((0, 1), (0, 0),
                           color='black',
                           linestyle='dashed',
                           linewidth=2)

        circle1 = plt.Circle((0, 0),
                             1,
                             color='green',
                             fill=False,
                             linestyle='dashed',
                             linewidth=2)
        ax.add_patch(circle1)

        circle2 = plt.Circle((0, 0),
                             1.5,
                             color='green',
                             fill=False,
                             linestyle='dashed',
                             linewidth=2)
        ax.add_patch(circle2)

        circle3 = plt.Circle((0, 0),
                             2,
                             color='green',
                             fill=False,
                             linestyle='dashed',
                             linewidth=2)
        ax.add_patch(circle3)

        # Настройки осей и легенды
        ax.set_xlim(-3, 3)
        ax.set_ylim(-3, 3)
        ax.set_title(title)
        ax.legend()
        ax.set_aspect('equal')

        plt.show()

        # Интерактивная версия с plotly (отображение id при наведении)
        fig_interactive = px.scatter(df,
                                     x="new_x",
                                     y="new_y",
                                     text="id",
                                     title="Embedding Positions with IDs",
                                     hover_data={
                                         "id": True,
                                         "new_x": False,
                                         "new_y": False
                                     })

        fig_interactive.update_layout(
            autosize=False,
            width=800,
            height=800,
        )

        fig_interactive.show()

user_embedding_sizes = [len(user_encoder.classes_), 2]
item_embedding_sizes = [len(item_encoder.classes_), 2]

model = TwoTowerModel(user_embedding_sizes, item_embedding_sizes, 
                      device).to(device)

optimizer = torch.optim.SGD(model.parameters(), lr=5, momentum=0)

users_ids, users_features = zip(*train_dataset.user2features.items())
items_ids, items_features = zip(*train_dataset.item2features.items())

def train_loop(model, optimizer, train_loader, n_epochs=100):
    loss_history = list()
    for epoch in range(n_epochs):
        for batch in tqdm(train_loader, desc=f'Epoch {epoch}'):
            
            user_embs, item_embs = model(*batch)
            loss = infonceloss(user_embs, item_embs)

            optimizer.zero_grad()
            loss.backward()

            old_users_embeddings = model.get_user_embeddings(
                torch.IntTensor(np.array(users_features)).to(device)
            )
            old_items_embeddings = model.get_item_embeddings(
                torch.IntTensor(np.array(items_features)).to(device)
            )

            optimizer.step()

            new_users_embeddings = model.get_user_embeddings(
                torch.IntTensor(np.array(users_features)).to(device)
            )
            new_items_embeddings = model.get_item_embeddings(
                torch.IntTensor(np.array(items_features)).to(device)
            )

            loss_history.append(loss.item())
            
            # отображаем только первые эпохи, эпоху посередине и последнюю
            if (epoch < 3) or (epoch == n_epochs//2) or (epoch == n_epochs-1):
                print(f'Train loss: {loss_history[-1]}')
                plot_embedding_shift(
                    old_users_embeddings,
                    old_items_embeddings,
                    new_users_embeddings,
                    new_items_embeddings,
                    users_ids,
                    items_ids
                )

model.train()
train_loop(model, optimizer, train_loader)
```

</div>

### Приложения

Приложение №1

<div class="spoiler__content">

Рассмотрим, почему скалярное произведение q на градиент косинуса по нему
действительно равно нулю:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/20deccdfa027b4bdc4d6cc28a1c6b9ea.svg"
class="formula"
data-source="\begin{align} \cos(\mathbf{q},\mathbf{k}) = f(\mathbf{q}) \;=\; \frac{\mathbf{q}^\top \mathbf{k}}{\|\mathbf{q}\|\;\|\mathbf{k}\|} \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/20d/ecc/dfa/20deccdfa027b4bdc4d6cc28a1c6b9ea.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/20d/ecc/dfa/20deccdfa027b4bdc4d6cc28a1c6b9ea.svg 781w"
loading="lazy" data-decode="async" width="257" height="52"
alt="\begin{align} \cos(\mathbf{q},\mathbf{k}) = f(\mathbf{q}) \;=\; \frac{\mathbf{q}^\top \mathbf{k}}{\|\mathbf{q}\|\;\|\mathbf{k}\|} \end{align}" />

Введем обозначения:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/ede85df9db65bbef827d37cc5963f0e4.svg"
class="formula"
data-source="\begin{align} f(\mathbf{q}) = \frac{u(\mathbf{q})}{v(\mathbf{q})}, \qquad u(\mathbf{q}) = \mathbf{q}^\top \mathbf{k}, \qquad v(\mathbf{q}) = \|\mathbf{q}\|\;\|\mathbf{k}\| \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/ede/85d/f9d/ede85df9db65bbef827d37cc5963f0e4.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/ede/85d/f9d/ede85df9db65bbef827d37cc5963f0e4.svg 781w"
loading="lazy" data-decode="async" width="443" height="50"
alt="\begin{align} f(\mathbf{q}) = \frac{u(\mathbf{q})}{v(\mathbf{q})}, \qquad u(\mathbf{q}) = \mathbf{q}^\top \mathbf{k}, \qquad v(\mathbf{q}) = \|\mathbf{q}\|\;\|\mathbf{k}\| \end{align}" />

Тогда, по правилу дифференцирования частного:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/00da3ff859728c7c75a40cb6b0bd80a7.svg"
class="formula"
data-source="\begin{align} \nabla_{\mathbf{q}} f = \nabla_{\mathbf{q}}\!\Bigl(\tfrac{u}{v}\Bigr) = \frac{v\,\nabla_{\mathbf{q}}u \;-\; u\,\nabla_{\mathbf{q}}v}{v^2} \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/00d/a3f/f85/00da3ff859728c7c75a40cb6b0bd80a7.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/00d/a3f/f85/00da3ff859728c7c75a40cb6b0bd80a7.svg 781w"
loading="lazy" data-decode="async" width="301" height="46"
alt="\begin{align} \nabla_{\mathbf{q}} f = \nabla_{\mathbf{q}}\!\Bigl(\tfrac{u}{v}\Bigr) = \frac{v\,\nabla_{\mathbf{q}}u \;-\; u\,\nabla_{\mathbf{q}}v}{v^2} \end{align}" />

Посчитаем:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/c61a116e8b5f52eeb654ccb82af7d45d.svg"
class="formula"
data-source="\begin{align} \nabla_{\mathbf{q}}u = \mathbf{k}, \qquad \nabla_{\mathbf{q}}v = \|\mathbf{k}\|\;\frac{\mathbf{q}}{\|\mathbf{q}\|} \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/c61/a11/6e8/c61a116e8b5f52eeb654ccb82af7d45d.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/c61/a11/6e8/c61a116e8b5f52eeb654ccb82af7d45d.svg 781w"
loading="lazy" data-decode="async" width="268" height="44"
alt="\begin{align} \nabla_{\mathbf{q}}u = \mathbf{k}, \qquad \nabla_{\mathbf{q}}v = \|\mathbf{k}\|\;\frac{\mathbf{q}}{\|\mathbf{q}\|} \end{align}" />

Подставляем и получаем:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/28609a4f064e9e8adeb77ddd9bf6ff4c.svg"
class="formula"
data-source="\begin{align} \nabla_{\mathbf{q}} f = \frac{     \|\mathbf{q}\|\|\mathbf{k}\|\;\mathbf{k}     \;-\;     (\mathbf{q}^\top\mathbf{k})\,\|\mathbf{k}\|\;\tfrac{\mathbf{q}}{\|\mathbf{q}\|}   }{     \bigl(\|\mathbf{q}\|\|\mathbf{k}\|\bigr)^2   } = \frac{     \mathbf{k}     \;-\;     \tfrac{\mathbf{q}^\top\mathbf{k}}{\|\mathbf{q}\|^2}\,\mathbf{q}   }{     \|\mathbf{q}\|\;\|\mathbf{k}\|   } \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/286/09a/4f0/28609a4f064e9e8adeb77ddd9bf6ff4c.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/286/09a/4f0/28609a4f064e9e8adeb77ddd9bf6ff4c.svg 781w"
loading="lazy" data-decode="async" width="444" height="76"
alt="\begin{align} \nabla_{\mathbf{q}} f = \frac{ \|\mathbf{q}\|\|\mathbf{k}\|\;\mathbf{k} \;-\; (\mathbf{q}^\top\mathbf{k})\,\|\mathbf{k}\|\;\tfrac{\mathbf{q}}{\|\mathbf{q}\|} }{ \bigl(\|\mathbf{q}\|\|\mathbf{k}\|\bigr)^2 } = \frac{ \mathbf{k} \;-\; \tfrac{\mathbf{q}^\top\mathbf{k}}{\|\mathbf{q}\|^2}\,\mathbf{q} }{ \|\mathbf{q}\|\;\|\mathbf{k}\| } \end{align}" />

Умножим полученное на вектор q:

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/8a13f3412602f07824afa2d1257f96a4.svg"
class="formula"
data-source="\begin{align} \mathbf{q}^\top\nabla_{\mathbf{q}} f = \frac{     \mathbf{q}^\top\mathbf{k}     - \tfrac{\mathbf{q}^\top\mathbf{k}}{\|\mathbf{q}\|^2}\,\mathbf{q}^\top\mathbf{q}   }{\|\mathbf{q}\|\;\|\mathbf{k}\|} = \frac{     \mathbf{q}^\top\mathbf{k}     - \tfrac{\mathbf{q}^\top\mathbf{k}}{\|\mathbf{q}\|^2}\,\|\mathbf{q}\|^2   }{\|\mathbf{q}\|\;\|\mathbf{k}\|} = \frac{     \mathbf{q}^\top\mathbf{k}     - \mathbf{q}^\top\mathbf{k}   }{\|\mathbf{q}\|\;\|\mathbf{k}\|} = 0\end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/8a1/3f3/412/8a13f3412602f07824afa2d1257f96a4.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/8a1/3f3/412/8a13f3412602f07824afa2d1257f96a4.svg 781w"
loading="lazy" data-decode="async" width="576" height="68"
alt="\begin{align} \mathbf{q}^\top\nabla_{\mathbf{q}} f = \frac{ \mathbf{q}^\top\mathbf{k} - \tfrac{\mathbf{q}^\top\mathbf{k}}{\|\mathbf{q}\|^2}\,\mathbf{q}^\top\mathbf{q} }{\|\mathbf{q}\|\;\|\mathbf{k}\|} = \frac{ \mathbf{q}^\top\mathbf{k} - \tfrac{\mathbf{q}^\top\mathbf{k}}{\|\mathbf{q}\|^2}\,\|\mathbf{q}\|^2 }{\|\mathbf{q}\|\;\|\mathbf{k}\|} = \frac{ \mathbf{q}^\top\mathbf{k} - \mathbf{q}^\top\mathbf{k} }{\|\mathbf{q}\|\;\|\mathbf{k}\|} = 0\end{align}" />

ЧТД!

</div>

Приложение №2

<div class="spoiler__content">

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/75ffe856e516166165e2bbdab424e949.svg"
class="formula"
data-source="\begin{align} &amp; \text{Как было разобрано при доказательстве высказывания} \\ &amp; \textit{Чем длиннее $q$, тем меньше норма градиента косинусного лосса по $q$:} \\ &amp; \quad s = \|q\|^{2} \\ &amp; \Delta(s) = \eta^{2} \|\nabla_{q}L(q)\|^{2} = \frac{\eta^{2}}{s} \|Pu\|^{2}, \\ &amp; \text{то есть } \Delta(s) = \frac{c}{s} \text{ , где} \\ &amp; c = \eta^{2} \|Pu\|^{2}\\ \\ &amp; \textbf{Почему } c \textbf{ меняется умеренно (или резко, но редко)} \\ \\ &amp; \textbf{1. Событие $\|u_{t+1}\| \gg \|u_{t}\|$ является редким:} \\ \\ &amp; \text{Норма суммарного градиента $u$:} \\ &amp; u = \sum_{i=1}^m \frac{\partial F}{\partial cos_i} \; \hat{k}_i \\ &amp; \text{не может постоянно сильно расти в сходящемся процессе} \\ &amp; \text{обучения, потому что эмбеддинги двигаются в} \\  &amp; \text{свои оптимальные позиции и «сигналы ошибки» $\frac{\partial F}{\partial cos}$, если не} \\ &amp; \text{затухают, то хотя бы точно стабилизируются.} \textbf{ Постоянный резкий} \\ &amp; \textbf{рост нормы суммарного градиента $u$ сигнализировал бы о} \\ &amp; \textbf{расходящемся процессе обучения.} \\ \\ &amp; \text{Если немного опустить формальность рассуждений, то дополнительно можно} \\ &amp; \text{заявить, что для резкого роста нормы $u$ потребовалось бы, чтобы одновременно} \\ &amp; \text{все вклады $\hat{k}_i$ сонаправленно сложились в касательную плоскость к $q$ — я} \\ &amp; \text{предполагаю, что при случайном процессе сбора батча это событие является} \\ &amp; \text{маловероятным. Даже если по каким-то причинам такое случается часто, то} \\ &amp; \text{сумма вкладов ограничена числом пар с этим объектом в трейне и} \\ &amp; \text{значением $\frac{\partial F}{\partial cos}$, стабильность которого я строго обосновал выше.} \\ \\ &amp; \textbf{2. Если это редкое событие, вызвавшее $s &lt; \sqrt{c}$, случилось:} \\ \\ &amp; \text{То на этом же шаге} \\ &amp; s_{t+1} = s_{t} + \frac{c_{t}}{s_{t}} \ge 2\sqrt{c_{t}} \ge \sqrt{c_{t}}, \\ &amp; \text{и условие } \Phi&#39;(s) \ge 0 \text{ снова выполняется — при выросшем $s$ нарушить его снова} \\ &amp; \text{уже сложнее.} \end{align}"
sizes="(max-width: 780px) 100vw, 50vw"
srcset="https://habrastorage.org/getpro/habr/upload_files/75f/fe8/56e/75ffe856e516166165e2bbdab424e949.svg 780w,
       https://habrastorage.org/getpro/habr/upload_files/75f/fe8/56e/75ffe856e516166165e2bbdab424e949.svg 781w"
loading="lazy" data-decode="async" width="583" height="1104"
alt="\begin{align} &amp; \text{Как было разобрано при доказательстве высказывания} \\ &amp; \textit{Чем длиннее $q$, тем меньше норма градиента косинусного лосса по $q$:} \\ &amp; \quad s = \|q\|^{2} \\ &amp; \Delta(s) = \eta^{2} \|\nabla_{q}L(q)\|^{2} = \frac{\eta^{2}}{s} \|Pu\|^{2}, \\ &amp; \text{то есть } \Delta(s) = \frac{c}{s} \text{ , где} \\ &amp; c = \eta^{2} \|Pu\|^{2}\\ \\ &amp; \textbf{Почему } c \textbf{ меняется умеренно (или резко, но редко)} \\ \\ &amp; \textbf{1. Событие $\|u_{t+1}\| \gg \|u_{t}\|$ является редким:} \\ \\ &amp; \text{Норма суммарного градиента $u$:} \\ &amp; u = \sum_{i=1}^m \frac{\partial F}{\partial cos_i} \; \hat{k}_i \\ &amp; \text{не может постоянно сильно расти в сходящемся процессе} \\ &amp; \text{обучения, потому что эмбеддинги двигаются в} \\ &amp; \text{свои оптимальные позиции и «сигналы ошибки» $\frac{\partial F}{\partial cos}$, если не} \\ &amp; \text{затухают, то хотя бы точно стабилизируются.} \textbf{ Постоянный резкий} \\ &amp; \textbf{рост нормы суммарного градиента $u$ сигнализировал бы о} \\ &amp; \textbf{расходящемся процессе обучения.} \\ \\ &amp; \text{Если немного опустить формальность рассуждений, то дополнительно можно} \\ &amp; \text{заявить, что для резкого роста нормы $u$ потребовалось бы, чтобы одновременно} \\ &amp; \text{все вклады $\hat{k}_i$ сонаправленно сложились в касательную плоскость к $q$ — я} \\ &amp; \text{предполагаю, что при случайном процессе сбора батча это событие является} \\ &amp; \text{маловероятным. Даже если по каким-то причинам такое случается часто, то} \\ &amp; \text{сумма вкладов ограничена числом пар с этим объектом в трейне и} \\ &amp; \text{значением $\frac{\partial F}{\partial cos}$, стабильность которого я строго обосновал выше.} \\ \\ &amp; \textbf{2. Если это редкое событие, вызвавшее $s &lt; \sqrt{c}$, случилось:} \\ \\ &amp; \text{То на этом же шаге} \\ &amp; s_{t+1} = s_{t} + \frac{c_{t}}{s_{t}} \ge 2\sqrt{c_{t}} \ge \sqrt{c_{t}}, \\ &amp; \text{и условие } \Phi&#39;(s) \ge 0 \text{ снова выполняется — при выросшем $s$ нарушить его снова} \\ &amp; \text{уже сложнее.} \end{align}" />

</div>

</div>

</div>

</div>

</div>

<div class="pswp" v-367403b9="" aria-hidden="true" role="dialog"
tabindex="-1">

<div class="pswp__bg">

</div>

<div class="pswp__scroll-wrap">

<div class="pswp__container">

<div class="pswp__item">

</div>

<div class="pswp__item">

</div>

<div class="pswp__item">

</div>

</div>

<div class="pswp__ui pswp__ui--hidden">

<div class="pswp__top-bar">

<span class="tm-svg-icon__wrapper pswp__button pswp__button--close"><img
src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIxNiIgd2lkdGg9IjE2Ij48dGl0bGU+0JfQsNC60YDRi9GC0Yw8L3RpdGxlPjx1c2UgeGxpbms6aHJlZj0iL2ltZy9tZWdhem9yZC12MjguNDk3ZWY3ODkuLnN2ZyNjbG9zZSIgLz48L3N2Zz4="
class="tm-svg-img tm-svg-icon" /></span>

<div class="pswp__preloader">

<div class="pswp__preloader__icn">

<div class="pswp__preloader__cut">

<div class="pswp__preloader__donut">

</div>

</div>

</div>

</div>

</div>

<img
src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgY2xhc3M9InBzd3BfX2J1dHRvbi1pY29uIj48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE1LjcwNyA0LjI5M2ExIDEgMCAwMTAgMS40MTRMOS40MTQgMTJsNi4yOTMgNi4yOTNhMSAxIDAgMDEtMS40MTQgMS40MTRsLTctN2ExIDEgMCAwMTAtMS40MTRsNy03YTEgMSAwIDAxMS40MTQgMCIgZmlsbD0iY3VycmVudENvbG9yIiAvPjwvc3ZnPg=="
class="pswp__button-icon" />

<img
src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgY2xhc3M9InBzd3BfX2J1dHRvbi1pY29uIj48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE1LjcwNyA0LjI5M2ExIDEgMCAwMTAgMS40MTRMOS40MTQgMTJsNi4yOTMgNi4yOTNhMSAxIDAgMDEtMS40MTQgMS40MTRsLTctN2ExIDEgMCAwMTAtMS40MTRsNy03YTEgMSAwIDAxMS40MTQgMCIgZmlsbD0iY3VycmVudENvbG9yIiAvPjwvc3ZnPg=="
class="pswp__button-icon" />

</div>

</div>

</div>

</div>

<div class="tm-article-presenter__meta" test-id="article-meta-links">

<div class="tm-separated-list tag-list tm-article-presenter__meta-list">

<span class="tm-separated-list__title">Теги:</span>

- <a
  href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BC%D0%B0%D1%82%D0%B5%D0%BC%D0%B0%D1%82%D0%B8%D0%BA%D0%B0%5D"
  class="link"><span>математика</span></a>

</div>

<div class="tm-separated-list tm-article-presenter__meta-list">

<span class="tm-separated-list__title">Хабы:</span>

- <a href="https://habr.com/ru/hubs/maths/"
  class="link"><span>Математика</span></a>
- <a href="https://habr.com/ru/hubs/machine_learning/"
  class="link"><span>Машинное обучение</span></a>

</div>

</div>

</div>

</div>

<div class="tm-article-sticky-panel" test-id="article-sticky-panel">

<div class="tm-data-icons tm-data-icons tm-data-icons_space-big tm-article-sticky-panel__icons"
test-id="article-stats-icons">

<div class="article-rating tm-data-icons__item" v-b9b05a90="">

<div class="tm-votes-meter votes-switcher" v-b9b05a90="">

<img
src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbl9hcHBlYXJhbmNlLWFydGljbGUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCg0LXQudGC0LjQvdCzPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci1yYXRpbmciIC8+PC9zdmc+"
class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_appearance-article" /><span class="tm-votes-meter__value tm-votes-meter__value tm-votes-meter__value_appearance-article tm-votes-meter__value_rating"
test-id="votes-meter-value">0</span>

</div>

</div>

<span class="tm-svg-icon__wrapper bookmarks-button__icon"><img
src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JTQvtCx0LDQstC40YLRjCDQsiDQt9Cw0LrQu9Cw0LTQutC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci1mYXZvcml0ZSIgLz48L3N2Zz4="
class="tm-svg-img tm-svg-icon" /></span><span class="bookmarks-button__counter"
title="Количество пользователей, добавивших публикацию в закладки">0</span>

<div class="tm-sharing tm-data-icons__item" title="Поделиться">

<img
src="data:image/svg+xml;base64,PHN2ZyB2aWV3Ym94PSIwIDAgMjQgMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgY2xhc3M9InRtLXNoYXJpbmdfX2ljb24iPjxwYXRoIGZpbGw9ImN1cnJlbnRDb2xvciIgZD0iTTEzLjggMTMuOFYxOGw3LjItNi42TDEzLjggNXYzLjlDNSA4LjkgMyAxOC42IDMgMTguNmMyLjUtNC40IDYtNC44IDEwLjgtNC44eiIgLz48L3N2Zz4="
class="tm-sharing__icon" />

</div>

<div class="article-comments-counter-link-wrapper tm-data-icons__item"
v-a126af31="" title="Читать комментарии">

<a href="https://habr.com/ru/articles/956602/comments/"
class="article-comments-counter-link" data-v-a126af31=""
data-test-id="counter-comments"><img
src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
class="tm-svg-img icon" /><span class="value"
data-v-a126af31="">0</span></a>

</div>

</div>

</div>

</div>

<div class="tm-article-presenter__footer">

<div class="tm-article-blocks">

<div class="section tm-block tm-block tm-block_spacing-bottom">

<div class="tm-block__body tm-block__body tm-block__body_variant-balanced">

<div class="article-author" v-0a6f3590="" test-id="article-author-info">

<div class="tm-user-card tm-user-card tm-user-card_variant-article user-card"
v-0a6f3590="">

<div class="tm-user-card__info-container">

<div class="tm-user-card__header">

<div class="tm-user-card__header-data">

<a href="https://habr.com/ru/users/andrey_atamanyuk/"
class="tm-user-card__userpic tm-user-card__userpic_size-40"></a>

<div class="tm-entity-image">

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/110.png"
class="tm-entity-image__pic" />

</div>

<div class="tm-user-card__meta">

<div class="tm-counter-container karma" v-280b6385=""
title=" 4 голоса ">

<div class="tm-counter-container__header">

<div class="karma-display positive" v-f6952a2a="" v-280b6385="">

4

</div>

</div>

<div class="tm-counter-container__footer">

<div class="karma-text" v-280b6385="">

Карма

</div>

</div>

</div>

<div class="tm-counter-container">

<div class="tm-counter-container__header">

<div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating">

<div class="tm-votes-lever__score tm-votes-lever__score tm-votes-lever__score_appearance-rating">

<span class="tm-votes-lever__score-counter tm-votes-lever__score-counter tm-votes-lever__score-counter_rating"
test-id="votes-score-counter">0</span>

</div>

</div>

</div>

<div class="tm-counter-container__footer">

<span class="tm-rating__text tm-rating__text">Общий рейтинг</span>

</div>

</div>

</div>

</div>

</div>

<div class="tm-user-card__info tm-user-card__info tm-user-card__info_variant-article">

<div class="tm-user-card__title tm-user-card__title tm-user-card__title_variant-article">

<span class="tm-user-card__name tm-user-card__name tm-user-card__name_variant-article">Андрей
Атаманюк</span> <a href="https://habr.com/ru/users/andrey_atamanyuk/"
class="tm-user-card__nickname tm-user-card__nickname_variant-article">@andrey_atamanyuk</a>

</div>

Пользователь

</div>

</div>

<div class="tm-user-card__buttons tm-user-card__buttons tm-user-card__buttons_variant-article">

</div>

</div>

<div class="author-contacts" v-0a6f3590="" test-id="author-contacts">

</div>

</div>

</div>

</div>

<div class="sponsor-block" v-da2b3a2f="">

<div class="title" v-da2b3a2f="">

Хабр доступен 24/7 благодаря поддержке друзей

</div>

<div class="content-container" v-da2b3a2f="">

<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/qqeypn-py71suynxbusbakjdfjw.png"
class="content-image" data-v-da2b3a2f="" loading="lazy"
alt="Хабр Карьера Курсы" />

<div class="content" v-da2b3a2f="">

<div class="content-title-container" v-da2b3a2f="">

<div class="content-title" v-da2b3a2f="">

Хабр Курсы для всех

</div>

<div class="sponsor-mark" v-da2b3a2f="">

РЕКЛАМА

</div>

</div>

<div class="content-text" v-da2b3a2f="">

Практикум, Хекслет, SkyPro, авторские курсы — собрали всех и попросили
скидки. Осталось выбрать!

</div>

Перейти

</div>

</div>

<div class="footer" v-da2b3a2f="">

</div>

</div>

<div class="tm-article-blocks__comments">

<div id="publication-comments" class="tm-article-page-comments">

<div>

<div class="article-comments-counter-link-wrapper tm-article-comments-counter-button"
v-a126af31="">

<a href="https://habr.com/ru/articles/956602/comments/"
class="article-comments-counter-link button-style" data-v-a126af31=""
data-test-id="counter-comments"><img
src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiBpY29uLS1jb250cmFzdGVkIiBoZWlnaHQ9IjI0IiB3aWR0aD0iMjQiPjx0aXRsZT7QmtC+0LzQvNC10L3RgtCw0YDQuNC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci1jb21tZW50cyIgLz48L3N2Zz4="
class="tm-svg-img icon icon--contrasted" /><span
class="value value--contrasted" data-v-a126af31=""> Комментировать
</span></a>

</div>

</div>

</div>

</div>

<div class="section tm-block tm-block tm-block_spacing-bottom">

<div class="tm-block__header tm-block__header tm-block__header_variant-borderless">

<div class="tm-block__header-container">

## Публикации

</div>

</div>

<div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim">

<div class="tm-tabs tm-tabs">

<div>

Лучшие за сутки

Похожие

</div>

</div>

<div class="similar-and-daily__tab-view">

<div class="daily-articles-list">

- <div class="tm-article-snippet tm-article-snippet tm-article-snippet_noBorder"
  v-5c5a6de1="">

  <div class="tm-article-snippet__meta-container">

  <div class="tm-article-snippet__meta">

  <span class="tm-user-info tm-article-snippet__author"><a href="https://habr.com/ru/users/dust70/"
  class="tm-user-info__userpic" data-test-id="user-info-pic"
  title="dust70"></a></span>
  <div class="tm-entity-image">

  <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/6d1777e132cdf566cabac609ada4e167.png"
  class="tm-entity-image__pic" width="24" height="24" />

  </div>

  <span class="tm-user-info__user tm-user-info__user_appearance-default"
  test-id="user-info-description"><a href="https://habr.com/ru/users/dust70/"
  class="tm-user-info__username">dust70</a>
  <span class="tm-article-datetime-published">6 часов
  назад</span></span>

  </div>

  </div>

  ## <a href="https://habr.com/ru/companies/wirenboard/articles/954532/"
  class="tm-title__link" data-article-link="true"
  data-test-id="article-snippet-title-link"><span>UPS!…We Did It Again:
  как мы потратили год разработки, чтобы бесперебойник перестал
  вздуваться</span></a>

  <div class="tm-article-snippet__stats" test-id="articleStats">

  <div class="tm-article-complexity tm-article-complexity_complexity-low">

  <span class="tm-svg-icon__wrapper tm-article-complexity__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0KPRgNC+0LLQtdC90Ywg0YHQu9C+0LbQvdC+0YHRgtC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY29tcGxleGl0eS1sb3ciIC8+PC9zdmc+"
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-complexity__label">Простой</span>

  </div>

  <div class="tm-article-reading-time">

  <span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JLRgNC10LzRjyDQvdCwINC/0YDQvtGH0YLQtdC90LjQtTwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2Nsb2NrIiAvPjwvc3ZnPg=="
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-reading-time__label">16
  мин</span>

  </div>

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="3009">3K</span></span>

  </div>

  <div class="tm-article-labels" v-2083333e="" test-id="articleLabels">

  <div class="tm-article-labels__container" v-2083333e="">

  <div class="tm-publication-label tm-publication-label_variant-case"
  v-2083333e="">

  Кейс

  </div>

  </div>

  </div>

  </div>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  v-5c5a6de1="" test-id="article-stats-icons">

  <div class="tm-votes-meter tm-data-icons__item">

  <img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbl9hcHBlYXJhbmNlLWFydGljbGUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCS0YHQtdCz0L4g0LPQvtC70L7RgdC+0LIgMzk6IOKGkTM5INC4IOKGkzA8L3RpdGxlPjx1c2UgeGxpbms6aHJlZj0iL2ltZy9tZWdhem9yZC12MjguNDk3ZWY3ODkuLnN2ZyNjb3VudGVyLXJhdGluZyIgLz48L3N2Zz4="
  class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_appearance-article" /><span class="tm-votes-meter__value tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating"
  test-id="votes-meter-value"
  title="Всего голосов 39: ↑39 и ↓0">+49</span>

  </div>

  <span class="tm-svg-icon__wrapper bookmarks-button__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JTQvtCx0LDQstC40YLRjCDQsiDQt9Cw0LrQu9Cw0LTQutC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci1mYXZvcml0ZSIgLz48L3N2Zz4="
  class="tm-svg-img tm-svg-icon" /></span><span class="bookmarks-button__counter"
  title="Количество пользователей, добавивших публикацию в закладки">11</span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a
  href="https://habr.com/ru/companies/wirenboard/articles/954532/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">21</span></a><a
  href="https://habr.com/ru/companies/wirenboard/articles/954532/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+21</span>

  </div>

  </div>

  </div>

- <div class="tm-article-snippet tm-article-snippet tm-article-snippet_noBorder"
  v-5c5a6de1="">

  <div class="tm-article-snippet__meta-container">

  <div class="tm-article-snippet__meta">

  <span class="tm-user-info tm-article-snippet__author"><a href="https://habr.com/ru/users/kesn/" class="tm-user-info__userpic"
  data-test-id="user-info-pic" title="kesn"></a></span>
  <div class="tm-entity-image">

  <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/46e026284abb4fe5ac26faff56c2a478.jpg"
  class="tm-entity-image__pic" width="24" height="24" />

  </div>

  <span class="tm-user-info__user tm-user-info__user_appearance-default"
  test-id="user-info-description"><a href="https://habr.com/ru/users/kesn/"
  class="tm-user-info__username">kesn</a>
  <span class="tm-article-datetime-published">3 часа назад</span></span>

  </div>

  </div>

  ## <a href="https://habr.com/ru/articles/956174/" class="tm-title__link"
  data-article-link="true"
  data-test-id="article-snippet-title-link"><span>Самый скучный на свете
  взлом подарочных сертификатов</span></a>

  <div class="tm-article-snippet__stats" test-id="articleStats">

  <div class="tm-article-reading-time">

  <span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JLRgNC10LzRjyDQvdCwINC/0YDQvtGH0YLQtdC90LjQtTwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2Nsb2NrIiAvPjwvc3ZnPg=="
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-reading-time__label">5
  мин</span>

  </div>

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="2409">2.4K</span></span>

  </div>

  <div class="tm-article-labels" v-2083333e="" test-id="articleLabels">

  <div class="tm-article-labels__container" v-2083333e="">

  </div>

  </div>

  </div>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  v-5c5a6de1="" test-id="article-stats-icons">

  <div class="tm-votes-meter tm-data-icons__item">

  <img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbl9hcHBlYXJhbmNlLWFydGljbGUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCS0YHQtdCz0L4g0LPQvtC70L7RgdC+0LIgNDI6IOKGkTM5INC4IOKGkzM8L3RpdGxlPjx1c2UgeGxpbms6aHJlZj0iL2ltZy9tZWdhem9yZC12MjguNDk3ZWY3ODkuLnN2ZyNjb3VudGVyLXJhdGluZyIgLz48L3N2Zz4="
  class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_appearance-article" /><span class="tm-votes-meter__value tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating"
  test-id="votes-meter-value"
  title="Всего голосов 42: ↑39 и ↓3">+42</span>

  </div>

  <span class="tm-svg-icon__wrapper bookmarks-button__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JTQvtCx0LDQstC40YLRjCDQsiDQt9Cw0LrQu9Cw0LTQutC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci1mYXZvcml0ZSIgLz48L3N2Zz4="
  class="tm-svg-img tm-svg-icon" /></span><span class="bookmarks-button__counter"
  title="Количество пользователей, добавивших публикацию в закладки">11</span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a href="https://habr.com/ru/articles/956174/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">8</span></a><a href="https://habr.com/ru/articles/956174/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+8</span>

  </div>

  </div>

  </div>

- <div class="tm-article-snippet tm-article-snippet tm-article-snippet_noBorder"
  v-5c5a6de1="">

  <div class="tm-article-snippet__meta-container">

  <div class="tm-article-snippet__meta">

  <span class="tm-user-info tm-article-snippet__author"><a href="https://habr.com/ru/users/oleg-svs/"
  class="tm-user-info__userpic" data-test-id="user-info-pic"
  title="oleg-svs"></a></span>
  <div class="tm-entity-image">

  <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/be221b074e541661838e38a714e710a0.png"
  class="tm-entity-image__pic" width="24" height="24" />

  </div>

  <span class="tm-user-info__user tm-user-info__user_appearance-default"
  test-id="user-info-description"><a href="https://habr.com/ru/users/oleg-svs/"
  class="tm-user-info__username">oleg-svs</a>
  <span class="tm-article-datetime-published">21 час назад</span></span>

  </div>

  </div>

  ## <a href="https://habr.com/ru/articles/956916/" class="tm-title__link"
  data-article-link="true"
  data-test-id="article-snippet-title-link"><span>Свой прокси DNS сервер
  для обхода санкций зарубежных сайтов(с использованием VPS)</span></a>

  <div class="tm-article-snippet__stats" test-id="articleStats">

  <div class="tm-article-reading-time">

  <span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JLRgNC10LzRjyDQvdCwINC/0YDQvtGH0YLQtdC90LjQtTwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2Nsb2NrIiAvPjwvc3ZnPg=="
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-reading-time__label">4
  мин</span>

  </div>

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="28430">28K</span></span>

  </div>

  <div class="tm-article-labels" v-2083333e="" test-id="articleLabels">

  <div class="tm-article-labels__container" v-2083333e="">

  <div class="tm-publication-label tm-publication-label_variant-sandbox"
  v-2083333e="">

  [Из песочницы](https://habr.com/ru/sandbox/)

  </div>

  </div>

  </div>

  </div>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  v-5c5a6de1="" test-id="article-stats-icons">

  <div class="tm-votes-meter tm-data-icons__item">

  <img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbl9hcHBlYXJhbmNlLWFydGljbGUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCS0YHQtdCz0L4g0LPQvtC70L7RgdC+0LIgMjg6IOKGkTI3INC4IOKGkzE8L3RpdGxlPjx1c2UgeGxpbms6aHJlZj0iL2ltZy9tZWdhem9yZC12MjguNDk3ZWY3ODkuLnN2ZyNjb3VudGVyLXJhdGluZyIgLz48L3N2Zz4="
  class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_appearance-article" /><span class="tm-votes-meter__value tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating"
  test-id="votes-meter-value"
  title="Всего голосов 28: ↑27 и ↓1">+31</span>

  </div>

  <span class="tm-svg-icon__wrapper bookmarks-button__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JTQvtCx0LDQstC40YLRjCDQsiDQt9Cw0LrQu9Cw0LTQutC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci1mYXZvcml0ZSIgLz48L3N2Zz4="
  class="tm-svg-img tm-svg-icon" /></span><span class="bookmarks-button__counter"
  title="Количество пользователей, добавивших публикацию в закладки">243</span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a href="https://habr.com/ru/articles/956916/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">39</span></a><a href="https://habr.com/ru/articles/956916/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+39</span>

  </div>

  </div>

  </div>

- <div class="tm-article-snippet tm-article-snippet tm-article-snippet_noBorder"
  v-5c5a6de1="">

  <div class="tm-article-snippet__meta-container">

  <div class="tm-article-snippet__meta">

  <span class="tm-user-info tm-article-snippet__author"><a href="https://habr.com/ru/users/DAN_SEA/"
  class="tm-user-info__userpic" data-test-id="user-info-pic"
  title="DAN_SEA"></a></span>
  <div class="tm-entity-image">

  <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/124.png"
  class="tm-entity-image__pic" width="24" height="24" />

  </div>

  <span class="tm-user-info__user tm-user-info__user_appearance-default"
  test-id="user-info-description"><a href="https://habr.com/ru/users/DAN_SEA/"
  class="tm-user-info__username">DAN_SEA</a>
  <span class="tm-article-datetime-published">4 часа назад</span></span>

  </div>

  </div>

  ## <a href="https://habr.com/ru/companies/ruvds/articles/955684/"
  class="tm-title__link" data-article-link="true"
  data-test-id="article-snippet-title-link"><span>Ветрогенераторы без
  лопастей?</span></a>

  <div class="tm-article-snippet__stats" test-id="articleStats">

  <div class="tm-article-complexity tm-article-complexity_complexity-medium">

  <span class="tm-svg-icon__wrapper tm-article-complexity__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0KPRgNC+0LLQtdC90Ywg0YHQu9C+0LbQvdC+0YHRgtC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY29tcGxleGl0eS1tZWRpdW0iIC8+PC9zdmc+"
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-complexity__label">Средний</span>

  </div>

  <div class="tm-article-reading-time">

  <span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JLRgNC10LzRjyDQvdCwINC/0YDQvtGH0YLQtdC90LjQtTwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2Nsb2NrIiAvPjwvc3ZnPg=="
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-reading-time__label">8
  мин</span>

  </div>

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="2712">2.7K</span></span>

  </div>

  <div class="tm-article-labels" v-2083333e="" test-id="articleLabels">

  <div class="tm-article-labels__container" v-2083333e="">

  <div class="tm-publication-label tm-publication-label_variant-review"
  v-2083333e="">

  Обзор

  </div>

  </div>

  </div>

  </div>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  v-5c5a6de1="" test-id="article-stats-icons">

  <div class="tm-votes-meter tm-data-icons__item">

  <img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbl9hcHBlYXJhbmNlLWFydGljbGUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCS0YHQtdCz0L4g0LPQvtC70L7RgdC+0LIgMTU6IOKGkTE1INC4IOKGkzA8L3RpdGxlPjx1c2UgeGxpbms6aHJlZj0iL2ltZy9tZWdhem9yZC12MjguNDk3ZWY3ODkuLnN2ZyNjb3VudGVyLXJhdGluZyIgLz48L3N2Zz4="
  class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_appearance-article" /><span class="tm-votes-meter__value tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating"
  test-id="votes-meter-value"
  title="Всего голосов 15: ↑15 и ↓0">+27</span>

  </div>

  <span class="tm-svg-icon__wrapper bookmarks-button__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JTQvtCx0LDQstC40YLRjCDQsiDQt9Cw0LrQu9Cw0LTQutC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci1mYXZvcml0ZSIgLz48L3N2Zz4="
  class="tm-svg-img tm-svg-icon" /></span><span class="bookmarks-button__counter"
  title="Количество пользователей, добавивших публикацию в закладки">6</span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a href="https://habr.com/ru/companies/ruvds/articles/955684/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">7</span></a><a href="https://habr.com/ru/companies/ruvds/articles/955684/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+7</span>

  </div>

  </div>

  </div>

- <div class="tm-article-snippet tm-article-snippet tm-article-snippet_noBorder"
  v-5c5a6de1="">

  <div class="tm-article-snippet__meta-container">

  <div class="tm-article-snippet__meta">

  <span class="tm-user-info tm-article-snippet__author"><a href="https://habr.com/ru/users/Flampanzer/"
  class="tm-user-info__userpic" data-test-id="user-info-pic"
  title="Flampanzer"></a></span>
  <div class="tm-entity-image">

  <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/906b47b5c8d88d34966303e77349d82f.jpeg"
  class="tm-entity-image__pic" width="24" height="24" />

  </div>

  <span class="tm-user-info__user tm-user-info__user_appearance-default"
  test-id="user-info-description"><a href="https://habr.com/ru/users/Flampanzer/"
  class="tm-user-info__username">Flampanzer</a>
  <span class="tm-article-datetime-published">6 часов
  назад</span></span>

  </div>

  </div>

  ## <a href="https://habr.com/ru/companies/selectel/articles/956736/"
  class="tm-title__link" data-article-link="true"
  data-test-id="article-snippet-title-link"><span>Триллион параметров
  против здравого смысла: тестируем Qwen3-MAX и друзей</span></a>

  <div class="tm-article-snippet__stats" test-id="articleStats">

  <div class="tm-article-complexity tm-article-complexity_complexity-low">

  <span class="tm-svg-icon__wrapper tm-article-complexity__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0KPRgNC+0LLQtdC90Ywg0YHQu9C+0LbQvdC+0YHRgtC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY29tcGxleGl0eS1sb3ciIC8+PC9zdmc+"
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-complexity__label">Простой</span>

  </div>

  <div class="tm-article-reading-time">

  <span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JLRgNC10LzRjyDQvdCwINC/0YDQvtGH0YLQtdC90LjQtTwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2Nsb2NrIiAvPjwvc3ZnPg=="
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-reading-time__label">11
  мин</span>

  </div>

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="1704">1.7K</span></span>

  </div>

  <div class="tm-article-labels" v-2083333e="" test-id="articleLabels">

  <div class="tm-article-labels__container" v-2083333e="">

  </div>

  </div>

  </div>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  v-5c5a6de1="" test-id="article-stats-icons">

  <div class="tm-votes-meter tm-data-icons__item">

  <img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbl9hcHBlYXJhbmNlLWFydGljbGUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCS0YHQtdCz0L4g0LPQvtC70L7RgdC+0LIgMTk6IOKGkTE5INC4IOKGkzA8L3RpdGxlPjx1c2UgeGxpbms6aHJlZj0iL2ltZy9tZWdhem9yZC12MjguNDk3ZWY3ODkuLnN2ZyNjb3VudGVyLXJhdGluZyIgLz48L3N2Zz4="
  class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_appearance-article" /><span class="tm-votes-meter__value tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating"
  test-id="votes-meter-value"
  title="Всего голосов 19: ↑19 и ↓0">+25</span>

  </div>

  <span class="tm-svg-icon__wrapper bookmarks-button__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JTQvtCx0LDQstC40YLRjCDQsiDQt9Cw0LrQu9Cw0LTQutC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci1mYXZvcml0ZSIgLz48L3N2Zz4="
  class="tm-svg-img tm-svg-icon" /></span><span class="bookmarks-button__counter"
  title="Количество пользователей, добавивших публикацию в закладки">6</span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a
  href="https://habr.com/ru/companies/selectel/articles/956736/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">10</span></a><a
  href="https://habr.com/ru/companies/selectel/articles/956736/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+10</span>

  </div>

  </div>

  </div>

- <div class="tm-article-snippet tm-article-snippet tm-article-snippet_noBorder"
  v-5c5a6de1="">

  <div class="tm-article-snippet__meta-container">

  <div class="tm-article-snippet__meta">

  <span class="tm-user-info tm-article-snippet__author"><a href="https://habr.com/ru/users/lerastegaeva/"
  class="tm-user-info__userpic" data-test-id="user-info-pic"
  title="lerastegaeva"></a></span>
  <div class="tm-entity-image">

  <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/069.png"
  class="tm-entity-image__pic" width="24" height="24" />

  </div>

  <span class="tm-user-info__user tm-user-info__user_appearance-default"
  test-id="user-info-description"><a href="https://habr.com/ru/users/lerastegaeva/"
  class="tm-user-info__username">lerastegaeva</a>
  <span class="tm-article-datetime-published">22 часа
  назад</span></span>

  </div>

  </div>

  ## <a href="https://habr.com/ru/articles/956896/" class="tm-title__link"
  data-article-link="true"
  data-test-id="article-snippet-title-link"><span>Я оплачиваю квартиру за
  счет Python-инструмента, который собрал за выходные</span></a>

  <div class="tm-article-snippet__stats" test-id="articleStats">

  <div class="tm-article-complexity tm-article-complexity_complexity-medium">

  <span class="tm-svg-icon__wrapper tm-article-complexity__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0KPRgNC+0LLQtdC90Ywg0YHQu9C+0LbQvdC+0YHRgtC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY29tcGxleGl0eS1tZWRpdW0iIC8+PC9zdmc+"
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-complexity__label">Средний</span>

  </div>

  <div class="tm-article-reading-time">

  <span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JLRgNC10LzRjyDQvdCwINC/0YDQvtGH0YLQtdC90LjQtTwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2Nsb2NrIiAvPjwvc3ZnPg=="
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-reading-time__label">6
  мин</span>

  </div>

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="43561">44K</span></span>

  </div>

  <div class="tm-article-labels" v-2083333e="" test-id="articleLabels">

  <div class="tm-article-labels__container" v-2083333e="">

  <div class="tm-publication-label tm-publication-label_variant-tutorial"
  v-2083333e="">

  Туториал

  </div>

  <div class="tm-publication-label tm-publication-label_variant-translation"
  v-2083333e="">

  Перевод

  </div>

  </div>

  </div>

  </div>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  v-5c5a6de1="" test-id="article-stats-icons">

  <div class="tm-votes-meter tm-data-icons__item">

  <img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbl9hcHBlYXJhbmNlLWFydGljbGUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCS0YHQtdCz0L4g0LPQvtC70L7RgdC+0LIgMzc6IOKGkTMwINC4IOKGkzc8L3RpdGxlPjx1c2UgeGxpbms6aHJlZj0iL2ltZy9tZWdhem9yZC12MjguNDk3ZWY3ODkuLnN2ZyNjb3VudGVyLXJhdGluZyIgLz48L3N2Zz4="
  class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_appearance-article" /><span class="tm-votes-meter__value tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating"
  test-id="votes-meter-value"
  title="Всего голосов 37: ↑30 и ↓7">+24</span>

  </div>

  <span class="tm-svg-icon__wrapper bookmarks-button__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JTQvtCx0LDQstC40YLRjCDQsiDQt9Cw0LrQu9Cw0LTQutC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci1mYXZvcml0ZSIgLz48L3N2Zz4="
  class="tm-svg-img tm-svg-icon" /></span><span class="bookmarks-button__counter"
  title="Количество пользователей, добавивших публикацию в закладки">203</span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a href="https://habr.com/ru/articles/956896/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">43</span></a><a href="https://habr.com/ru/articles/956896/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+43</span>

  </div>

  </div>

  </div>

- <div class="tm-article-snippet tm-article-snippet tm-article-snippet_noBorder"
  v-5c5a6de1="">

  <div class="tm-article-snippet__meta-container">

  <div class="tm-article-snippet__meta">

  <span class="tm-user-info tm-article-snippet__author"><a href="https://habr.com/ru/users/vorloff87/"
  class="tm-user-info__userpic" data-test-id="user-info-pic"
  title="vorloff87"></a></span>
  <div class="tm-entity-image">

  <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/d6b4f73ae9b307c30685150a5901c950.jpeg"
  class="tm-entity-image__pic" width="24" height="24" />

  </div>

  <span class="tm-user-info__user tm-user-info__user_appearance-default"
  test-id="user-info-description"><a href="https://habr.com/ru/users/vorloff87/"
  class="tm-user-info__username">vorloff87</a>
  <span class="tm-article-datetime-published">6 часов
  назад</span></span>

  </div>

  </div>

  ## <a href="https://habr.com/ru/companies/yandex/articles/956532/"
  class="tm-title__link" data-article-link="true"
  data-test-id="article-snippet-title-link"><span>И в дождь, и в снег: как
  мы детектируем загрязнения на лидарах автономного транспорта</span></a>

  <div class="tm-article-snippet__stats" test-id="articleStats">

  <div class="tm-article-complexity tm-article-complexity_complexity-low">

  <span class="tm-svg-icon__wrapper tm-article-complexity__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0KPRgNC+0LLQtdC90Ywg0YHQu9C+0LbQvdC+0YHRgtC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY29tcGxleGl0eS1sb3ciIC8+PC9zdmc+"
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-complexity__label">Простой</span>

  </div>

  <div class="tm-article-reading-time">

  <span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JLRgNC10LzRjyDQvdCwINC/0YDQvtGH0YLQtdC90LjQtTwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2Nsb2NrIiAvPjwvc3ZnPg=="
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-reading-time__label">10
  мин</span>

  </div>

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="810">810</span></span>

  </div>

  <div class="tm-article-labels" v-2083333e="" test-id="articleLabels">

  <div class="tm-article-labels__container" v-2083333e="">

  <div class="tm-publication-label tm-publication-label_variant-retrospective"
  v-2083333e="">

  Ретроспектива

  </div>

  </div>

  </div>

  </div>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  v-5c5a6de1="" test-id="article-stats-icons">

  <div class="tm-votes-meter tm-data-icons__item">

  <img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbl9hcHBlYXJhbmNlLWFydGljbGUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCS0YHQtdCz0L4g0LPQvtC70L7RgdC+0LIgMTc6IOKGkTE3INC4IOKGkzA8L3RpdGxlPjx1c2UgeGxpbms6aHJlZj0iL2ltZy9tZWdhem9yZC12MjguNDk3ZWY3ODkuLnN2ZyNjb3VudGVyLXJhdGluZyIgLz48L3N2Zz4="
  class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_appearance-article" /><span class="tm-votes-meter__value tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating"
  test-id="votes-meter-value"
  title="Всего голосов 17: ↑17 и ↓0">+23</span>

  </div>

  <span class="tm-svg-icon__wrapper bookmarks-button__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JTQvtCx0LDQstC40YLRjCDQsiDQt9Cw0LrQu9Cw0LTQutC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci1mYXZvcml0ZSIgLz48L3N2Zz4="
  class="tm-svg-img tm-svg-icon" /></span><span class="bookmarks-button__counter"
  title="Количество пользователей, добавивших публикацию в закладки">6</span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a href="https://habr.com/ru/companies/yandex/articles/956532/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">9</span></a><a href="https://habr.com/ru/companies/yandex/articles/956532/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+9</span>

  </div>

  </div>

  </div>

- <div class="tm-article-snippet tm-article-snippet tm-article-snippet_noBorder"
  v-5c5a6de1="">

  <div class="tm-article-snippet__meta-container">

  <div class="tm-article-snippet__meta">

  <span class="tm-user-info tm-article-snippet__author"><a href="https://habr.com/ru/users/pokamest_nikak/"
  class="tm-user-info__userpic" data-test-id="user-info-pic"
  title="pokamest_nikak"></a></span>
  <div class="tm-entity-image">

  <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/a1d6aed9f2b2ff2061eb49aa490c6a67.png"
  class="tm-entity-image__pic" width="24" height="24" />

  </div>

  <span class="tm-user-info__user tm-user-info__user_appearance-default"
  test-id="user-info-description"><a href="https://habr.com/ru/users/pokamest_nikak/"
  class="tm-user-info__username">pokamest_nikak</a>
  <span class="tm-article-datetime-published">2 часа назад</span></span>

  </div>

  </div>

  ## <a href="https://habr.com/ru/companies/amnezia/articles/957152/"
  class="tm-title__link" data-article-link="true"
  data-test-id="article-snippet-title-link"><span>Нас минусили,
  блокировали и копировали – но мы только лучше. 5 лет Amnezia</span></a>

  <div class="tm-article-snippet__stats" test-id="articleStats">

  <div class="tm-article-complexity tm-article-complexity_complexity-low">

  <span class="tm-svg-icon__wrapper tm-article-complexity__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0KPRgNC+0LLQtdC90Ywg0YHQu9C+0LbQvdC+0YHRgtC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY29tcGxleGl0eS1sb3ciIC8+PC9zdmc+"
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-complexity__label">Простой</span>

  </div>

  <div class="tm-article-reading-time">

  <span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JLRgNC10LzRjyDQvdCwINC/0YDQvtGH0YLQtdC90LjQtTwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2Nsb2NrIiAvPjwvc3ZnPg=="
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-reading-time__label">6
  мин</span>

  </div>

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="2264">2.3K</span></span>

  </div>

  <div class="tm-article-labels" v-2083333e="" test-id="articleLabels">

  <div class="tm-article-labels__container" v-2083333e="">

  </div>

  </div>

  </div>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  v-5c5a6de1="" test-id="article-stats-icons">

  <div class="tm-votes-meter tm-data-icons__item">

  <img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbl9hcHBlYXJhbmNlLWFydGljbGUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCS0YHQtdCz0L4g0LPQvtC70L7RgdC+0LIgMTg6IOKGkTE3INC4IOKGkzE8L3RpdGxlPjx1c2UgeGxpbms6aHJlZj0iL2ltZy9tZWdhem9yZC12MjguNDk3ZWY3ODkuLnN2ZyNjb3VudGVyLXJhdGluZyIgLz48L3N2Zz4="
  class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_appearance-article" /><span class="tm-votes-meter__value tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating"
  test-id="votes-meter-value"
  title="Всего голосов 18: ↑17 и ↓1">+22</span>

  </div>

  <span class="tm-svg-icon__wrapper bookmarks-button__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JTQvtCx0LDQstC40YLRjCDQsiDQt9Cw0LrQu9Cw0LTQutC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci1mYXZvcml0ZSIgLz48L3N2Zz4="
  class="tm-svg-img tm-svg-icon" /></span><span class="bookmarks-button__counter"
  title="Количество пользователей, добавивших публикацию в закладки">6</span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a
  href="https://habr.com/ru/companies/amnezia/articles/957152/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">6</span></a><a
  href="https://habr.com/ru/companies/amnezia/articles/957152/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+6</span>

  </div>

  </div>

  </div>

- <div class="tm-article-snippet tm-article-snippet tm-article-snippet_noBorder"
  v-5c5a6de1="">

  <div class="tm-article-snippet__meta-container">

  <div class="tm-article-snippet__meta">

  <span class="tm-user-info tm-article-snippet__author"><a href="https://habr.com/ru/users/Timeweb_Cloud/"
  class="tm-user-info__userpic" data-test-id="user-info-pic"
  title="Timeweb_Cloud"></a></span>
  <div class="tm-entity-image">

  <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/4870c58e2fe614b68e7d1c3f8af40d5a.png"
  class="tm-entity-image__pic" width="24" height="24" />

  </div>

  <span class="tm-user-info__user tm-user-info__user_appearance-default"
  test-id="user-info-description"><a href="https://habr.com/ru/users/Timeweb_Cloud/"
  class="tm-user-info__username">Timeweb_Cloud</a>
  <span class="tm-article-datetime-published">5 часов
  назад</span></span>

  </div>

  </div>

  ## <a href="https://habr.com/ru/companies/timeweb/articles/957046/"
  class="tm-title__link" data-article-link="true"
  data-test-id="article-snippet-title-link"><span>Зумеры против труда:
  почему это поколение не хочет работать?</span></a>

  <div class="tm-article-snippet__stats" test-id="articleStats">

  <div class="tm-article-complexity tm-article-complexity_complexity-low">

  <span class="tm-svg-icon__wrapper tm-article-complexity__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0KPRgNC+0LLQtdC90Ywg0YHQu9C+0LbQvdC+0YHRgtC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY29tcGxleGl0eS1sb3ciIC8+PC9zdmc+"
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-complexity__label">Простой</span>

  </div>

  <div class="tm-article-reading-time">

  <span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JLRgNC10LzRjyDQvdCwINC/0YDQvtGH0YLQtdC90LjQtTwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2Nsb2NrIiAvPjwvc3ZnPg=="
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-reading-time__label">7
  мин</span>

  </div>

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="11017">11K</span></span>

  </div>

  <div class="tm-article-labels" v-2083333e="" test-id="articleLabels">

  <div class="tm-article-labels__container" v-2083333e="">

  <div class="tm-publication-label tm-publication-label_variant-review"
  v-2083333e="">

  Обзор

  </div>

  </div>

  </div>

  </div>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  v-5c5a6de1="" test-id="article-stats-icons">

  <div class="tm-votes-meter tm-data-icons__item">

  <img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbl9hcHBlYXJhbmNlLWFydGljbGUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCS0YHQtdCz0L4g0LPQvtC70L7RgdC+0LIgMzM6IOKGkTI1INC4IOKGkzg8L3RpdGxlPjx1c2UgeGxpbms6aHJlZj0iL2ltZy9tZWdhem9yZC12MjguNDk3ZWY3ODkuLnN2ZyNjb3VudGVyLXJhdGluZyIgLz48L3N2Zz4="
  class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_appearance-article" /><span class="tm-votes-meter__value tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating"
  test-id="votes-meter-value"
  title="Всего голосов 33: ↑25 и ↓8">+22</span>

  </div>

  <span class="tm-svg-icon__wrapper bookmarks-button__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JTQvtCx0LDQstC40YLRjCDQsiDQt9Cw0LrQu9Cw0LTQutC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci1mYXZvcml0ZSIgLz48L3N2Zz4="
  class="tm-svg-img tm-svg-icon" /></span><span class="bookmarks-button__counter"
  title="Количество пользователей, добавивших публикацию в закладки">29</span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a
  href="https://habr.com/ru/companies/timeweb/articles/957046/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">47</span></a><a
  href="https://habr.com/ru/companies/timeweb/articles/957046/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+47</span>

  </div>

  </div>

  </div>

- <div class="tm-article-snippet tm-article-snippet tm-article-snippet_noBorder"
  v-5c5a6de1="">

  <div class="tm-article-snippet__meta-container">

  <div class="tm-article-snippet__meta">

  <span class="tm-user-info tm-article-snippet__author"><a href="https://habr.com/ru/users/cnet/" class="tm-user-info__userpic"
  data-test-id="user-info-pic" title="cnet"></a></span>
  <div class="tm-entity-image">

  <img
  src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/027.png"
  class="tm-entity-image__pic" width="24" height="24" />

  </div>

  <span class="tm-user-info__user tm-user-info__user_appearance-default"
  test-id="user-info-description"><a href="https://habr.com/ru/users/cnet/"
  class="tm-user-info__username">cnet</a>
  <span class="tm-article-datetime-published">6 часов
  назад</span></span>

  </div>

  </div>

  ## <a href="https://habr.com/ru/companies/beget/articles/955664/"
  class="tm-title__link" data-article-link="true"
  data-test-id="article-snippet-title-link"><span>Запечатлеть невидимое:
  шлирен-метод</span></a>

  <div class="tm-article-snippet__stats" test-id="articleStats">

  <div class="tm-article-reading-time">

  <span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JLRgNC10LzRjyDQvdCwINC/0YDQvtGH0YLQtdC90LjQtTwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2Nsb2NrIiAvPjwvc3ZnPg=="
  class="tm-svg-img tm-svg-icon" /></span><span class="tm-article-reading-time__label">7
  мин</span>

  </div>

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="1070">1.1K</span></span>

  </div>

  <div class="tm-article-labels" v-2083333e="" test-id="articleLabels">

  <div class="tm-article-labels__container" v-2083333e="">

  </div>

  </div>

  </div>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  v-5c5a6de1="" test-id="article-stats-icons">

  <div class="tm-votes-meter tm-data-icons__item">

  <img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbiB0bS12b3Rlcy1tZXRlcl9faWNvbl9hcHBlYXJhbmNlLWFydGljbGUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCS0YHQtdCz0L4g0LPQvtC70L7RgdC+0LIgMTY6IOKGkTE2INC4IOKGkzA8L3RpdGxlPjx1c2UgeGxpbms6aHJlZj0iL2ltZy9tZWdhem9yZC12MjguNDk3ZWY3ODkuLnN2ZyNjb3VudGVyLXJhdGluZyIgLz48L3N2Zz4="
  class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_appearance-article" /><span class="tm-votes-meter__value tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating"
  test-id="votes-meter-value"
  title="Всего голосов 16: ↑16 и ↓0">+21</span>

  </div>

  <span class="tm-svg-icon__wrapper bookmarks-button__icon"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JTQvtCx0LDQstC40YLRjCDQsiDQt9Cw0LrQu9Cw0LTQutC4PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci1mYXZvcml0ZSIgLz48L3N2Zz4="
  class="tm-svg-img tm-svg-icon" /></span><span class="bookmarks-button__counter"
  title="Количество пользователей, добавивших публикацию в закладки">8</span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a href="https://habr.com/ru/companies/beget/articles/955664/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">1</span></a><a href="https://habr.com/ru/companies/beget/articles/955664/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+1</span>

  </div>

  </div>

  </div>

  <div class="tm-bordered-card" v-5c5a6de1="">

  </div>

<div class="daily-articles-block__button-container">

Показать еще

</div>

</div>

</div>

</div>

</div>

<div>

</div>

</div>

</div>

</div>

</div>

</div>

<div class="tm-page__sidebar">

<div class="tm-layout-sidebar">

<div class="tm-layout-sidebar__placeholder_stick-top">

</div>

<div class="tm-sexy-sidebar tm-sexy-sidebar_stick-top"
style="margin-top: 0px;">

<div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_stick-top">

<div class="element-wrapper half-page tm-layout-sidebar__banner tm-layout-sidebar__banner_top"
style="--6d0642e0: 0px; --418c71fe: auto;">

</div>

</div>

<div class="section tm-block tm-block tm-block_spacing-bottom"
ga-options="[object Object]">

<div class="tm-block__header tm-block__header">

<div class="tm-block__header-container">

## Читают сейчас

</div>

</div>

<div class="tm-block__body tm-block__body">

- ## <a href="https://habr.com/ru/articles/956850/"
  class="tm-article-title__link"><span>За гранью человеческой интуиции:
  как ИИ создает странные, но сверхэффективные аналоговые
  микросхемы</span></a>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  test-id="article-stats-icons">

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="48779">49K</span></span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a href="https://habr.com/ru/articles/956850/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">53</span></a><a href="https://habr.com/ru/articles/956850/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+53</span>

  </div>

  </div>

  </div>

- ## <a href="https://habr.com/ru/companies/timeweb/articles/957046/"
  class="tm-article-title__link"><span>Зумеры против труда: почему это
  поколение не хочет работать?</span></a>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  test-id="article-stats-icons">

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="6600">6.6K</span></span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a
  href="https://habr.com/ru/companies/timeweb/articles/957046/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">34</span></a><a
  href="https://habr.com/ru/companies/timeweb/articles/957046/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+34</span>

  </div>

  </div>

  </div>

- ## <a href="https://habr.com/ru/articles/956896/"
  class="tm-article-title__link"><span>Я оплачиваю квартиру за счет
  Python-инструмента, который собрал за выходные</span></a>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  test-id="article-stats-icons">

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="41285">41K</span></span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a href="https://habr.com/ru/articles/956896/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">42</span></a><a href="https://habr.com/ru/articles/956896/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+42</span>

  </div>

  </div>

  </div>

- ## <a href="https://habr.com/ru/articles/956692/"
  class="tm-article-title__link"><span>Как мы перешли от контроля рабочего
  времени сотрудников к оптимизации управления персоналом</span></a>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  test-id="article-stats-icons">

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="17934">18K</span></span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a href="https://habr.com/ru/articles/956692/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">17</span></a><a href="https://habr.com/ru/articles/956692/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+17</span>

  </div>

  </div>

  </div>

- ## <a href="https://habr.com/ru/articles/956916/"
  class="tm-article-title__link"><span>Свой прокси DNS сервер для обхода
  санкций зарубежных сайтов(с использованием VPS)</span></a>

  <div class="tm-data-icons tm-data-icons tm-data-icons_space-big"
  test-id="article-stats-icons">

  <span class="tm-icon-counter tm-data-icons__item"><img
  src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1pY29uLWNvdW50ZXJfX2ljb24iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHRpdGxlPtCa0L7Qu9C40YfQtdGB0YLQstC+INC/0YDQvtGB0LzQvtGC0YDQvtCyPC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjY291bnRlci12aWV3cyIgLz48L3N2Zz4="
  class="tm-svg-img tm-icon-counter__icon" /><span class="tm-icon-counter__value"
  title="26896">27K</span></span>
  <div class="article-comments-counter-link-wrapper tm-data-icons__item"
  v-a126af31="" title="Читать комментарии">

  <a href="https://habr.com/ru/articles/956916/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="counter-comments"><img
  src="data:image/svg+xml;base64,PHN2ZyBkYXRhLXYtYTEyNmFmMzEgY2xhc3M9InRtLXN2Zy1pbWcgaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JrQvtC80LzQtdC90YLQsNGA0LjQuDwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2NvdW50ZXItY29tbWVudHMiIC8+PC9zdmc+"
  class="tm-svg-img icon" /><span class="value"
  data-v-a126af31="">37</span></a><a href="https://habr.com/ru/articles/956916/comments/"
  class="article-comments-counter-link" data-v-a126af31=""
  data-test-id="unread-count"></a>
  <div class="unread-counter round-on-mobile" v-a126af31=""
  title="Читать новые комментарии">

  <span v-a126af31="">+37</span>

  </div>

  </div>

  </div>

</div>

</div>

<div>

</div>

<div class="section tm-block tm-block tm-block_spacing-around block"
v-f7a30433="">

<div class="tm-block__header tm-block__header">

<div class="tm-block__header-container">

## Ближайшие события

</div>

</div>

<div class="tm-block__body tm-block__body">

<div class="swiper-container slider swiper-container-initialized swiper-container-horizontal swiper-container-pointer-events swiper-container-autoheight"
v-f7a30433="" style="--swiper-space-between: 22px;">

<div class="swiper-wrapper"
style="height: 407px; transform: translate3d(0px, 0px, 0px);">

<div class="swiper-slide swiper-slide-active" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="784" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/011be472e115ab0d507a175e2c615871.jpg"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/011/be4/72e/011be472e115ab0d507a175e2c615871.jpg"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/011/be4/72e/011be472e115ab0d507a175e2c615871.jpg, https://habrastorage.org/getpro/habr/upload_files/011/be4/72e/011be472e115ab0d507a175e2c615871.jpg 2x" />](https://habr.com/ru/events/784/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

3 сентября – 31 октября

</div>

</div>

<a href="https://habr.com/ru/events/784/"
class="tm-event-card__title-link"><span>Программа грантов для развития
open source проектов «Код без границ»</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Онлайн</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#784"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-development">

Разработка

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide swiper-slide-next" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="796" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/18f2224f46d8dfb146bb710740be7893.png"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/18f/222/4f4/18f2224f46d8dfb146bb710740be7893.png"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/18f/222/4f4/18f2224f46d8dfb146bb710740be7893.png, https://habrastorage.org/getpro/habr/upload_files/18f/222/4f4/18f2224f46d8dfb146bb710740be7893.png 2x" />](https://habr.com/ru/events/796/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

16 сентября – 16 октября

</div>

</div>

<a href="https://habr.com/ru/events/796/"
class="tm-event-card__title-link"><span>День программиста на
Хабре</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Онлайн</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#796"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-other">

Другое

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="816" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/85cebfccd0913cfebbe93467b9983d2a.png"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/85c/ebf/ccd/85cebfccd0913cfebbe93467b9983d2a.png"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/85c/ebf/ccd/85cebfccd0913cfebbe93467b9983d2a.png, https://habrastorage.org/getpro/habr/upload_files/85c/ebf/ccd/85cebfccd0913cfebbe93467b9983d2a.png 2x" />](https://habr.com/ru/events/816/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

23 сентября – 31 декабря

</div>

</div>

<a href="https://habr.com/ru/events/816/"
class="tm-event-card__title-link"><span>Бесплатный мини-курс: как
продвигаться на Хабре, если вы — не IT-бренд</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Онлайн</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#816"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-marketing">

Маркетинг

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="814" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/db44cb402063cd1b9f0d6a1e6996b50b.jpg"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/db4/4cb/402/db44cb402063cd1b9f0d6a1e6996b50b.jpg"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/db4/4cb/402/db44cb402063cd1b9f0d6a1e6996b50b.jpg, https://habrastorage.org/getpro/habr/upload_files/db4/4cb/402/db44cb402063cd1b9f0d6a1e6996b50b.jpg 2x" />](https://habr.com/ru/events/814/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

16 октября

</div>

</div>

<a href="https://habr.com/ru/events/814/"
class="tm-event-card__title-link"><span>СИЛА ПЛАТФОРМЫ – форум о
проектировании и цифровизации в строительстве</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Москва<span class="tm-event-card__places-separator">
• </span></span><span class="tm-event-card__places-item">Онлайн</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#814"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-other">

Другое

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="822" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/ce2dc3d3fb0b93e0f266de937bfbfcb4.jpg"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/ce2/dc3/d3f/ce2dc3d3fb0b93e0f266de937bfbfcb4.jpg"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/ce2/dc3/d3f/ce2dc3d3fb0b93e0f266de937bfbfcb4.jpg, https://habrastorage.org/getpro/habr/upload_files/ce2/dc3/d3f/ce2dc3d3fb0b93e0f266de937bfbfcb4.jpg 2x" />](https://habr.com/ru/events/822/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

16 октября

</div>

</div>

<a href="https://habr.com/ru/events/822/"
class="tm-event-card__title-link"><span>Дискуссия о корпоративных
ценностях: как перевести их в реальные управленческие</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Онлайн</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#822"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-admin">

Администрирование

</div>

<div class="event-category__label event-category__label_type-management">

Менеджмент

</div>

<div class="event-category__label event-category__label_type-other">

Другое

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="824" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/77d7a37b50fd455ccc308a28777f7429.png"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/77d/7a3/7b5/77d7a37b50fd455ccc308a28777f7429.png"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/77d/7a3/7b5/77d7a37b50fd455ccc308a28777f7429.png, https://habrastorage.org/getpro/habr/upload_files/77d/7a3/7b5/77d7a37b50fd455ccc308a28777f7429.png 2x" />](https://habr.com/ru/events/824/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

16 октября

</div>

</div>

<a href="https://habr.com/ru/events/824/"
class="tm-event-card__title-link"><span>DataBase MeetUp от
43Tech</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Санкт-Петербург<span class="tm-event-card__places-separator">
• </span></span><span class="tm-event-card__places-item">Онлайн</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#824"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-development">

Разработка

</div>

<div class="event-category__label event-category__label_type-other">

Другое

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="812" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/e13282ee9089f0b06bff1c0e81e3abdb.png"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/e13/282/ee9/e13282ee9089f0b06bff1c0e81e3abdb.png"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/e13/282/ee9/e13282ee9089f0b06bff1c0e81e3abdb.png, https://habrastorage.org/getpro/habr/upload_files/e13/282/ee9/e13282ee9089f0b06bff1c0e81e3abdb.png 2x" />](https://habr.com/ru/events/812/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

17 – 19 октября

</div>

</div>

<a href="https://habr.com/ru/events/812/"
class="tm-event-card__title-link"><span>Профессиональная межрегиональная
IT-конференция Merge Baltic</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Светлогорск</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#812"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-development">

Разработка

</div>

<div class="event-category__label event-category__label_type-management">

Менеджмент

</div>

<div class="event-category__label event-category__label_type-analytics">

Аналитика

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="828" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/66fa41d50fa133a98650686ff66aef4c.jpeg"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/66f/a41/d50/66fa41d50fa133a98650686ff66aef4c.jpeg"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/66f/a41/d50/66fa41d50fa133a98650686ff66aef4c.jpeg, https://habrastorage.org/getpro/habr/upload_files/66f/a41/d50/66fa41d50fa133a98650686ff66aef4c.jpeg 2x" />](https://habr.com/ru/events/828/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

17 октября

</div>

</div>

<a href="https://habr.com/ru/events/828/"
class="tm-event-card__title-link"><span>HappyBossForum 2025</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Москва</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#828"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-other">

Другое

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="804" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/dba3821ff6f22fdbf0ccb516700d3eba.png"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/dba/382/1ff/dba3821ff6f22fdbf0ccb516700d3eba.png"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/dba/382/1ff/dba3821ff6f22fdbf0ccb516700d3eba.png, https://habrastorage.org/getpro/habr/upload_files/dba/382/1ff/dba3821ff6f22fdbf0ccb516700d3eba.png 2x" />](https://habr.com/ru/events/804/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

20 – 21 октября

</div>

</div>

<a href="https://habr.com/ru/events/804/"
class="tm-event-card__title-link"><span>FrontendConf 2025</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Москва<span class="tm-event-card__places-separator">
• </span></span><span class="tm-event-card__places-item">Онлайн</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#804"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-development">

Разработка

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="826" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/8d8a1df2fa7d74aeee1589f520edda32.png"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/8d8/a1d/f2f/8d8a1df2fa7d74aeee1589f520edda32.png"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/8d8/a1d/f2f/8d8a1df2fa7d74aeee1589f520edda32.png, https://habrastorage.org/getpro/habr/upload_files/8d8/a1d/f2f/8d8a1df2fa7d74aeee1589f520edda32.png 2x" />](https://habr.com/ru/events/826/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

21 октября

</div>

</div>

<a href="https://habr.com/ru/events/826/"
class="tm-event-card__title-link"><span>Вебинар «Cloud.ru Evolution:
новые сервисы, обновления и включение в РОПО»</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Онлайн</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#826"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-development">

Разработка

</div>

<div class="event-category__label event-category__label_type-testing">

Тестирование

</div>

<div class="event-category__label event-category__label_type-other">

Другое

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="830" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/539945433c1cac2ca3fea6e22231ecc2.png"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/539/945/433/539945433c1cac2ca3fea6e22231ecc2.png"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/539/945/433/539945433c1cac2ca3fea6e22231ecc2.png, https://habrastorage.org/getpro/habr/upload_files/539/945/433/539945433c1cac2ca3fea6e22231ecc2.png 2x" />](https://habr.com/ru/events/830/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

22 – 24 октября

</div>

</div>

<a href="https://habr.com/ru/events/830/"
class="tm-event-card__title-link"><span>Онлайн конфа по маркетингу
Ta-daa</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Онлайн</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#830"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-marketing">

Маркетинг

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="794" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/3373d5ddf7fb82fefefd52fca81f8b83.png"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/337/3d5/ddf/3373d5ddf7fb82fefefd52fca81f8b83.png"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/337/3d5/ddf/3373d5ddf7fb82fefefd52fca81f8b83.png, https://habrastorage.org/getpro/habr/upload_files/337/3d5/ddf/3373d5ddf7fb82fefefd52fca81f8b83.png 2x" />](https://habr.com/ru/events/794/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

29 октября

</div>

</div>

<a href="https://habr.com/ru/events/794/"
class="tm-event-card__title-link"><span>InterComm 2025 — главная
отраслевая премия по внутренним коммуникациям</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Москва</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#794"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-management">

Менеджмент

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="798" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/33c8e1a48197cd41190ebb390692900c.png"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/33c/8e1/a48/33c8e1a48197cd41190ebb390692900c.png"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/33c/8e1/a48/33c8e1a48197cd41190ebb390692900c.png, https://habrastorage.org/getpro/habr/upload_files/33c/8e1/a48/33c8e1a48197cd41190ebb390692900c.png 2x" />](https://habr.com/ru/events/798/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

30 – 31 октября

</div>

</div>

<a href="https://habr.com/ru/events/798/"
class="tm-event-card__title-link"><span>Киберучения 2025: всероссийские
студенческие соревнования по ИБ</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Екатеринбург</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#798"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-development">

Разработка

</div>

<div class="event-category__label event-category__label_type-other">

Другое

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="832" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/06530bfd8c2e103a4ce48e6734b7d4d2.png"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/065/30b/fd8/06530bfd8c2e103a4ce48e6734b7d4d2.png"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/065/30b/fd8/06530bfd8c2e103a4ce48e6734b7d4d2.png, https://habrastorage.org/getpro/habr/upload_files/065/30b/fd8/06530bfd8c2e103a4ce48e6734b7d4d2.png 2x" />](https://habr.com/ru/events/832/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

30 октября

</div>

</div>

<a href="https://habr.com/ru/events/832/"
class="tm-event-card__title-link"><span>Онлайн-дискуссия: Как AI и новые
экономические условия меняют HR?</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Онлайн</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#832"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-other">

Другое

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="728" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/30740f20326ada3442aa381a7ff6cf86.png"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/307/40f/203/30740f20326ada3442aa381a7ff6cf86.png"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/307/40f/203/30740f20326ada3442aa381a7ff6cf86.png, https://habrastorage.org/getpro/habr/upload_files/307/40f/203/30740f20326ada3442aa381a7ff6cf86.png 2x" />](https://habr.com/ru/events/728/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

30 октября

</div>

</div>

<a href="https://habr.com/ru/events/728/"
class="tm-event-card__title-link"><span>Премия «Проксима»</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Москва</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#728"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-marketing">

Маркетинг

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="788" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/eab419de72a5564a5195468d9f3cc89c.jpg"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/eab/419/de7/eab419de72a5564a5195468d9f3cc89c.jpg"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/eab/419/de7/eab419de72a5564a5195468d9f3cc89c.jpg, https://habrastorage.org/getpro/habr/upload_files/eab/419/de7/eab419de72a5564a5195468d9f3cc89c.jpg 2x" />](https://habr.com/ru/events/788/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

20 – 21 ноября

</div>

</div>

<a href="https://habr.com/ru/events/788/"
class="tm-event-card__title-link"><span>Медицина, технологии и
управление: встречаемся на Днях МедРокет 2025</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Москва</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#788"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-other">

Другое

</div>

</div>

</div>

</div>

</div>

</div>

<div class="swiper-slide" v-f7a30433=""
style="width: 260px; margin-right: 22px;">

<div id="820" class="section tm-block tm-block tm-block_spacing-none"
v-f7a30433="" tabindex="-1">

<div class="tm-event-card tm-event-card_is-widget">

[<img
src="file:///C:/Users/atama/Downloads/%D1%87%D0%B8%D1%81%D1%82%D0%BE%D0%B2%D0%B8%D0%BA%20_%20%D0%A5%D0%B0%D0%B1%D1%80_files/e14b636952972cf6b59e081e7032840f.png"
class="tm-event-card__image"
data-src="https://habrastorage.org/getpro/habr/upload_files/e14/b63/695/e14b636952972cf6b59e081e7032840f.png"
loading="eager"
srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/e14/b63/695/e14b636952972cf6b59e081e7032840f.png, https://habrastorage.org/getpro/habr/upload_files/e14/b63/695/e14b636952972cf6b59e081e7032840f.png 2x" />](https://habr.com/ru/events/820/)

<div class="tm-event-card__info">

<div class="tm-event-card__date">

<div class="tm-event-card__day">

20 – 21 ноября

</div>

</div>

<a href="https://habr.com/ru/events/820/"
class="tm-event-card__title-link"><span>Матемаркетинг’25: 100+ докладов
про аналитику и технологии для работы с данными</span></a>

<div class="tm-event-card__places">

<div class="tm-event-card__places-list">

<span class="tm-event-card__places-item">Москва<span class="tm-event-card__places-separator">
• </span></span><span class="tm-event-card__places-item">Онлайн</span>

</div>

</div>

</div>

<div class="tm-event-card__footer tm-event-card__footer_widget">

<a href="https://habr.com/ru/events/#820"
class="tm-event-card__link">Больше событий в календаре</a>

<div class="tm-event-card__categories">

<div class="event-category__label event-category__label_type-marketing">

Маркетинг

</div>

<div class="event-category__label event-category__label_type-analytics">

Аналитика

</div>

</div>

</div>

</div>

</div>

</div>

</div>

<span class="tm-svg-icon__wrapper swiper-button-icon"><img
src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JLQu9C10LLQvjwvdGl0bGU+PHVzZSB4bGluazpocmVmPSIvaW1nL21lZ2F6b3JkLXYyOC40OTdlZjc4OS4uc3ZnI2Fycm93LWJhY2siIC8+PC9zdmc+"
class="tm-svg-img tm-svg-icon" /></span>

<span class="tm-svg-icon__wrapper swiper-button-icon"><img
src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idG0tc3ZnLWltZyB0bS1zdmctaWNvbiIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0Ij48dGl0bGU+0JLQv9GA0LDQstC+PC90aXRsZT48dXNlIHhsaW5rOmhyZWY9Ii9pbWcvbWVnYXpvcmQtdjI4LjQ5N2VmNzg5Li5zdmcjYXJyb3ctYmFjayIgLz48L3N2Zz4="
class="tm-svg-img tm-svg-icon" /></span>

</div>

</div>

</div>

<div class="element-wrapper medium-rectangle tm-layout-sidebar__banner tm-layout-sidebar__banner_bottom"
style="--6d0642e0: 0px; --418c71fe: auto;">

</div>

</div>

</div>

</div>

</div>

</div>

</div>

</div>
